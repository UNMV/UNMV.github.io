(function(){var f,a,u={}.hasOwnProperty,s=[].slice,i=function(e,t){for(var r in t)u.call(t,r)&&(e[r]=t[r]);function n(){this.constructor=e}return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};a=10,f="inputmemory_keys",dayjs.extend(window.dayjs_plugin_duration),dayjs.extend(window.dayjs_plugin_calendar),dayjs.extend(window.dayjs_plugin_advancedFormat),dayjs.extend(window.dayjs_plugin_relativeTime),window.I={libs:{react:$.Deferred(function(e){return function(t){if(typeof React!="undefined"&&React!==null)return t.resolve(React)}}(this)),selectize:$.Deferred(function(e){return function(t){var r;if(typeof $!="undefined"&&$!==null&&(r=$.fn)!=null&&r.selectize)return t.resolve($.fn.selectize)}}(this)),redactor:$.Deferred(function(e){return function(t){var r;if(typeof $!="undefined"&&$!==null&&(r=$.fn)!=null&&r.redactor)return t.resolve($.fn.redactor)}}(this))},setup_page:function(){return I.setup_register_referrers($(document.body)),_.defer(function(e){return function(){return I.setup_affiliate_code()}}(this))},root_url:function(){var e;return e=null,function(t){return e||(e=$("body").data("host")||"",e!==""&&(e=window.location.protocol+"//"+e,window.location.port&&window.location.port!=="80"&&(e+=":"+window.location.port))),e+"/"+t}}(),page_name:function(){return $(document.body).data("page_name")||"unknown"},sort_keys:function(e){var t,r;return r=[],t=function(n){var o,l,c;l=[];for(o in n)u.call(n,o)&&(c=n[o],r.push(o),typeof c=="object"?l.push(t(c)):l.push(void 0));return l},t(e),r.sort()},get_csrf:function(){return this._csrf_token||(this._csrf_token=$("meta[name='csrf_token']").attr("value"))},with_csrf:function(e){var t;return e==null&&(e={}),t={csrf_token:I.get_csrf()},typeof e=="string"?e+"&"+$.param(t):$.extend(e,t)},add_params:function(e){return function(t,r){var n;return n=$.param(r),t.match(/\?/)?t+"&"+n:t+"?"+n}}(this),flash:function(e,t){return t==null&&(t="notice"),this.flasher||(this.flasher=new I.Flasher),e.match(/^error:/)&&(e=e.replace(/^error:/,"Error: "),t="error"),this.flasher.show(t,e)},slugify:function(e,t){return e=e.replace(/\s+/g,"-"),e=t!=null&&t.for_tags?e.replace(/[^\w_.-]/g,"").replace(/^[_.-]+/,"").replace(/[_.-]+$/,""):e.replace(/[^\w_-]/g,""),e.toLowerCase()},truncate:function(e,t,r){return t==null&&(t=30),r==null&&(r="..."),e?e.length>t+r.length?""+e.slice(0,t)+r:e:""},number_format:function(e,t,r,n){var o,l,c;return r==null&&(r="."),n==null&&(n=","),isNaN(e)||e===null?"":(e=e.toFixed(~~t),c=e.split("."),l=c[0],o=c[1]?r+c[1]:"",l.replace(/(\d)(?=(?:\d{3})+$)/g,"$1"+n)+o)},format_bytes:function(){var e;return e=[["gb",Math.pow(1024,3)],["mb",Math.pow(1024,2)],["kb",1024]],function(t){var r,n,o,l,c;for(r=0,o=e.length;r<o;r++)if(c=e[r],n=c[0],l=c[1],t>=l)return""+I.number_format(t/l)+n;return I.number_format(t)+" bytes"}}(),ecommerce_event:function(e){return window.ga?(ga("ecommerce:addTransaction",e.transaction),ga("ecommerce:addItem",e.item),ga("ecommerce:send")):console.log("ecommerce event:",e)},event:function(e,t,r,n,o){var l;return o==null&&(o=!0),l={hitType:"event",eventCategory:e,eventAction:t,eventLabel:r,eventValue:n},o||(l.nonInteraction=1),I.event_with_opts(l)},event_with_opts:function(e){try{return typeof ga!="undefined"&&ga!==null?ga("send",e):(console.log("event:",e),typeof e.hitCallback=="function"?e.hitCallback():void 0)}catch(t){}},event2:function(){var e;e=1<=arguments.length?s.call(arguments,0):[]},parse_money:function(e){var t;return t=e&&parseInt(e.replace(/[^\d]/g,""),10),t||0},currency_symbols:{USD:"$",GBP:"\xA3",EUR:"\u20AC",JPY:"\xA5"},currency_formats:{USD:{prefix:"$"},GBP:{prefix:"\xA3"},JPY:{prefix:"\xA5"},EUR:{suffix:"\u20AC"}},format_money:function(e,t){var r,n;return t==null&&(t="USD"),e<0?"-"+I.format_money(-e,t):(n=I.currency_symbols[t]||"$",t==="JPY"?n+e:(r=I.number_format(e/100,2),t==="EUR"?""+r+n:""+n+r))},money_input:function(e,t){var r,n;return t==null&&(t={}),e=$(e),r=t.currency||e.data("currency"),n=I.currency_formats[r]||{prefix:"$"},e.maskMoney($.extend({affixesStay:!0,precision:r==="JPY"?0:2},n,t))},plural:function(e,t){return t===1?t+" "+e:t+" "+e+"s"},default_redactor_opts:{plugins:["source","table","alignment","video","addimage"],toolbarFixed:!1,buttons:["format","bold","italic","deleted","lists","link"],minHeight:250,linkSize:80},add_recaptcha_if_necessary:function(e,t){if(t[0]==="recaptcha")return e.data("adding_recaptcha")||(e.data("adding_recaptcha",!0),I.with_recaptcha(function(r){return function(){var n;return n=e.find(".g-recaptcha"),I.event("recaptcha","show",I.page_name()),grecaptcha.render(n[0],{sitekey:n.data("sitekey")})}}(this))),e.set_form_errors(["Please fill out the CAPTCHA to continue"]),!0},with_recaptcha:function(e){return function(t){var r;return window.grecaptcha?t(e):e.recaptcha_deferred?e.recaptcha_deferred.done(t):(e.recaptcha_deferred=$.Deferred().done(t),window._itch_recaptcha_loaded=function(){return this.recaptcha_deferred.resolve()},r="https://www.google.com/recaptcha/api.js?onload=_itch_recaptcha_loaded&render=explicit",$('<script type="text/javascript">').attr("src",r).appendTo("head"))}}(this),wait_for_object:function(e){return function(t,r,n){var o,l,c;return l=1,o=10,c=function(){return t[r]?typeof n=="function"?n():void 0:(l+=o,l=Math.min(500,l),setTimeout(c,l))},c()}}(this),with_redactor:function(e){return function(t){return I.wait_for_object($.fn,"redactor",t)}}(this),with_selectize:function(e){return function(t){return I.libs.selectize.done(t)}}(this),redactor:function(e){return function(t,r){var n,o;if(r==null&&(r={}),!window.location.href.match(/\bredactor=0\b/)){if(!$.fn.redactor){console.warn("tried to create redactor text element without redactor on page",t[0]);return}r=$.extend({},I.default_redactor_opts,r),r.source===!1&&(delete r.source,r.plugins=function(){var l,c,p,m;for(p=r.plugins,m=[],l=0,c=p.length;l<c;l++)o=p[l],o!=="source"&&m.push(o);return m}());try{return t.redactor(r)}catch(l){return n=l,I.event("error","redactor","invalid_content"),t.parent().replaceWith(t).end().val("").redactor(r)}}}}(this),get_template:function(e){return _.template($("#"+e+"_tpl").html())},lazy_template:function(e,t){return function(){var r,n;return r=1<=arguments.length?s.call(arguments,0):[],n=I.get_template(t),e.prototype.template=n,n.apply(null,r)}},setup_sticky_bar:function(e){var t,r,n;return n=$(window),t=$(document.body),e=$(e),r=!1,n.on("scroll",function(o){return function(l){if(n.scrollTop()>e.offset().top+e.outerHeight()){if(!r)return t.addClass("show_sticky_bar"),r=!0}else if(r)return t.removeClass("show_sticky_bar"),r=!1}}(this))},setup_selectize:function(e){return e.find(".selectize_input").each(function(t,r){var n,o,l,c,p,m,d;if(n=$(r),!n.hasClass("selectized"))return p={plugins:[],persist:!1},n.is("select")&&(o={},n.find("option").each(function(v,S){var b;return b=$(S),o[b.val()]=b.data("extra")}),d=function(v,S){var b,g;return b=S(v.text),(g=o[v.value])&&(b=b+" <span class='sub'>\u2014 "+g+"</span>"),"<div class='option'>"+b+"</div>"},p.render={item:d,option:d}),(m=n.data("placeholder"))&&(p.placeholder=m),n.hasClass("dropdown")&&(p.maxItems=1),(c=n.data("options"))&&(n.hasClass("options_object")?(p.options=c,p.searchField=["text","keywords"]):p.options=c.map(function(v){return{value:v[0],text:v[1]}}),p.plugins.push("remove_button"),p.delimiter=",",p.persist=!1),(l=n.data("optgroups"))&&(p.optgroups=l),n.selectize(p)})},format_duration:function(e,t,r){var n,o,l,c,p,m,d,v,S;for(t==null&&(t=null),r==null&&(r=!0),typeof e=="number"&&(e=dayjs.duration(e)),d=[["y","years","a year"],["m","months","a month"],["d","days","a day"],["h","hours","an hour"],["m","minutes","a minute"],["s","seconds","a second"]],p=[],o=0,c=d.length;o<c&&(m=d[o],!(t&&p.length===t));o++)l=m[0],n=m[1],v=m[2],S=e[n](),S>0&&(S>1?n==="seconds"&&r?p.push("a few seconds"):p.push(S+" "+n):p.push(v));return p.length>1&&(p[p.length-1]="and "+p[p.length-1]),p.join(", ")},format_filesize:function(e,t){var r,n,o,l,c;for(t==null&&(t=".file_size_value"),l=e.find(t),c=[],n=0,o=l.length;n<o;n++)r=l[n],r=$(r),c.push(r.html(I.format_bytes(parseInt(r.html()))));return c},adjust_font_size_to_fit:function(e){return function(t,r){var n,o,l;if(r==null&&(r=16),!!t.length){for(o=t.css("font-size"),o=parseInt(o.match(/\d+/),10),n=t[0],l=[];n.offsetWidth<n.scrollWidth&&(o-=2,!(o<r));)l.push(t.css("font-size",o+"px"));return l}}}(this),date_format:"yy-mm-dd",time_format:"HH:mm:ss",format_date_time:function(e){var t,r;return r=$.datepicker.formatTime(this.time_format,{hour:e.getHours(),minute:e.getMinutes(),second:e.getSeconds()}),t=$.datepicker.formatDate(this.date_format,new Date(e)),t+" "+r},format_date:function(e){return $.datepicker.formatDate(this.date_format,new Date(e))},datetimepicker:function(e,t){var r,n,o,l,c;for(r=0,n=e.length;r<n;r++)o=e[r],l=$(o),(c=l.attr("value"))&&l.val(this.format_date_time(I.parse_timestamp(c)));return e.datetimepicker($.extend({timeFormat:this.time_format,dateFormat:this.date_format,beforeShow:function(p){return function(){_.defer(function(){return $("#ui-datepicker-div").css("z-index",100)})}}(this)},t))},datepicker:function(e,t){return e.datepicker($.extend({dateFormat:this.date_format,beforeShow:function(r){return function(){_.defer(function(){return $("#ui-datepicker-div").css("z-index",100)})}}(this)},t))},slug_input:function(e){return function(t,r){var n;if(n=/[a-z_0-9_-]/g,t.on("keypress",function(o){var l;if(o.keyCode>=32&&(l=String.fromCharCode(o.keyCode),!l.match(n)))return!1}),r&&r.length)return t.on("change",function(o){var l;if(l=I.slugify(r.val()),t.val().match(/^\s*$/)&&l!=="")return t.val(l)}),r.on("change",function(o){if(t.val().match(/^\s*$/))return t.val(I.slugify($(o.currentTarget).val()))})}}(this),deferred_links:function(e,t,r){return r||(r=I.delegate_tracking),e.on("mouseup",t,function(n){var o;if(n.which===2)return o=$(n.currentTarget),r(o,n)}),e.on("click",t,function(n){var o,l,c,p;if(n.which===1&&(p=$(n.currentTarget),l=n.metaKey||n.ctrlKey||n.shiftKey||p.attr("target")==="_blank",o=null,l||(o=function(m){return function(){if(o)return o=null,window.location=p.attr("href")}}(this),setTimeout(function(m){return function(){return typeof o=="function"?o():void 0}}(this),200)),(c=r(p,n))!=null&&c.done(o),!l))return!1})},delegate_tracking:function(e){return function(t){var r;return r=[],t.trigger("i:delegate_tracking",[function(n){return r.push(n)}]),$.when.apply($,r)}}(this),ga_tracker:function(e){return function(t,r,n,o){var l;return l=function(c){var p,m,d,v,S;return p={hitType:"event",eventCategory:(m=c.data("category"))!=null?m:t,eventAction:(d=c.data("action"))!=null?d:r,eventLabel:(v=c.data("label"))!=null?v:n,eventValue:(S=c.data("value"))!=null?S:o},$.Deferred(function(b){return function(g){return p.hitCallback=function(){return g.resolve()},I.event_with_opts(p)}}(this))}}}(this),tracked_links:function(){var e,t,r,n,o,l,c;return r=arguments[0],o=2<=arguments.length?s.call(arguments,1):[],t=o[0],e=o[1],n=o[2],c=o[3],l=I.ga_tracker(t,e,n,c),I.deferred_links(r,"a[data-label]",l),r.on("i:track_link",function(p,m){var d;return m&&(d=m[0]),I.ga_tracker(t,e,d!=null?d:n,c)($(p.target))})},set_cookie:function(e,t,r){return r==null&&(r={}),I.in_dev&&console.log("set cookie:",[e,t],r),Cookies.set(e,t,$.extend({path:"/",domain:"."+$(document.body).data("host")},r))},set_register_referrer:function(e){return function(t){var r;if(r=I.page_name(),r!=null&&I.set_cookie("ref:register:page_params",r),t!=null)return I.set_cookie("ref:register:action",t)}}(this),setup_register_referrers:function(e){return function(t){if(!I.current_user)return t.on("mouseup","[data-register_action]",function(r){var n;return n=$(r.currentTarget).data("register_action"),I.set_register_referrer(n)})}}(this),setup_affiliate_code:function(e){return function(t,r){var n,o;if(r==null&&(r=!1),t==null&&(t=(o=window.location.search.match(/\bac=([\w\d]+(?:\-[\.:_\w\d]+)?)/))!=null?o[1]:void 0),!!t&&!(!r&&t===Cookies.get("acode")))return I.set_cookie("acode",t,{expires:1}),document.referrer&&I.set_cookie("acode:ref",document.referrer.substring(0,180),{expires:1}),n=window.location.href.replace(/\?.*$/,"").substring(0,180),I.set_cookie("acode:land",n,{expires:1})}}(this),setup_grid_referrers:function(e){return function(t,r){var n;return n=function(o){var l,c,p,m;if(o.closest(".game_author").length||(l=o.closest("[data-game_id]").data("game_id"))&&I.ReferrerTracker.push("game",l,r(o)),!o.closest(".sale_author").length&&(c=o.closest("[data-sale_id]"),p=c.data("sale_id")))return m=c.data("sale_type"),I.ReferrerTracker.push(m,p,r(o))},t.on("mouseup",".game_cell a, .sale_row a, .leader_game a",function(o){if(!(o.which>3))return n($(o.currentTarget))}),t.on("i:track_link",function(o){return n($(o.target))})}}(this),bind_checkbox_to_input:function(e){return function(t,r,n){var o;return o=function(){var l;return l=t.prop("checked"),r.prop("disabled",l),typeof n=="function"?n(l):void 0},t.on("change",o),o()}}(this),add_facebook:function(e){return function(t){var r,n,o;if(!window.FB&&(e.add_facebook=function(){},$('<div id="fb-root"></div>').appendTo(document.body),n="facebook-jssdk",!document.getElementById(n)))return t!=null&&(window.fbAsyncInit=t),r=document.getElementsByTagName("script")[0],o=document.createElement("script"),o.id=n,o.src="//connect.facebook.net/en_GB/sdk.js#xfbml=1&appId=537395183072744&version=v2.0",r.parentNode.insertBefore(o,r)}}(this),add_twitter:function(e){return function(){var t,r,n;if(r="twitter-wjs",!document.getElementById(r))return e.add_twitter=function(){},t=document.getElementsByTagName("script")[0],n=document.createElement("script"),n.id="twitter-wjs",n.src="//platform.twitter.com/widgets.js",t.parentNode.insertBefore(n,t)}}(this),add_react:function(){var e,t;return e=$.Deferred(),I.add_react=function(){return e},I.libs.react.done(function(r){return function(){return e.resolve()}}(this)),t=$("#lib_react_src"),t.replaceWith($('<script type="text/javascript">').attr("src",t.data("src"))),e},has_follow_button:function(e){return function(t,r){var n,o,l,c,p,m,d;return r==null&&(r={}),t=$(t),l=(p=r.cls)!=null?p:"follow_button_widget",n=(m=r.animate_follow)!=null?m:"animate_bounce",o=(d=r.animate_unfollow)!=null?d:"animate_drop_down",c={},c[l]=function(v){var S,b,g,w;if(!I.current_user)return"continue";if(!v.is(".loading"))return v.removeClass(n+" "+o),g=$.Deferred(function(k){return setTimeout(function(){return k.resolve()},500)}),b=v.is(".is_following"),w=b?(_.defer(function(){return v.addClass(o)}),v.data("unfollow_url")):(_.defer(function(){return v.addClass(n)}),v.data("follow_url")),v.addClass("loading").trigger("i:track_link",["follow_btn"]),S=v.data("follow_data")||{},$.when($.post(w,I.with_csrf(S)),g).done(function(k){var C;if(C=k[0],v.removeClass("loading "+n+" "+o),C.errors){I.flash(C.errors.join(", "));return}return v.toggleClass("is_following",C.following).trigger("i:follow_updated",[{user_id:v.data("user_id"),following:C.following,btn:v}])})},t.dispatch("click",c),$(document.body).on("i:follow_updated",function(v,S){var b,g,w;return w=S.user_id,g=S.following,b=S.btn,t.find("."+l+"[data-user_id="+w+"]").not(b).toggleClass("is_following",g)})}}(this),is_mobile:function(e){return function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}}(this),is_ios:function(e){return function(){return/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream}}(this),strip_css:function(e){return function(t){return t.replace(/<\s*\/\s*style\s*>/i,"")}}(this),request_fullscreen:function(e){return function(t,r){var n,o,l;return n=t.requestFullscreen?(t.requestFullscreen(),!0):t.msRequestFullscreen?(t.msRequestFullscreen(),!0):t.mozRequestFullScreen?(t.mozRequestFullScreen(),!0):t.webkitRequestFullscreen?(t.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT),!0):!1,n&&r&&(o=window.screen)!=null&&(l=o.orientation)!=null&&typeof l.lock=="function"&&l.lock(r),n}}(this),is_fullscreen:function(e){return function(){return!(!document.fullscreenElement&&!document.mozFullScreenElement&&!document.webkitFullscreenElement&&!document.msFullscreenElement)}}(this),exit_fullscreen:function(e){return function(){if(document.exitFullscreen)return document.exitFullscreen();if(document.msExitFullscreen)return document.msExitFullscreen();if(document.mozCancelFullScreen)return document.mozCancelFullScreen();if(document.webkitExitFullscreen)return document.webkitExitFullscreen()}}(this),toggle_fullscreen:function(e){return function(t,r){return I.is_fullscreen()?(I.exit_fullscreen(),!1):I.request_fullscreen(t,r)?!0:"failed"}}(this),setup_dirty_warning:function(e){return function(t,r){return r||(r=function(){return t.data("dirty")}),t.data("dirty",!1),$(window).on("beforeunload",function(){var n;if(n=r(),!!n)switch(typeof n){case"string":return n;default:return"You've made modifications to this page."}}),t.on("i:after_submit",function(){return t.data("dirty",!1)}),_.defer(function(){return t.on("change","input, select, textarea",function(n){return t.data("dirty",!0)}),t.on("keydown, mousedown",".redactor-editor",function(){return t.data("dirty",!0)})})}}(this),remote_submit:function(e){return function(t,r,n){var o,l;return n==null&&(n={}),t.trigger("i:before_submit"),l=t.serializeArray(),o=n.loading_lock?t.addClass("loading").find("button, input[type='submit']").prop("disabled",!0).addClass("disabled"):void 0,$.when(r).then(function(c){var p;return c&&(l=l.concat(c)),$.ajax({data:l,type:(p=t.attr("method"))!=null?p:"POST",dataType:"json",url:t.attr("action"),xhrFields:{withCredentials:!0},error:function(m){var d;return d=function(){try{return JSON.parse(m.responseText)}catch(v){}}(),d!=null&&d.errors?I.flash(d.errors.join(", ")):I.flash("We seem to be having server problems right now! Please try again later.")},complete:function(){return n.loading_lock&&(o.prop("disabled",!1).removeClass("disabled"),t.removeClass("loading")),t.trigger("i:after_submit")}}).then(null,function(m){try{return JSON.parse(m.responseText)}catch(d){throw m}})})}}(this),is_middle_click:function(e){return function(t){return t.which===2||t.metaKey||t.ctrlKey}}(this),escape_regex:function(e){return function(t){return t.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}}(this),move:function(e,t,r){var n,o,l,c;if(o=e.indexOf(t),o===-1)throw"Failed to find object in array";if(c=o+r,c<0||c>=e.length)throw"Movement is outside of array ("+c+") [0, "+(e.length-1)+"]";return n=function(){var p,m,d;for(d=[],p=0,m=e.length;p<m;p++)l=e[p],l!==t&&d.push(l);return d}(),n.splice(c,0,t),n},format_integer:function(e){return e>1e7?Math.floor(e/1e6)+"m":e>=1e6?Math.floor(e/1e5)/10+"m":e>1e4?Math.floor(e/1e3)+"k":e>=1e3?Math.floor(e/100)/10+"k":""+e},coerce_timestamp:function(e){var t;return(t=typeof e=="string"&&e.match(/(^\d{4}\-\d{1,2}\-\d{1,2}) (\d{1,2}:\d{1,2}:\d{1,2})$/))?t[1]+"T"+t[2]+"Z":e},parse_timestamp:function(e){return dayjs(I.coerce_timestamp(e)).toDate()},format_timestamp:function(){var e,t,r,n;switch(n=arguments[0],t=arguments[1],e=3<=arguments.length?s.call(arguments,2):[],t==null&&(t="fromNow"),n=I.coerce_timestamp(n),t){case"fromNow":return dayjs(n).fromNow();case"calendar":return dayjs(n).calendar(null,{sameElse:"MMMM Do YYYY"});case"format":return(r=dayjs(n)).format.apply(r,e);default:throw new Error("unknown method for format_timestamp: "+t)}},store_memory:function(e,t){var r,n,o,l;if(window.localStorage){if(o=function(){try{return JSON.parse(localStorage.getItem(f))}catch(c){}}(),o||(o=[]),o[0]!==e){for(n=function(){var c,p,m;for(m=[],c=0,p=o.length;c<p;c++)r=o[c],e!==r&&m.push(r);return m}(),o=[e].concat(n);o.length>a;)l=o.pop(),typeof localStorage!="undefined"&&localStorage!==null&&localStorage.removeItem(l);localStorage.setItem(f,JSON.stringify(o))}return localStorage.setItem(e,t)}},clear_memory:function(e){var t,r;if(window.localStorage){r=function(){try{return JSON.parse(localStorage.getItem(f))}catch(n){}}(),r&&localStorage.setItem(f,JSON.stringify(function(){var n,o,l;for(l=[],n=0,o=r.length;n<o;n++)t=r[n],e!==t&&l.push(t);return l}()));try{return localStorage.removeItem(e)}catch(n){}}}},$(function(){var e;if((e=window.location.hash.match(/\bflash=([^&]*)/))&&(I.flash(e[1]),window.location.hash=window.location.hash.replace(/\bflash=([^&]*)/,"")),I.ie)return $(document.body).addClass("ie")}),I.Flasher=function(){e.prototype.duration=1e4,e.prototype.animation_duration=250,e.prototype.clipping="-7px";function e(){$(document).on("click",".global_flash",function(t){return function(){return t.dismiss()}}(this))}return e.prototype.dismiss=function(){var t;if(t=this.current_flash)return this.timeout&&(clearTimeout(this.timeout),this.timeout=null),t.css({"margin-top":"-"+(t.outerHeight()+4)+"px"}),setTimeout(function(r){return function(){return t.remove()}}(this),this.animation_duration*2)},e.prototype.show=function(t,r){var n;return this.dismiss(),n=$("<div class='global_flash "+t+"' role='alert' aria-live='polite'>").text(r).appendTo("body"),n.css({"margin-left":"-"+n.width()/2+"px","margin-top":"-"+(n.outerHeight()+4)+"px"}),this.timeout=setTimeout(function(o){return function(){return n.addClass("animated"),n.css({"margin-top":o.clipping}),setTimeout(function(){return o.dismiss()},o.duration)}}(this),100),this.current_flash=n},e}(),I.InfiniteScroll=function(){e.prototype.loading_element=".grid_loader";function e(t,r){this.opts=r!=null?r:{},this.el=$(t),this.setup_loading()}return e.prototype.get_next_page=function(){return alert("override me")},e.prototype.setup_loading=function(){var t,r;if(!this.opts.disable_infinite_scroll&&(this.loading_row=this.el.find(this.loading_element),!!this.loading_row.length))return r=$(window),t=function(n){return function(){if(!n.el.is(".loading")&&r.scrollTop()+r.height()>=n.loading_row.offset().top)return n.get_next_page()}}(this),r.on("scroll.browse_loader",t),t()},e.prototype.remove_loader=function(){return $(window).off("scroll.browse_loader"),this.loading_row.remove()},e}(),I.InfiniteGameGrid=function(e){i(t,e);function t(){return t.__super__.constructor.apply(this,arguments)}return t.prototype.method="post",t.prototype.current_page=1,t.prototype.get_next_page=function(){return this.current_page+=1,this.el.addClass("loading"),$[this.method]("",{page:this.current_page,format:"json"},function(r){return function(n){return r.el.removeClass("loading"),n.num_items>0?r.grid.add_image_loading($(n.content).appendTo(r.grid.el).hide().fadeIn()):r.remove_loader()}}(this))},t}(I.InfiniteScroll),_.templateSettings={escape:/\{\{(?![&])(.+?)\}\}/g,interpolate:/\{\{&(.+?)\}\}/g,evaluate:/<%([\s\S]+?)%>/g},$.easing.smoothstep=function(e){return e*e*e*(e*(e*6-15)+10)}}).call(this),function(){var f;$.fn.dispatch=function(a,u){return this.on(a,function(s){return function(i){var e,t,r,n;for(r in u)if(t=u[r],e=$(i.target).closest("."+r),!!e.length)return e.is(".disabled")?!1:e.is("a")&&i.ctrlKey||(n=t(e,i),n==="continue")?void 0:!1;return null}}(this)),this},$.fn.exists=function(){return this.length>0?this:!1},$.fn.format_timestamps=function(a){var u,s,i,e,t;for(a==null&&(a="calendar"),t=this.find(".date_format"),s=function(r){var n,o,l;return n=r.data("format"),o=r.html(),l=n?I.format_timestamp(o,"format",n):I.format_timestamp(o,a),r.html(l).attr("title",o+" UTC")},i=0,e=t.length;i<e;i++)u=t[i],s($(u));return this},$.fn.has_tooltips=function(a){var u,s,i,e,t,r;if(a==null&&(a={}),!I.is_mobile())return t=function(){var n;return n=$('<div class="tooltip_drop"></div>'),$(document.body).append(n),t=function(){return n},n},r=_.template('<div class="tooltip">{{ label }}</div>'),e=function(n,o){var l,c,p,m;return o==null&&(o=!1),l=n.data("tooltip_el"),l||(l=$(r({label:n.attr("aria-label")||n.data("tooltip")})),n.data("tooltip_el",l)),l.removeClass("visible"),t().empty().append(l),p=n.offset(),c=l.outerHeight(),m=l.outerWidth(),l.css({position:"absolute",top:a.below?p.top+n.outerHeight()+10:p.top-c-10,left:Math.floor(p.left+(n.outerWidth()-m)/2)}),l.toggleClass("below",!!a.below),o?l.addClass("visible"):setTimeout(function(d){return function(){return l.addClass("visible")}}(this),10)},s=function(n){return function(o){var l,c;if(c=$(o.currentTarget),l=c.data("tooltip_el"),c.removeData("tooltip_el"),!!l&&l.is(":visible"))return e(c,!0)}}(this),i=function(n){return function(o){var l;if(l=$(o.currentTarget),!l.closest(".redactor-box").length)return e(l)}}(this),u=function(n){return function(o){var l,c;if(c=$(o.currentTarget),l=c.data("tooltip_el"))return l.remove()}}(this),this.is("[data-tooltip]")?(this.on("i:refresh_tooltip",s),this.on("mouseenter focus",i),this.on("mouseleave blur i:hide_tooltip",u)):(this.on("i:refresh_tooltip","[data-tooltip], [aria-label]",s),this.on("i:clear_tooltips",function(){return t().empty()}),this.on("mouseenter focus","[data-tooltip], [aria-label]",i),this.on("mouseleave blur i:hide_tooltip","[data-tooltip], [aria-label]",u)),this},$.fn.inline_edit=function(a){var u,s,i;if(a==null&&(a={}),this.is(".inline_editing")){this.data("finished_editing")();return}return this.addClass("inline_editing"),s=$('<input type="text" class="inline_edit_input" />').attr("placeholder",this.data("placeholder")).val((typeof a.get_val=="function"?a.get_val(this):void 0)||this.text()).insertAfter(this.hide()).select(),u=function(e){return function(){return s.remove(),e.show(),$(document).off("click.inline_editing"),e.removeClass("inline_editing")}}(this),this.data("finished_editing",u),i=function(e){return function(){return s.prop("disabled",!0),a.set_val?a.set_val(e,s.val(),u):(e.text(s.val()),u())}}(this),$(document).on("click.edit_title",function(e){return function(t){if(!$(t.target).closest(".inline_edit_input").length)return i()}}(this)),s.on("keydown",function(e){return function(t){switch(t.keyCode){case 9:return _.defer(function(){return i()});case 13:return i();case 27:return u()}}}(this))},I.support_passive_scroll=function(){var a,u;u=!1;try{a=Object.defineProperty({},"passive",{get:function(s){return function(){return u=!0}}(this)}),window.addEventListener("test",null,a)}catch(s){}return u},I.support_intersection_observer=function(){return"IntersectionObserver"in window},f=function(a,u){var s,i,e,t,r,n,o,l;for(a.removeClass("lazy_images"),i=a.find("[data-background_image]").addBack("[data-background_image]"),t=function(){var c,p,m;for(m=[],c=0,p=i.length;c<p;c++)s=i[c],m.push(function(d){var v;if(d=$(d),v=d.data("background_image"),d.css({backgroundImage:"url("+v+")"}),u)return $.Deferred(function(S){return function(b){return $("<img />").attr("src",v).on("load",function(){return b.resolve()})}}(this))}(s));return m}(),l=a.find("img[data-lazy_src]").addBack("img[data-lazy_src]"),e=function(c){var p,m;if(c=$(c),p=c.data("lazy_src"),c.attr("src",p),(m=c.data("lazy_srcset"))&&c.attr("srcset",m),u)return $.Deferred(function(d){return function(v){return c.on("load",function(){return v.resolve()})}}(this))},n=0,o=l.length;n<o;n++)r=l[n],e(r);if(u)return t.length===1?t[0]:$.when.apply($,t)},$.fn.lazy_images=function(a){var u,s,i,e,t,r,n,o,l,c,p,m,d,v,S,b;if(p=this.data("lazy_images"))return p();if(o=a!=null&&a.elements?function(){var g,w,k,C;for(k=a.elements,C=[],g=0,w=k.length;g<w;g++)i=k[g],C.push($(i));return C}():(m=(a!=null?a.selector:void 0)||".lazy_images",function(){var g,w,k,C;for(k=this.find(m),C=[],g=0,w=k.length;g<w;g++)i=k[g],C.push($(i));return C}.call(this)),u=(c=a!=null?a.show_images:void 0)!=null?c:f,I.support_intersection_observer()){for(e=function(g){var w,k,C,T,D,j;for(j=[],C=0,T=g.length;C<T;C++)k=g[C],k.isIntersecting?(i=k.target,r.unobserve(i),i=$(i),D=a!=null?a.show_item:void 0,w=u(i,!!D),j.push(typeof D=="function"?D(i,w):void 0)):j.push(void 0);return j},r=new IntersectionObserver(e,{}),n=0,l=o.length;n<l;n++)i=o[n],r.observe(i[0]);return function(){return r.disconnect()}}return b=$(window),d=a!=null?a.target:void 0,t=a!=null?a.horizontal:void 0,S=null,s=function(g){return function(){var w,k,C,T,D,j,A,W,V;for(w=function(){if(d){if(t)return d.outerWidth()+d.position().left;throw new Error("not yet")}else return b.scrollTop()+b.height()}(),C=0,T=j=0,A=o.length;j<A;T=++j)if(D=o[T],!!D){if(!document.body.contains(D[0])){o[T]=null,C+=1;continue}V=function(){if(d){if(t)return D.position().left;throw new Error("not yet")}else return D.offset().top}(),D[0].offsetParent&&V<w&&(W=a!=null?a.show_item:void 0,k=u(D,!!W),typeof W=="function"&&W(D,k),C+=1,o[T]=null)}if(C>0)return o=function(){var J,Q,G;for(G=[],J=0,Q=o.length;J<Q;J++)i=o[J],i&&G.push(i);return G}()}}(this),v=_.throttle(s,100),d?(d.on("scroll",v),b.on("resize",v),S=function(){return d.off("scroll",v),b.off("resize","throttled")}):I.support_passive_scroll()?(window.addEventListener("scroll",v,{passive:!0}),b.on("resize i:reshape",v),S=function(){return window.removeEventListener("scroll",v,{passive:!0}),b.off("resize",v)}):(b.on("scroll resize i:reshape",v),S=function(){return b.off("scroll resize i:reshape",v)}),this.data("lazy_images",function(g){return function(){return o=a!=null&&a.elements?function(){var w,k,C,T;for(C=a.elements,T=[],w=0,k=C.length;w<k;w++)i=C[w],T.push($(i));return T}():(m=(a!=null?a.selector:void 0)||".lazy_images",function(){var w,k,C,T;for(C=this.find(m),T=[],w=0,k=C.length;w<k;w++)i=C[w],T.push($(i));return T}.call(g)),s()}}(this)),s(),S},$.fn.max_height=function(a){var u,s,i;return a==null&&(a=0),i=$(window),u=this.outerHeight(!0)-this.height(),s=function(e){return function(){return e.css("min-height",i.height()-u-a+"px")}}(this),i.on("resize",s),s()},$.fn.remote_link=function(a){return this.on("click","[data-remote]",function(u){return function(s){var i,e,t,r,n;if(s.preventDefault(),e=$(s.currentTarget),!e.is(".loading")&&(r=e.data("method")||"POST",n=I.with_csrf($.extend({},e.data("params"))),t=e.data("href")||e.attr("href"),!((i=e.data("confirm"))&&!confirm(i))))return e.addClass("loading").prop("disabled",!0),$.ajax({type:r,url:t,data:n,xhrFields:{withCredentials:!0}}).done(function(o){return e.removeClass("loading").prop("disabled",!1),typeof a=="function"?a(o,e):void 0}),null}}(this))},$.fn.remote_submit=function(a,u,s){var i;return i=null,this.on("click","button[name], input[type='submit'][name]",function(e){return function(t){var r;return r=$(t.currentTarget),i!=null&&i.remove(),i=$("<input type='hidden' />").attr("name",r.attr("name")).val(r.attr("value")).prependTo(e)}}(this)),this.on("submit",function(e){return function(t,r){var n;if(t.preventDefault(),n=$(t.currentTarget),!(u&&!(typeof u=="function"&&u(n))))return I.remote_submit(n,s,{loading_lock:!0}).done(function(o){return n.data("dirty",!1),r!=null?r(o,n):a(o,n)}),null}}(this))},$.fn.remote_table=function(){var a,u,s,i;return s=this.data("max_page"),a=function(e){return function(){return e.data("page")||1}}(this),i={},u=function(e){return function(t){var r,n;if(!e.is(".loading")&&1<=t&&t<=s)return r=e.find("table"),e.addClass("loading").data("page",t).toggleClass("first_page",t===1).toggleClass("last_page",t===s).find(".current_page").text(t),n=i[t]||(i[t]=$.get(e.data("remote_url")+"?"+$.param({page:t}))),n.done(function(o){return e.removeClass("loading"),r.html(o.content)})}}(this),this.dispatch("click",{next_page_btn:function(e){return function(){return u(a()+1)}}(this),prev_page_btn:function(e){return function(){return u(a()-1)}}(this)})},$.fn.set_form_errors=function(a,u,s){var i,e,t,r,n,o,l,c;if(u==null&&(u=!0),s==null&&(s="Errors"),this.find(".form_errors").remove(),n=!!(a!=null&&a.length),this.toggleClass("has_errors",n),n){for(t=$(_.template(`<div class="form_errors">
  <div>{{ msg }}:</div>
  <ul></ul>
</div>`)({msg:s})),r=t.find("ul"),o=0,l=a.length;o<l;o++)e=a[o],r.append($("<li></li>").text(e));this.prepend(t),u&&(c=this.closest(".lightbox"),c.length||this.offset().top>$(window).height()/2?typeof(i=this[0]).scrollIntoView=="function"&&i.scrollIntoView():$("html, body").animate({scrollTop:0},"fast"))}return this},$.fn.swap_with=function(a){var u,s,i,e,t,r,n,o;if(a=$(a),!!(this.length&&a.length))return s=this.offset(),e=a.offset(),o=this.prop("tagName"),r=a.prop("tagName"),n=$("<"+o+"></"+o+">").insertAfter(this),t=$("<"+r+"></"+r+">").insertAfter(a),n.after(a),t.after(this),u=this.offset(),i=a.offset(),t.replaceWith(this.detach().css({position:"relative",top:s.top-u.top+"px",left:s.left-u.left+"px"})),n.replaceWith(a.detach().css({position:"relative",top:e.top-i.top+"px",left:e.left-i.left+"px"})),_.defer(function(l){return function(){return l.css({top:"",left:""}),a.css({top:"",left:""})}}(this))},$.fn.track_input=function(a,u){var s,i;return s=this.find(a),i=function(e){return function(){var t,r,n;return n=function(){var o,l,c;for(c=[],o=0,l=s.length;o<l;o++)r=s[o],c.push(u+"_"+$(r).attr("value"));return c}(),e.removeClass(n.join(" ")),t=s.serializeArray().map(function(o){return u+"_"+o.value}),e.addClass(t.join(" "))}}(this),s.on("change",function(e){return i()}),i()}}.call(this),function(){var f,a,u,s={}.hasOwnProperty,i=[].slice;window.R||(f={},a=function(e,t){var r;for(r in e)if(s.call(e,r)&&e[r]!==t[r])return!0;for(r in t)if(s.call(t,r)&&!(r in e))return!0;return!1},u={},window.R=function(e,t,r,n){var o,l,c,p,m;return r==null&&(r=R),n==null&&(n=""),r[e]?r[e]._class:(t.trigger=function(){var d;d=$(ReactDOM.findDOMNode(this)),R.trigger.apply(R,[d].concat(i.call(arguments)))},t.dispatch=function(){var d;d=$(ReactDOM.findDOMNode(this)),R.dispatch.apply(R,[d].concat(i.call(arguments)))},t.container=function(){return $(ReactDOM.findDOMNode(this))},t.extend_props=function(){var d;return d=1<=arguments.length?i.call(arguments,0):[],$.extend.apply($,[{},this.props].concat(i.call(d)))},t.tt=function(d,v){var S;return v==null&&(v=f),(S=I.i18n.fetch_key_sync(d))&&_.isString(S)?S:(u[d]||(u[d]=I.i18n.react_class(d)),React.createElement(u[d],v))},t.t=function(d,v){return I.i18n.fetch_key_sync(d)?I.i18n.t_sync(d,v):(I.i18n.fetch_key(d).done(function(S){return function(){if(S.isMounted())return S.forceUpdate()}}(this)),"\u2026")},l=_.once(function(){return(""+n+e).replace(/[A-Z]/g,"_$&").replace(/\./g,"_").replace(/__+/g,"_").replace(/^_+/,"").replace(/_+$/,"").toLowerCase()+"_widget"}),t.enclosing_class_name=l,t.enclose=function(){var d,v,S;return S=arguments[0],d=2<=arguments.length?i.call(arguments,1):[],v=S.component||"div",delete S.component,React.createElement.apply(React,[v,$.extend({},S,{className:classNames(l(),S.className)})].concat(i.call(d)))},t.displayName=""+n+e,t.pure&&(t.shouldComponentUpdate=function(d,v){return a(this.props||f,d)||a(this.state||f,v)}),c=t.getDefaultProps,delete t.getDefaultProps,m=t.propTypes,delete t.propTypes,o=createReactClass(t),c&&(o.defaultProps=c()),m&&(o.propTypes=m),p=React.createElement.bind(null,o),p.type=o,r[e]=p)},R.scope_event_name=function(e){return"itch:"+e},R.trigger=function(){var e,t,r;return r=arguments[0],t=arguments[1],e=3<=arguments.length?i.call(arguments,2):[],r.trigger(R.scope_event_name(t),i.call(e))},R.dispatch=function(e,t,r){var n,o,l;typeof t=="object"&&(r=t,t=!1),l=[];for(n in r)s.call(r,n)&&(o=r[n],t&&(n=t+":"+n),l.push(e.on(R.scope_event_name(n),o)));return l},R.component=function(){return R.apply(null,arguments)},R.is_different=a,R.package=function(e){return function(t){var r;return r=R[t]||(R[t]=function(n,o){return o.Package=r,R.component(n,o,r,t+".")}),r.component=function(){return r.apply(null,arguments)},r}}(this))}.call(this),function(){var f=[].slice,a=function(s,i){for(var e in i)u.call(i,e)&&(s[e]=i[e]);function t(){this.constructor=s}return t.prototype=i.prototype,s.prototype=new t,s.__super__=i.prototype,s},u={}.hasOwnProperty;I.Lightbox=function(){s.include_dependencies=function(i){var e;return i?(e=[],i.redactor&&!$.fn.redactor&&($("head").append(i.redactor),e.push(I.libs.redactor)),i.selectize&&!$.fn.selectize&&($("head").append(i.selectize),e.push(I.libs.selectize)),e):[]},s.lightbox_container=function(){return this._container||(this._container=$("#lightbox_container").exists()||$('<div id="lightbox_container"></div>').appendTo("body"))},s.shroud_container=function(){return this._shroud||(this._shroud=$("#lightbox_shroud").exists()||$('<div id="lightbox_shroud"></div>').appendTo("body"))},s.show_shroud=function(){var i;if(!this.shroud_visible)return this._shroud||(i=this.shroud_container(),this.lightbox_container().on("click",function(e){return function(t){if(!$(t.target).closest(".lightbox").length)return $(t.target).attr("href")==="javascript:void(0)"?void 0:e.close()}}(this)),i.on("click",function(e){return function(){return e.close()}}(this)),$(document.body).on("keydown",function(e){return function(t){return t.keyCode===27?(t.preventDefault(),t.stopPropagation(),e.close()):e.on_keydown(t)}}(this)),$(window).on("resize",function(e){return function(t){return e.on_resize(t)}}(this))),this.shroud_visible=!0,this.shroud_container().addClass("invisible").show(),_.defer(function(e){return function(){return e.shroud_container().removeClass("invisible")}}(this))},s.hide_shroud=function(){return this.shroud_visible=!1,this.shroud_container().hide()},s.open_loading=function(){return this.open_tpl("loading_lightbox",I.Lightbox)},s.open_remote_react=function(i,e){return this.open_loading(),$.when(I.add_react(),$.ajax({dataType:"json",url:i,data:{props:!0},xhrFields:{withCredentials:!0},error:function(t){return function(r,n,o){var l,c,p;return p=function(){try{return JSON.parse(r.responseText)}catch(m){}}(),l=(c=p!=null?p.errors:void 0)!=null?c:["Something went wrong. Please try again later and contact support if it persists."],R.ErrorLightbox?I.Lightbox.open(R.ErrorLightbox({errors:l})):(alert(props.errors.join(",")),t.close())}}(this)})).done(function(t){return function(r,n){var o,l;if(l=n[0],l.errors){R.ErrorLightbox?I.Lightbox.open(R.ErrorLightbox(l)):(alert(l.errors.join(",")),t.close());return}return o=I.Lightbox.include_dependencies(l._dependencies),$.when.apply($,[e(l)].concat(f.call(o))).then(function(c){return c?I.Lightbox.open(c):t.close()})}}(this))},s.open_remote=function(){var i,e,t;return t=arguments[0],i=arguments[1],e=3<=arguments.length?f.call(arguments,2):[],i==null&&(i=I.Lightbox),this.open_loading(),$.ajax({dataType:"json",url:t,data:{lightbox:!0},xhrFields:{withCredentials:!0},success:function(r){return function(n){if(n.errors){alert(n.errors.join(",")),r.close();return}return r.open.apply(r,[n.content,i].concat(f.call(e)))}}(this),error:function(r){return function(n,o,l){return alert("Something went wrong. Please try again later and contact support if it persists."),r.close()}}(this)})},s.open_tpl=function(){var i,e,t;if(t=arguments[0],i=2<=arguments.length?f.call(arguments,1):[],e=$("#"+t+"_tpl"),!e.length)throw"missing template for lightbox: "+t;return this.open.apply(this,[e.html()].concat(f.call(i)))},s.open_tpl_with_params=function(){var i,e,t,r,n;if(n=arguments[0],r=arguments[1],i=3<=arguments.length?f.call(arguments,2):[],e=$("#"+n+"_tpl"),!e.length)throw"missing template for lightbox: "+n;return t=_.template(e.html())(r),this.open.apply(this,[t].concat(f.call(i)))},s.open=function(){var i,e,t,r,n,o;return t=arguments[0],i=arguments[1],e=3<=arguments.length?f.call(arguments,2):[],i==null&&(i=I.Lightbox),this.current_lightbox&&(this.current_lightbox.close(),this.current_lightbox=null),o=!1,t.$$typeof?(o=!0,r=new I.ReactLightbox(t,this)):(typeof t=="string"&&(t=$.trim(t)),n=$(t),(r=n.data("object"))||(o=!0,r=function(l,c,p){p.prototype=l.prototype;var m=new p,d=l.apply(m,c);return Object(d)===d?d:m}(i,[n,this].concat(f.call(e)),function(){}),n.data("object",r))),$(document.body).addClass("lightbox_open"),this.show_shroud(),r.show(o),this.current_lightbox=r,r},s.close=function(){var i;if(!(this.current_lightbox&&!this.current_lightbox.is_closable())&&!(this.current_lightbox&&this.current_lightbox.el.is(".has_changes")&&!confirm("You've have unsaved changes in this dialog. Are you sure you want to close it?")))return this.hide_shroud(),(i=this.current_lightbox)!=null&&i.close(),this.current_lightbox=null,$(document.body).removeClass("lightbox_open")},s.on_keydown=function(i){var e,t;return(e=this.current_lightbox)!=null&&(t=e.el)!=null?t.trigger("i:lightbox_keydown",i):void 0},s.on_resize=function(i){var e,t;return(e=this.current_lightbox)!=null&&(t=e.el)!=null?t.trigger("i:lightbox_resize",i):void 0},s.prototype.lightbox_hidden=function(i){};function s(){var i,e,t;i=arguments[0],e=arguments[1],t=3<=arguments.length?f.call(arguments,2):[],this.parent=e,this.el=$(i),this.el.on("click",".close_button, .close_btn",function(r){return function(n){return I.Lightbox.close(),!1}}(this)),this.init.apply(this,t)}return s.prototype.init=function(){},s.prototype.first_show=function(){},s.prototype.with_selectize=function(i){var e;if(!$.fn.selectize){if(e=this.el.data().selectize,!e)throw"missing selectize include in lightbox";$("head").append(e)}return I.with_selectize(i)},s.prototype.with_redactor=function(i){var e;if(!$.fn.redactor){if(e=this.el.data().redactor,!e)throw"missing redactor include in lightbox";$("head").append(e)}return I.with_redactor(i)},s.prototype.show=function(i){if(this.el.appendTo(this.parent.lightbox_container()).addClass("animated").show().trigger("i:lightbox_open"),this.position(),i)return this.first_show()},s.prototype.close=function(){return this.el.removeClass("animated").hide().trigger("i:lightbox_close").remove()},s.prototype.position=function(){var i;return i=this.parent.lightbox_container().css("position")==="fixed"?"":$(window).scrollTop()+"px",this.el.css({top:i})},s.prototype.closable=!0,s.prototype.is_closable=function(){return this.closable},s}(),I.ReactLightbox=function(s){a(i,s);function i(){var e,t,r,n,o,l;e=arguments[0],r=arguments[1],o=3<=arguments.length?f.call(arguments,2):[],l=$('<div class="react_lightbox"></div>').appendTo(r.lightbox_container()),n=ReactDOM.render(e,l[0]),t=ReactDOM.findDOMNode(n),i.__super__.constructor.apply(this,[t,r].concat(f.call(o)))}return i.prototype.show=function(e){return this.el.addClass("animated"),this.position()},i.prototype.close=function(){var e;return this.el.trigger("i:lightbox_close"),e=this.el.parent(),ReactDOM.unmountComponentAtNode(e[0]),e.remove()},i}(I.Lightbox)}.call(this),function(){var f=function(u,s){for(var i in s)a.call(s,i)&&(u[i]=s[i]);function e(){this.constructor=u}return e.prototype=s.prototype,u.prototype=new e,u.__super__=s.prototype,u},a={}.hasOwnProperty;I.CollectionLightbox=function(u){f(s,u);function s(){return s.__super__.constructor.apply(this,arguments)}return s.prototype.init=function(){var i;return I.has_follow_button(this.el),I.event2("view add to collection lightbox"),this.el.find("input[type='radio']:first").prop("checked",!0),this.el.on("click change",".collection_option",function(e){return function(t){var r;return r=$(t.currentTarget),r.find("input[type='radio']").prop("checked",!0)}}(this)),i=this.el.find("form").remote_submit(function(e){return function(t){if(t.errors){if(I.add_recaptcha_if_necessary(i,t.errors))return;i.set_form_errors(t.errors);return}return e.el.addClass("is_complete"),e.el.find(".after_submit .collection_name").text(t.title).attr("href",t.url)}}(this)),this.with_redactor(function(e){return function(){return I.redactor(e.el.find("textarea"),{minHeight:40,source:!1,buttons:["bold","italic","deleted","lists","link"]})}}(this)),this.with_selectize(function(e){return function(){return e.el.find("select.collection_input").selectize()}}(this))},s}(I.Lightbox)}.call(this),function(){var f=function(u,s){for(var i in s)a.call(s,i)&&(u[i]=s[i]);function e(){this.constructor=u}return e.prototype=s.prototype,u.prototype=new e,u.__super__=s.prototype,u},a={}.hasOwnProperty;I.AfterDownloadLightbox=function(u){f(s,u);function s(){return s.__super__.constructor.apply(this,arguments)}return s.prototype.init=function(i,e){var t;return this.game=i,e==null&&(e={}),I.event(e.page_name||"view_game","after_download_lb",""+this.game.id),t=this.el.find(".game_grid_widget"),new I.GameGrid(t,{expected_size:240}),I.setup_grid_referrers(this.el,function(r){return function(){return"after_download:"+r.game.id}}(this)),I.tracked_links(this.el,"after_download_lb"),I.has_follow_button(this.el)},s}(I.Lightbox)}.call(this),function(){var f=function(s,i){return function(){return s.apply(i,arguments)}},a=function(s,i){for(var e in i)u.call(i,e)&&(s[e]=i[e]);function t(){this.constructor=s}return t.prototype=i.prototype,s.prototype=new t,s.__super__=i.prototype,s},u={}.hasOwnProperty;I.BaseBuyForm=function(){s.prototype.event_category="buy_form",s.prototype.pay_in_popup=!1,s.prototype.min_price=100;function s(i,e){var t,r;this.opts=e!=null?e:{},this.billing_address_valid=f(this.billing_address_valid,this),this.show_billing_address_form=f(this.show_billing_address_form,this),this.show_vat_form=f(this.show_vat_form,this),this.submit_handler=f(this.submit_handler,this),this.checkout_btn_handler=f(this.checkout_btn_handler,this),this.set_fingerprint=f(this.set_fingerprint,this),this.el=$(i),this.el.find("input[name=csrf_token][value='']").val($("meta[name=csrf_token]").attr("value")),this.form=this.el.find("form"),this.opts=$.extend({},this.form.data("opts"),this.opts),this.set_fingerprint(),this.input=this.form.find("input.money_input"),this.input.length&&I.money_input(this.input),this.form.on("submit",function(n){return function(){return n.submit_handler.apply(n,arguments)}}(this)),this.el.dispatch("click",{add_btn:function(n){return function(o){var l;return l=+o.attr("data-amount"),n.track_add_btn(l),n.input.val(I.format_money(n.get_value()+l,n.get_currency())),n.update_items()}}(this),billing_back_btn:function(n){return function(){return n.form.find(".checkout_btn").prop("disabled",!1),n.form.removeClass("show_billing_address_form")}}(this),vat_back_btn:function(n){return function(){return n.form.removeClass("show_vat_confirm"),n.show_billing_address_form()}}(this),direct_download_btn:function(n){return function(){return n.direct_download()}}(this),save_billing_btn:function(n){return function(o){if(n.billing_address_valid())return n.opts.collect_vat?n.show_vat_form():n.form.submit()}}(this),confirm_vat_btn:function(n){return function(o){return n.form.submit()}}(this)}),this.el.on("click",".checkout_btn",function(n){return function(o){return n.checkout_btn_handler(o)}}(this)),this.el.format_timestamps(),(r=this.opts.pick_source)&&(t=this.opts.pick_medium||"default",this.el.find("[data-source='"+r+"'][data-medium='"+t+"']").click())}return s.prototype.set_fingerprint=function(){return window.Fingerprint2?(this.set_fingerprint=function(){},new Fingerprint2().get(function(i){return function(e){if(e)return i.form.find(".bp_input").val(e)}}(this))):!1},s.prototype.checkout_btn_handler=function(i){var e;if(e=this.set_source(i),this.opts.collect_billing_address)return this.is_valid()&&this.show_billing_address_form(),!1},s.prototype.submit_handler=function(){if(!this.is_valid())return!1;if(this.form.attr("target")==="_blank")return this.form.removeClass("show_vat_confirm show_billing_address_form").addClass("show_purchase_complete")},s.prototype.show_vat_form=function(){var i,e,t;if(!this.form.is(".show_billing_address_form"))throw"billing form not visible";return e=this.form.addClass("loading").find(".billing_address_view").find("input[type='text'], select, button"),e.prop("disabled",!0),t=this.form.find("[name='price']").val(),i=this.form.find("[name='address[country]']").val(),$.ajax({type:"GET",url:this.opts.tax_preview_url,data:{sub_product_id:this.opts.sub_product_id,price:t,country:i},async:!1}).then(function(r){return function(n){var o,l,c,p,m,d,v;if(e.prop("disabled",!1),r.form.removeClass("loading has_vat_error"),n.errors){switch(o=n.errors[0],o){case"country mismatch":I.event(r.event_category,"vat","country_mismatch"),r.form.removeClass("show_billing_address_form").addClass("show_vat_confirm has_vat_error");break;default:I.event(r.event_category,"error",JSON.stringify(n.errors)),r.form.find(".generic_error_description").text(n.errors[0]),r.form.removeClass("show_billing_address_form").addClass("show_vat_confirm has_generic_error")}return}if(!n.rate||n.tax===0){r.form.submit();return}for(r.form.removeClass("show_billing_address_form").addClass("show_vat_confirm"),r._seen_vat||(I.event(r.event_category,"vat","show_tax_preview"),r._seen_vat=!0),v=r.form.find(".vat_view"),d=v.find("[data-field]"),p=0,m=d.length;p<m;p++)c=d[p],l=$(c),l.text(n[l.data("field")]||"");return v.toggleClass("no_tip",!n.tip||n.tip===0)}}(this))},s.prototype.show_billing_address_form=function(){return this._seen_billing||(I.event(this.event_category,"vat","show_billing"),this._seen_billing=!0),this.form.find(".checkout_btn").prop("disabled",!0),this.form.addClass("show_billing_address_form")},s.prototype.set_source=function(i){var e,t,r;return e=$(i.currentTarget).closest(".checkout_btn"),e.length||(e=(this._checkout_btns||(this._checkout_btns=this.form.find(".checkout_btn"))).first()),r=e.data("source"),(this._source_input||(this._source_input=this.form.find(".source_input"))).val(r),t=e.data("medium"),(this._medium_input||(this._medium_input=this.form.find(".medium_input"))).val(t||""),r},s.prototype.set_loading=function(i){return this.form.toggleClass("loading",i),this.el.toggleClass("loading",i),this.input.prop("disabled",i),(this.add_buttons||(this.add_buttons=this.form.find(".add_btn"))).toggleClass("disabled",i),this.el.triggerHandler("i:loading",i)},s.prototype.has_money_input=function(){return!!this.input.length},s.prototype.get_value=function(){return I.parse_money(this.input.val())},s.prototype.get_currency=function(){return this.input.data("currency")},s.prototype._clean_error_message=function(i){return i==="paypal failed"&&(i="Failed to create PayPal transaction, please try again later."),i},s.prototype.set_error=function(i){return i=this._clean_error_message(i),this.error_text||(this.error_text=this.el.find(".error_text")),i?(this.form.addClass("has_error"),this.error_text.text(i)):this.form.removeClass("has_error")},s.prototype.remote_submit=function(i){var e,t,r;return this.is_valid()&&(e=this.form.serializeArray(),e.push({name:"json",value:"true"}),this.set_loading(!0),this.track_remote_submit(),this.pay_in_popup&&(t=window.open(),(r=t.document)!=null&&r.write("Loading..."),_.defer(function(n){return function(){var o;return(o=t.document)!=null?o.title="Loading...":void 0}}(this))),this.el.trigger("i:buy_start",[e]),$.ajax({url:this.form.attr("action"),type:"POST",data:e,xhrFields:{withCredentials:!0},success:function(n){return function(o){return o.url?(t?(t.location=o.url,n.set_loading(!1)):window.top.location=o.url,n.el.trigger("i:buy_complete",[o])):(t&&t.close(),n.form.removeClass("show_billing_address_form show_vat_confirm"),n.set_error(o.errors.join(",")),n.set_loading(!1))}}(this)})),!1},s.prototype.is_valid=function(){var i;return this.has_money_input()&&(i=this.get_value(),i<this.min_price)?(this.set_error("Due to processing fees the minimum amount is 100 cents."),!1):(this.set_error(),!0)},s.prototype.billing_address_valid=function(){return this.el.find(".billing_address_form_widget").data("object").check_valid()},s.prototype.track_add_btn=function(i){},s.prototype.track_remote_submit=function(){},s.prototype.update_items=function(){},s}(),I.BuyForm=function(s){a(i,s),i.prototype.download_url=function(){return I.subdomain?"/"+this.game.slug+"/download_url":"/game/download_url/"+this.game.id},i.prototype.track_add_btn=function(e){return I.event(this.event_category,"add_"+e,""+this.game.id)},i.prototype.track_remote_submit=function(){return I.event(this.event_category,"purchase",""+this.game.id,this.get_value())};function i(e,t,r){var n;this.game=t,this.setup_filelist=f(this.setup_filelist,this),this.download_url=f(this.download_url,this),i.__super__.constructor.call(this,e,r),this.setup_filelist(),this.pay_in_popup=(n=r!=null?r.pay_in_popup:void 0)!=null?n:this.game.type_name!=="default",this.pay_in_popup||(this.pay_in_popup=$("base[target]").attr("target")==="_blank")}return i.prototype.update_items=function(){var e,t,r,n,o,l,c,p;if((l=this.file_list)!=null&&l.length){for(p=p||this.get_value(),t=this.file_list.find(".file_row"),c=[],r=0,n=t.length;r<n;r++)e=t[r],e=$(e),o=e.data("min_price"),c.push(e.toggleClass("inactive",!!(o&&p<o)));return c}},i.prototype.setup_filelist=function(){if(this.file_list=this.el.find(".file_list"),!!this.file_list.length)return this.el.on("keyup blur",".money_input",function(e){return function(){return e.update_items()}}(this)),this.file_list.on("click",".inactive",function(e){return function(t){var r,n;if(I.event(e.event_category,"pick_file",""+e.game.id),n=$(t.currentTarget),r=n.data("min_price"),r)return e.el.trigger("i:show_checkout"),e.input.val(I.format_money(r,e.get_currency())),e.update_items()}}(this)),this.el.find(".file_size_value").html(function(){return I.format_bytes(parseInt($(this).html(),10))}),this.update_items()},i.prototype.direct_download=function(){var e;return I.event(this.event_category,"skip_buy",""+this.game.id),this.set_loading(!0),this.pay_in_popup&&(e=window.open(),e.document.write("Loading..."),_.defer(function(t){return function(){return e.document.title="Loading..."}}(this))),$.ajax({url:this.download_url(),type:"POST",xhrFields:{withCredentials:!0},data:I.with_csrf({reward_id:this.opts.reward_id}),success:function(t){return function(r){return r.url?e?(e.location=r.url,t.set_loading(!1)):window.top.location=r.url:(t.set_error("There was an error generating the download URL, please try again."),t.set_loading(!1))}}(this)})},i.prototype.is_valid=function(){var e,t;if(this.has_money_input()&&(t=this.get_value(),!this.opts.is_donate)){if(t===0&&this.game.actual_price===0)return this.set_error(),this.direct_download(),!1;if(t<this.game.actual_price)return e=I.format_money(this.game.actual_price,this.get_currency()),this.set_error("You must pay at least "+e+"."),!1}if(i.__super__.is_valid.call(this))return!0},i}(I.BaseBuyForm),I.BundleBuyForm=function(s){a(i,s),i.prototype.event_category="bundle_buy_form";function i(e,t,r){this.bundle=t,this.setup_gamelist=f(this.setup_gamelist,this),this.download_url=f(this.download_url,this),i.__super__.constructor.call(this,e,r),this.setup_gamelist()}return i.prototype.download_url=function(){return"/bundle/"+this.bundle.id+"/download_url"},i.prototype.direct_download=function(){return I.event(this.event_category,"skip_buy",""+this.bundle.id),this.set_loading(!0),$.ajax({url:this.download_url(),type:"POST",xhrFields:{withCredentials:!0},data:I.with_csrf(),success:function(e){return function(t){return t.url?window.top.location=t.url:(e.set_error("There was an error generating the download URL, please try again."),e.set_loading(!1))}}(this)})},i.prototype.setup_gamelist=function(){if(this.game_list=this.el.find(".game_list"),!!this.game_list.length)return this.el.on("keyup blur",".money_input",function(e){return function(){return e.update_items()}}(this)),this.game_list.on("click",".inactive",function(e){return function(t){var r,n;if(I.event(e.event_category,"pick_game",""+e.bundle.id),n=$(t.currentTarget),r=n.data("min_price"),r)return e.el.trigger("i:show_checkout"),e.input.val(I.format_money(r,e.get_currency())),e.update_items()}}(this)),this.update_items()},i.prototype.update_items=function(){var e,t,r,n,o,l,c,p,m,d;if((m=this.game_list)!=null&&m.length){for(d=this.get_value(),n=this.game_list.find(".game_row"),t=0,l=0,c=n.length;l<c;l++)r=n[l],r=$(r),p=r.data("min_price"),e=!(p&&d<p),r.toggleClass("inactive",!e),e&&(t+=1);if(o=this.el.find(".game_list_header_drop")[0],o)return ReactDOM.render(R.BundleBuyForm.AvailableItems({tiers:this.bundle.tiers,group_noun:this.bundle.group_noun,price:d,currency:this.get_currency()}),o)}},i.prototype.is_valid=function(){var e,t;if(t=this.get_value(),t<this.bundle.actual_price)return e=I.format_money(this.bundle.actual_price,this.get_currency()),this.set_error("You must pay at least "+e+"."),!1;if(i.__super__.is_valid.call(this))return!0},i}(I.BaseBuyForm),I.BuyPopup=function(s){a(i,s);function i(){i.__super__.constructor.apply(this,arguments),this.check_height(),this.pay_in_popup=!1}return i.prototype.check_height=function(){var e,t,r;if(t=32,r=$(window),e=$(document.body).height()+t-$(window).height(),e>0)return window.resizeTo(window.outerWidth,window.outerHeight+e)},i}(I.BuyForm),I.BillingAddressForm=function(){function s(i){this.check_valid=f(this.check_valid,this);var e,t;this.el=$(i),this.el.data("object",this),e=this.el.find("[data-country_value]"),e.length&&(t=e.find("select"),t.find("[value='"+e.data("country_value")+"']").prop("selected",!0))}return s.prototype.check_valid=function(){var i,e,t,r,n,o,l,c;for(o=this.el.find("input[required]"),i=0,t=o.length;i<t;i++)e=o[i],e=$(e),l=e.val(),e.toggleClass("has_error",!!l.match(/^\s*$/)),(n=e.attr("pattern"))&&(r=new RegExp("^"+n+"$"),e.toggleClass("has_error",!l.match(r)));return c=this.el.find(".has_error").length===0,this.el.toggleClass("has_errors",!c),c},s}()}.call(this),function(){var f=function(a,u){return function(){return a.apply(u,arguments)}};I.GameCarousel=function(){a.prototype.edge_threshold=5,a.prototype.margin=20,a.prototype.inner_padding=10,a.prototype.paddle_margin_bottom=30,a.prototype.cell_class=".game_cell",a.prototype.add_image_loading=function(){return this.el.lazy_images({show_item:function(u){return function(s){return s.trigger("i:impression"),s.find(".image_loading").addBack(".image_loading").removeClass("image_loading")}}(this)})};function a(u,s){this.add_image_loading=f(this.add_image_loading,this),this.el=$(u),$.extend(this,s),this.scroll_outer=this.el.find(".scrolling_outer"),this.scroll_inner=this.el.find(".scrolling_inner"),this.paddles=this.el.find(".paddle_next, .paddle_prev"),I.is_mobile()?(this.el.find(".scrollbar_outer").remove(),this.paddles.remove()):this.setup_scrollbar(),new I.GameCells(this.el),_.defer(function(i){return function(){return i.add_image_loading()}}(this)),this.el.dispatch("click",{paddle_next:function(i){return function(e){return i.scroll_to(i.cell_offset(i.current_cell()+3)),e.trigger("i:track_link")}}(this),paddle_prev:function(i){return function(e){return i.scroll_to(i.cell_offset(i.current_cell()-3)),e.trigger("i:track_link")}}(this)}),this.update_height(),$(window).on("resize",_.debounce(function(i){return function(){return i.update_scrollbar()}}(this),100)),this.el.on("i:carousel:update_scrollbar",function(i){return function(){return i.update_scrollbar()}}(this)),_.defer(function(i){return function(){return i.el.addClass("ready"),i.update_height()}}(this))}return a.prototype.tallest_child=function(){var u,s,i,e,t,r,n,o;for(n=null,o=null,r=this.scroll_inner.children(),i=e=0,t=r.length;e<t;i=++e)u=r[i],u=$(u),n?(s=u.outerHeight(!0),s>o&&(n=u,o=s)):(n=u,o=u.outerHeight(!0));return n},a.prototype.update_height=function(){var u,s;return s=this.tallest_child(),u=s.outerHeight(!0),u+=this.inner_padding*2,this.scroll_outer.css({height:u+"px"}),this.paddles.css({height:u-this.paddle_margin_bottom+"px"}),this.update_scrollbar()},a.prototype.setup_scrollbar=function(){return this.have_scrollbar=!0,this.scrollbar_outer=this.el.find(".scrollbar_outer"),this.scrollbar_inner=this.el.find(".scrollbar_inner"),this.scroll_inner.on("scroll",function(u){return function(){return u.update_scrollbar()}}(this)),this.scrollbar_inner.draggable({move:function(u){return function(s,i){if(u.unit_scroll)return u.scroll_inner[0].scrollLeft+=s*u.unit_scroll}}(this)}),this.update_scrollbar()},a.prototype.current_cell=function(){var u,s,i,e,t,r;for(s=this.el.find(this.cell_class),i=Math.floor(s.width()/2),e=t=0,r=s.length;t<r;e=++t)if(u=s[e],$(u).position().left+i>=0)return e;return 0},a.prototype.cell_offset=function(u){var s,i,e;return u=Math.max(0,u),s=this.el.find(this.cell_class+":eq("+u+")"),i=this.max_scroll(),e=s.length?s.position().left+this.scroll_pos()-this.margin:i,Math.min(e,i)},a.prototype.scroll_to=function(u){var s,i;if(!this.scroll_inner.is(":animated"))return s=this.scroll_pos(),i=Math.abs(s-u),this.scroll_inner.animate({scrollLeft:u},i/2)},a.prototype.scroll_pos=function(){return this.scroll_inner[0].scrollLeft},a.prototype.max_scroll=function(){return this.scroll_inner[0].scrollWidth-this.scroll_outer.innerWidth()},a.prototype.update_scrollbar=function(){var u,s,i,e;if(this.have_scrollbar)return i=this.scroll_outer.innerWidth(),s=this.scroll_inner[0].scrollWidth,u=s-i>this.edge_threshold,this.el.toggleClass("no_scrollbar",!u),u?(e=this.scroll_pos(),this.scrollbar_inner.css({width:100*i/s+"%",left:100*e/s+"%"}),this.unit_scroll=s/this.scroll_outer.width(),this.el.toggleClass("on_left",e<=this.edge_threshold),this.el.toggleClass("on_right",e>=this.max_scroll()-this.edge_threshold)):this.el.removeClass("on_left on_right")},a}()}.call(this),function(){var f,a,u,s,i,e,t,r,n,o,l,c,p,m,d,v,S=[].slice;o=function(b,g,w){return b<0?b+=1:b>1&&(b-=1),6*b<1?g+(w-g)*6*b:2*b<1?w:3*b<2?g+(w-g)*(2/3-b)*6:g},u=function(b,g,w){var k,C,T,D,j;return b=b/360,g=g/100,w=w/100,g===0?(T=w,C=w,k=w):(j=w<.5?w*(1+g):w+g-w*g,D=2*w-j,T=o(b+1/3,D,j),C=o(b,D,j),k=o(b-1/3,D,j)),[T*255,C*255,k*255]},l=function(b,g,w){var k,C,T,D,j;return b=b/255,g=g/255,w=w/255,D=Math.min(b,g,w),T=Math.max(b,g,w),j=0,k=0,C=(D+T)/2,D!==T&&(j=C<.5?(T-D)/(T+D):(T-D)/(2-T-D),k=function(){switch(T){case b:return(g-w)/(T-D);case g:return 2+(w-b)/(T-D);case w:return 4+(b-g)/(T-D)}}()),k<0&&(k+=6),[k*60,j*100,C*100]},e=function(){var b,g,w,k,C,T,D,j,A,W,V;if(W=arguments[0],j=2<=arguments.length?S.call(arguments,1):[],k="[a-fA-f0-9]",C=k+k,V="^#("+k+")("+k+")("+k+")$",A="^#("+C+")("+C+")("+C+")$",T=W.match(new RegExp(V)),T)b=T[0],D=T[1],w=T[2],g=T[3],D+=D,w+=w,g+=g;else{if(T=W.match(new RegExp(A)),!T)return null;b=T[0],D=T[1],w=T[2],g=T[3]}return[parseInt(D,16),parseInt(w,16),parseInt(g,16)]},t=function(){var b;return b=e.apply(null,arguments),b||[0,0,0]},f=function(b){var g;return g=Math.floor(b).toString(16),g.length===1?"0"+g:g},a=function(b,g,w){return b=Math.min(255,Math.max(0,b)),g=Math.min(255,Math.max(0,g)),w=Math.min(255,Math.max(0,w)),"#"+f(b)+f(g)+f(w)},m=function(b,g,w){var k,C,T,D,j;return g==null&&(g=15),w==null&&(w=.8),D=l.apply(null,t(b)),k=D[0],j=D[1],C=D[2],T=C>50?C-g:C+g,T=Math.max(0,Math.min(100,T)),a.apply(null,u(k,j*w,T))},s=function(b,g,w){return(.299*b+.587*g+.114*w)/255},n=function(b,g,w){return b=b/255,g=g/255,w=w/255,b=b<=.03928?b/12.92:Math.pow((b+.055)/1.055,2.4),g=g<=.03928?g/12.92:Math.pow((g+.055)/1.055,2.4),w=w<=.03928?w/12.92:Math.pow((w+.055)/1.055,2.4),.2126*b+.7152*g+.0722*w},c=function(b,g,w){var k,C,T;return T=.299*b+.587*g+.114*w,k=(w-T)*.565,C=(b-T)*.713,[T,k,C]},v=function(b,g,w){var k,C,T;return T=b+1.403*w,C=b-.344*g-.714*w,k=b+1.77*g,[T,C,k]},p=function(b,g,w,k){var C,T,D,j;return k==null&&(k=.1),C=c(b,g,w),j=C[0],T=C[1],D=C[2],k<0?j+=k*j:j+=k*(255-j),v(j,T,D)},r=function(b,g,w){var k,C;return typeof b=="string"&&(k=t(b),b=k[0],g=k[1],w=k[2]),C=n(b,g,w),C>=.45?i(a(b,g,w),"#000000",.2):"#ffffff"},d=function(b,g,w){var k,C,T,D,j;return g==null&&(g=.15),w==null&&(w=.5),j=t(b),D=j[0],C=j[1],k=j[2],T=s(D,C,k),T<w?a.apply(null,p(D,C,k,g)):a.apply(null,p(D,C,k,-g))},i=function(b,g,w){var k,C,T,D,j,A,W,V,J;return w===1?b:w===0?g:(V=t(b),A=V[0],D=V[1],C=V[2],J=t(g),W=J[0],j=J[1],T=J[2],k=1-w,a(A*w+W*k,D*w+j*k,C*w+T*k))},I.Color={hsl_to_rgb:u,rgb_to_hsl:l,parse_color:e,parse_color_safe:t,hex_color:a,sub_color:m,luma:s,relative_luma:n,rgb_to_yuv:c,yuv_to_rgb:v,scale_luma:p,readable_text_color:r,sub_color2:d,mix_color:i}}.call(this),function(){I.ContentWarning=function(){function f(a,u){this.opts=u,this.el=$(a),this.setup_forms()}return f.prototype.setup_forms=function(){var a;return a=this.el.find("form"),a.remote_submit(function(u){return function(s){if(s.errors){a.set_form_errors(s.errors);return}return u.el.addClass("hidden"),setTimeout(function(){return u.el.remove()},300),a.set_form_errors([])}}(this))},f}()}.call(this),function(){var f=[].slice;I.ConversionTracker=function(){function a(){}return a.types={impression:1,click:2,purchase:3,download:4,join:5},a.buffer=[],a.find_click=function(u){var s,i,e,t,r,n;for(n=new RegExp(":"+u+"$"),s=this.get_cookie(),e=0,r=s.length;e<r;e++)if(t=s[e],i=_.isArray(t)?t[0]:t,i.match(n))return t},a.strip_click=function(u){var s,i,e,t,r,n;return r=new RegExp(":"+u+"$"),s=this.get_cookie(),n=0,t=function(){var o,l,c;for(c=[],o=0,l=s.length;o<l;o++){if(e=s[o],i=_.isArray(e)?e[0]:e,i.match(r)){n+=1;continue}c.push(e)}return c}(),t.length===s.length?0:(this.write_cookie(t),n)},a.after_click_action=function(u,s){var i,e,t,r;if(i=this.find_click(s),!!i)return r=null,t=_.isArray(i)?(r=i[1],i[0]):i,e=t.replace(/^\d+/,this.types[u]),this.strip_click(s),this.push(e,r),!0},a.download=function(u){return this.after_click_action("download",u)},a.purchase=function(u){return this.after_click_action("purchase",u)},a.join=function(u){return this.after_click_action("join",u)},a.click=function(u){var s,i,e,t,r,n;e=this.types.click+":"+u,t=(n=this.get_active_splits())?[e,n]:e,this.push(e);try{for(i=function(){var o,l,c,p;for(c=this.get_cookie(),p=[],o=0,l=c.length;o<l;o++)s=c[o],r=_.isArray(s)?s[0]:s,r!==e&&p.push(s);return p}.call(this),i.push(t);i.length>100;)i.shift();return this.write_cookie(i),!0}catch(o){}},a.write_cookie=function(u){return I.set_cookie("itchio_ca",JSON.stringify(u),{expires:1})},a.get_cookie=function(){var u;if(u=Cookies.get("itchio_ca"),u)try{return JSON.parse(u)||[]}catch(s){try{return JSON.parse(decodeURIComponent(u))||[]}catch(i){return[]}}else return[]},a.flush_later=function(){return this.flush_later=_.throttle(this.flush_now,2e3,{leading:!1}),$(window).on("beforeunload",function(u){return function(){u.flush_now()}}(this)),this.flush_later()},a.encode_buffer=function(u){var s,i,e,t,r,n,o,l,c,p,m,d,v,S,b;for(u==null&&(u=f.call(this.buffer)),u.sort(),m=[],o=null,n=null,r=null,e=0,l=u.length;e<l;e++)i=u[e],v=i.match(/^(\d+):(\d+):(\d+):(\d+)$/),s=v[0],b=v[1],S=v[2],p=v[3],c=v[4],b&&(b!==o&&(m.push("t"+b),o=b),S!==n&&(m.push("s"+S),n=S),p!==r&&(m.push("o"+p),r=p),t=(+c).toString(36),d=String.fromCharCode("A".charCodeAt(0)+t.length),m.push(""+d+t));return m.join("")},a.get_active_splits=function(){return I.active_splits},a.flush_url=function(u){var s,i,e;return e=this.encode_buffer(),s=[{name:"x",value:e}],(i=u||this.get_active_splits())&&s.push({name:"s",value:i.join(",")}),I.root_url("ca.gif")+"?"+$.param(s)},a.flush_now_beacon=function(u){var s;if(navigator.sendBeacon==null)return this.flush_now(u);if(this.buffer.length)if(I.in_dev&&console.debug.apply(console,["ca(beacon)"].concat(f.call(_.compact([this.buffer,u])))),s=this.flush_url(u),navigator.sendBeacon(s))this.buffer=[];else return this.flush_now();return $.when()},a.flush_now=function(u){var s;return this.buffer.length?(I.in_dev&&console.debug.apply(console,["ca"].concat(f.call(_.compact([this.buffer,u])))),s=this.flush_url(u),this.buffer=[],$.Deferred(function(i){return function(e){var t,r;return r=new Image,r.src=s,t=function(){return e.resolve()},r.onerror=t,r.onload=t}}(this))):$.when()},a.push=function(u,s){var i;return this.buffer=function(){var e,t,r,n;for(r=this.buffer,n=[],e=0,t=r.length;e<t;e++)i=r[e],i!==u&&n.push(i);return n}.call(this),this.buffer.push(u),this.buffer.length>50||s?this.flush_now(s):this.flush_later()},a}()}.call(this),function(){var f=function(s,i){return function(){return s.apply(i,arguments)}},a=function(s,i){for(var e in i)u.call(i,e)&&(s[e]=i[e]);function t(){this.constructor=s}return t.prototype=i.prototype,s.prototype=new t,s.__super__=i.prototype,s},u={}.hasOwnProperty;I.Countdown=function(){s.prototype.max_blocks=4;function s(i,e,t){this.date=e,this.opts=t!=null?t:{},this.opts.max_blocks&&(this.max_blocks=this.opts.max_blocks),this.el=$(i),this.update_countdown(),window.setInterval(function(r){return function(){return r.update_countdown()}}(this),1e3)}return s.prototype.update_countdown=function(){var i,e,t,r,n,o,l,c,p,m,d,v,S,b,g,w,k,C;for(d=["years","months","days","hours","minutes","seconds"],i=dayjs.duration(I.parse_timestamp(this.date)-new Date),e=!0,k=function(){var T,D,j;for(j=[],T=0,D=d.length;T<D;T++)p=d[T],C=i[p](),!(C===0&&e)&&(C>0&&(e=!1),j.push([p,C]));return j}(),k=k.slice(0,this.max_blocks),S={},t=0,l=k.length;t<l;t++)v=k[t],p=v[0],w=v[1],S[p]=w;for(b=[],r=0,c=d.length;r<c;r++)p=d[r],m=this.el.find("[data-name='"+p+"']"),C=S[p]||0,g=S[p]==null,g||(n=m.find(".block_label"),o=n.text(),n.text(o.replace(/s$/,"")+(C===1?"":"s"))),b.push(m.toggleClass("hidden",g).find(".block_value").text(C));return b},s}(),I.TimestampCountdown=function(s){a(i,s);function i(){return this.update_countdown=f(this.update_countdown,this),i.__super__.constructor.apply(this,arguments)}return i.prototype.update_countdown=function(){var e;return e=I.parse_timestamp(this.date)-new Date,e<0&&(e=-e),this.el.text(I.format_duration(e,1,!1))},i}(I.Countdown)}.call(this),function(){$.fn.draggable=function(f){var a,u,s,i,e,t,r,n;return f==null&&(f={}),n="ontouchstart"in document,f.mobile===!1&&(n=!1),a=$(document.body),e=$("html"),t=0,r=0,i=function(o){return function(l){return a.removeClass("dragging"),o.removeClass("dragging"),e.off("mousemove touchmove",u),typeof f.stop=="function"?f.stop():void 0}}(this),u=function(o){return function(l,c,p){var m,d;return m=c-t,d=p-r,t+=m,r+=d,typeof f.move=="function"?f.move(m,d):void 0}}(this),s=function(o){return function(l,c,p){if(!a.is(".dragging")&&!(typeof f.skip_drag=="function"&&f.skip_drag(l)))return a.addClass("dragging"),o.addClass("dragging"),t=c,r=p,typeof f.start=="function"&&f.start(),!0}}(this),n?this.on("touchstart",function(o){return function(l){var c,p,m;c=l.originalEvent.targetTouches[0],p=c.pageX,m=c.pageY,s(l,p,m)&&(e.one("touchend",i),u=function(d){return function(v){var S;return S=v.originalEvent.targetTouches[0],p=S.pageX,m=S.pageY,d(v,p,m)}}(u),e.on("touchmove",u))}}(this)):this.on("mousedown",function(o){return function(l){if(s(l,l.pageX,l.pageY))return e.one("mouseup",i),u=function(c){return function(p){return c(p,p.pageX,p.pageY)}}(u),e.on("mousemove",u)}}(this))}}.call(this),function(){var f=function(u,s){for(var i in s)a.call(s,i)&&(u[i]=s[i]);function e(){this.constructor=u}return e.prototype=s.prototype,u.prototype=new e,u.__super__=s.prototype,u},a={}.hasOwnProperty;I.FeedbackLightbox=function(u){f(s,u);function s(){return s.__super__.constructor.apply(this,arguments)}return s.prototype.init=function(){return this.el.find("form").remote_submit(function(i){return function(e){if(e.errors){alert(e.errors.join(", "));return}return i.el.addClass("is_complete")}}(this))},s}(I.Lightbox),I.FeedbackWidget=function(){function u(s){this.el=$(s),this.el.on("click",function(i){return function(e){var t;return t=$(e.target).data("url")+"?"+$.param({url:window.location.href}),I.Lightbox.open_remote(t,I.FeedbackLightbox)}}(this))}return u}()}.call(this),function(){I.FilterPickers=function(){f.prototype.label_padding=10;function f(a,u){var s,i;this.opts=u!=null?u:{},this.el=$(a),s=this.el.find(".filter_picker_widget"),this.opts.label_padding&&(this.label_padding=this.opts.label_padding),i=function(e){return function(){return s.removeClass("open popup_visible").find(".filter_options").css({marginTop:""})}}(this),$(window).on("click",function(e){return function(t){if(!$(t.target).closest(".filter_picker_widget").length)return i()}}(this)),this.el.on("i:close_filter_pickers",i),this.el.on("click",".filter_picker_widget .filter_value",function(e){return function(t){var r,n,o;return t.preventDefault(),n=$(t.currentTarget).closest(".filter_picker_widget"),n.trigger("i:track_link"),s.not(n).removeClass("open popup_visible"),n.toggleClass("open"),r=n.find(".filter_value").height(),n.find(".filter_options").css({marginTop:r+e.label_padding*2,minWidth:n.width()+30+"px"}),o=$(window).width()-n.position().left+n.width(),n.toggleClass("popup_left",o<200),_.defer(function(){return n.toggleClass("popup_visible",n.is(".open"))})}}(this))}return f}()}.call(this),function(){var f,a,u=function(s,i){return function(){return s.apply(i,arguments)}};f=0,a=function(){return"game_grid_"+f++},I.GameGridSizer=function(){s.prototype.container_selector=!1,s.prototype.expected_size=315,s.prototype.aspect_ratio=315/250,s.prototype.cell_margin=10,s.prototype.min_columns=1,s.initialize=_.once(function(){var i,e,t;return i=$(document.body),e=_.debounce(function(){return i.addClass("disable_hover")},200,!0),t=_.debounce(function(){return i.removeClass("disable_hover")},200),$(window).on("scroll resize",function(){e(),t()})});function s(i){i==null&&(i={}),$.extend(this,i),this.size_callbacks=[],this.constructor.initialize(),$(window).on("resize",_.debounce(function(e){return function(){return e.resize_cells()}}(this),200)),this.resize_cells(),I.in_test||_.defer(function(e){return function(){return e.resize_cells()}}(this))}return s.prototype.get_cell_margin=function(){return typeof this.cell_margin=="function"?this.cell_margin():this.cell_margin},s.prototype.get_expected_size=function(){return typeof this.expected_size=="function"?this.expected_size():this.expected_size},s.prototype.on_size=function(i){return this.size_callbacks.push(i)},s.prototype.available_width=function(){var i,e,t,r;return this.el?(i=(r=this.el[0])!=null?r.getBoundingClientRect().width:void 0,t=i-Math.floor(i),e=Math.floor(this.el.width()),t>0&&(e-=1),e):$(window).width()},s.prototype.resize_cells=function(){var i,e,t,r,n,o,l,c,p,m,d,v,S,b;for(r=this.get_expected_size(),e=this.get_cell_margin(),v=r+e,m=this.available_width()+e,p=m/v,d=Math.ceil(p),d<this.min_columns&&(d=this.min_columns),c=m/d-e,l=c/this.aspect_ratio,c=Math.floor(c),l=Math.floor(l),this.cells_per_row=d,this._style&&(this._style.remove(),this._style=null),t="",this.container_selector&&(t+=this.container_selector+` {
  --itchio_grid_gap: `+e+`px;
  --itchio_grid_cell_width: `+c+`px;
  --itchio_grid_cell_columns: `+d+`;
  grid-template-columns: repeat(`+d+", "+c+`px);
}`),t!==""&&(this._style=$("<style itchio-grid-sizer type='text/css'>"+t+"</style>").appendTo($("head"))),S=this.size_callbacks,b=[],n=0,o=S.length;n<o;n++)i=S[n],b.push(i(this,c,l));return b},s}(),I.GameCells=function(){function s(i){this.setup_game_tools=u(this.setup_game_tools,this),this.el=$(i),this.setup_game_tools(),this.setup_gifs()}return s.prototype.setup_game_tools=function(){return this.el.dispatch("click",{add_to_collection_btn:function(i){return function(e){return I.event("grid",I.page_name(),"add_to_collection"),I.current_user?I.Lightbox.open_remote(e.attr("href"),I.CollectionLightbox):"continue"}}(this)})},s.prototype.setup_gifs=function(){return this.el.on("mouseenter",".game_cell",function(i){return function(e){var t,r;if(t=$(e.currentTarget),!t.data("grid_hovered")&&(t.data("grid_hovered",!0),r=t.find(".gif_overlay"),!!r.length))return r.css("background-image","url("+r.data("gif")+")")}}(this))},s}(),I.GameGrid=function(){function s(i,e){var t,r,n,o,l;if(e==null&&(e={}),this.refresh_images=u(this.refresh_images,this),this.add_image_loading=u(this.add_image_loading,this),this.setup_conversion_tracking=u(this.setup_conversion_tracking,this),this.el=$(i),$.extend(this,e),this.setup_lazy_images(),this.show_popups!==!1&&new I.GamePopups(this.el),new I.GameCells(this.el),!this.sizer&&this.sizer!==!1){for(t=["container_selector","expected_size","min_columns","cell_margin"],this.el[0]&&!this.el[0].id&&(this.el[0].id=a()),l={el:this.el,container_selector:"#"+this.el[0].id},n=0,o=t.length;n<o;n++)r=t[n],r in e&&(l[r]=e[r]);this.sizer=new I.GameGridSizer(l),this.sizer.on_size(function(c){return function(){return c.el.trigger("i:grid_resize"),c.el.lazy_images()}}(this))}}return s.prototype.setup_lazy_images=function(){return _.defer(function(i){return function(){return i.add_image_loading()}}(this))},s.prototype.setup_conversion_tracking=function(i){return this.el.on("i:impression",function(e){return function(t){var r,n;if(r=$(t.target).closest("[data-game_id]"),n=r.data("game_id"),!!n)return I.ConversionTracker.push("1:"+i+":1:"+n)}}(this)),this.el.on("i:delegate_tracking",function(e){return function(t,r){var n;if(n=$(t.target).closest("[data-game_id]").data("game_id"),!!n)return I.ConversionTracker.click(i+":1:"+n),r(I.ConversionTracker.flush_now())}}(this))},s.prototype.add_image_loading=function(){return this.el.lazy_images({show_item:function(i){return function(e){return e.trigger("i:impression"),e.find(".image_loading").addBack(".image_loading").removeClass("image_loading")}}(this)})},s.prototype.refresh_images=function(){var i;return typeof(i=this.el.data("lazy_images"))=="function"?i():void 0},s}()}.call(this),function(){var f=function(a,u){return function(){return a.apply(u,arguments)}};I.Header=function(){a.prototype.track_category="header";function a(u){this.setup_browse_menu=f(this.setup_browse_menu,this),this.el=$(u),I.tracked_links(this.el,this.track_category,"click"),this.el.on("click",".menu_tick",function(s){return function(i){var e,t,r;if(!$(i.target).closest(".drop_menu").length)return r=$(i.currentTarget),t=r.closest(".drop_menu_wrap").toggleClass("open"),e=$(document.body),t.is(".open")?(r.trigger("i:track_link"),e.on("click.drop_menu",function(n){if(!$(n.target).closest(t).length)return t.removeClass("open"),e.off("click.drop_menu")})):e.off("click.drop_menu")}}(this)),this.setup_browse_menu()}return a.prototype.setup_browse_menu=function(){var u;return u=this.el.find(".browse_btn"),this.browse_menu=new I.HoverManager({timeout:750,enter_timeout:100,show:function(s){return function(){return s.el.addClass("hover_menu_open"),u.addClass("open"),setTimeout(function(){return s.el.addClass("hover_menu_visible")},0)}}(this),hide:function(s){return function(){return u.removeClass("open"),s.el.removeClass("hover_menu_visible")}}(this),after_fade:function(s){return function(){return s.el.removeClass("hover_menu_open")}}(this)}),$(document.body).on("click",function(s){return function(i){var e;e=$(i.target).closest(".browse_btn, .header_dropdown"),!e.length&&s.browse_menu.hide()}}(this)),this.el.on("mouseenter mouseleave",".browse_btn, .header_dropdown",function(s){return function(i){return i.type==="mouseenter"?s.browse_menu.enter():s.browse_menu.leave()}}(this))},a}()}.call(this),function(){var f=function(a,u){return function(){return a.apply(u,arguments)}};I.HoverManager=function(){a.prototype.default_opts={timeout:1e3,enter_timeout:150,fade_timeout:400,show:function(){},hide:function(){},after_fade:function(){}};function a(u){this._clear_enter_timeout=f(this._clear_enter_timeout,this),this._clear_fade_timeout=f(this._clear_fade_timeout,this),this._clear_leave_timeout=f(this._clear_leave_timeout,this),this.opts=$.extend({},this.default_opts,u),this.open=!1}return a.prototype.enter=function(){if(!this.enter_timeout)return this._clear_leave_timeout(),this._clear_fade_timeout(),this.enter_timeout=window.setTimeout(function(u){return function(){var s;return delete u.enter_timeout,u.open||typeof(s=u.opts).show=="function"&&s.show(),u.open=!0}}(this),this.opts.enter_timeout)},a.prototype.leave=function(){if(!this.leave_timeout)return this._clear_enter_timeout(),this.leave_timeout=window.setTimeout(function(u){return function(){return delete u.leave_timeout,u.hide()}}(this),this.opts.timeout)},a.prototype.hide=function(){var u;return this._clear_enter_timeout(),this._clear_leave_timeout(),this.open&&typeof(u=this.opts).hide=="function"&&u.hide(),this.open=!1,this.hiding=!0,this.fade_timeout=window.setTimeout(function(s){return function(){var i;return typeof(i=s.opts).after_fade=="function"&&i.after_fade(),s.hiding=!1}}(this),this.opts.fade_timeout)},a.prototype.show=function(){var u;return typeof(u=this.opts).show=="function"?u.show():void 0},a.prototype._clear_leave_timeout=function(){if(this.leave_timeout)return window.clearTimeout(this.leave_timeout),delete this.leave_timeout},a.prototype._clear_fade_timeout=function(){if(this.fade_timeout)return window.clearTimeout(this.fade_timeout),delete this.fade_timeout},a.prototype._clear_enter_timeout=function(){if(this.enter_timeout)return window.clearTimeout(this.enter_timeout),delete this.enter_timeout},a}()}.call(this),function(){var f,a,u,s,i,e,t,r,n,o=[].slice,l={}.hasOwnProperty;n={},t={},f="en",u=(r=window.itchio_locale)!=null?r:f,s=window.requestAnimationFrame||_.defer,i=function(c,p,m){var d,v,S,b,g,w,k;for(S=0,b=p.length;S<b;S++)if(g=p[S],_.isString(g))c.push(g);else if(g[0]==="v")k=m[g[1]],k||console.warn("i18n: failed to find value for variable "+g[1]),c.push(k);else if(g[0]==="t"){if(v=m[g[1]],typeof v!="function")throw new Error("i18n: tried to interpolate tag without function: "+g[1]);d=g[2],w=[],i(w,d||[],m),c.push(v(w.join("")))}else throw new Error("i18n: unknown interpolation node: "+JSON.stringify(g));return c},e=function(c,p){var m,d,v,S;return _.isString(c)?c:(d=function(){var b,g,w;for(w=[],b=0,g=c.length;b<g;b++)if(v=c[b],_.isString(v))w.push(v);else if(v[0]==="v")S=p[v[1]],S||console.warn("i18n: failed to find value for variable "+v[1]),w.push(S);else if(v[0]==="t"){if(m=p[v[1]],typeof m!="function")throw new Error("i18n: tried to interpolate tag without function: "+v[1]);w.push(m(e(v[2],p)))}else throw new Error("i18n: unknown interpolation node: "+JSON.stringify(v));return w}(),d.length>1?React.createElement.apply(React,[React.Fragment,{}].concat(o.call(d))):d.length===0?null:d)},a=function(){c._cache={},c.for_locale=function(p){var m;return(m=this._cache)[p]||(m[p]=new c(p))};function c(p){this.locale=p,this.last_fetch=null,this.next_fetch=null}return c.prototype.fetch=function(p,m){return this.next_fetch?(this.next_fetch=this.next_fetch.concat(p),this.last_fetch):(this.next_fetch=p,this.last_fetch=$.Deferred(function(d){return function(v){return s(function(){var S,b;if(!window.itchio_translations_url){console.error("missing translations url: itchio_translations_url");return}return S=d.next_fetch,b=$.get(window.itchio_translations_url,{locale:d.locale,prefixes:d.next_fetch.join(",")}),d.next_fetch=null,b.done(function(g){var w,k;for(w in g)l.call(g,w)&&(k=g[w],!m[w]&&(m[w]=k));return v.resolve()})})}}(this)))},c}(),I.i18n={Preloader:a,get_translations:function(){return n},get_cache:function(){return t},get_locale:function(){return u},locale_is_english:function(){return u==="en"},insert:function(c){var p,m,d;m=[];for(p in c)l.call(c,p)&&(d=c[p],!n[p]&&m.push(n[p]=d));return m},set_locale:function(c){return u=c,n={},t={}},render_string:function(c,p,m){var d;if(_.isString(p))return m&&console.warn("i18n: provided variables to translation string with no interpolation: "+c),p;if(d=[],!m)throw new Error("i18n: tried to interpolate "+c+" without variables");return i(d,p,m),d.join("")},t:function(c,p){return I.i18n.fetch_key(c).then(function(m){return function(d){return I.i18n.render_string(c,d,p)}}(this))},t_sync:function(c){return function(p,m){var d;if(d=I.i18n.fetch_key_sync(p),!d)throw new Error("i18n: failed to fetch key sync: "+p);return I.i18n.render_string(p,d,m)}}(this),fetch_key_sync:function(c){return u==="debug"?"[["+c+"]]":n[c]},fetch_key:function(c){var p,m;if(u==="debug")return $.when("[["+c+"]]");if(p=c.split("."),p.pop(),!p.length)throw new Error("i18n: empty prefix");return m=p.join("."),I.i18n.preload(m).then(function(d){return function(){var v;if(v=n[c],v)return v;if(u===f)throw new Error("i18n: failed to find key: "+c);return I.i18n.preload(m,f).then(function(){if(v=n[c],!v)throw new Error("i18n: failed to find key: "+c);return v})}}(this))},preload:function(c,p){var m,d,v,S,b,g,w;if(p==null&&(p=u),p!=="debug"){if(m=t,_.isString(c)&&(c=[c]),w=function(){var k,C,T;for(T=[],k=0,C=c.length;k<C;k++)g=c[k],m[p]||(m[p]={}),!m[p][g]&&T.push(g);return T}(),d=function(){var k,C,T,D;for(D=[],k=0,C=c.length;k<C;k++)g=c[k],((T=m[p][g])!=null?T.state():void 0)==="pending"&&D.push(m[p][g]);return D}(),!w.length)return $.when.apply($,d);for(v=a.for_locale(p).fetch(w,n),S=0,b=w.length;S<b;S++)g=w[S],m[p][g]||(m[p][g]=v);return d.length?$.when.apply($,[v].concat(o.call(d))):v}},react_class:function(c){return createReactClass({displayName:"i18n:"+c,getInitialState:function(){var p;return p=function(){var m;return(m=I.i18n.fetch_key_sync(c))?{text:m}:null},p.isReactClassApproved=!0,p}(),componentWillUnmount:function(){return this.unmounted=!0},componentDidMount:function(){if(!(this.state&&this.state.text))return I.i18n.fetch_key(c).done(function(p){return function(m){if(!p.unmounted)return p.setState({text:m})}}(this))},render:function(){return this.state?_.isString(this.state.text)?this.state.text:e(this.state.text,this.props):"\u2026"}})}}}.call(this),function(){var f;f=function(a){var u,s,i,e,t,r,n,o,l,c,p,m,d,v,S;return l=ReactDOMFactories.table,m=ReactDOMFactories.thead,c=ReactDOMFactories.tbody,S=ReactDOMFactories.tr,p=ReactDOMFactories.td,u=ReactDOMFactories.abbr,i=ReactDOMFactories.details,o=ReactDOMFactories.summary,e=ReactDOMFactories.div,t=ReactDOMFactories.h2,s=ReactDOMFactories.code,n=ReactDOMFactories.pre,r=ReactDOMFactories.p,d=a.query_log.length,v=a.query_log.reduce(function(b,g){return b+g[1]},0),R.Lightbox({className:"compact perf_query_log_widget",style:{width:"100%",maxWidth:"800px"}},t({},"Query log"),r({style:{margin:"0 10px"}},"Queries: ",s({},d),", Time: ",s({},(v*1e3).toFixed(2)+"ms")),e({style:{padding:"10px"}},l({className:"nice_table",style:{width:"100%"}},m({},S({},p({},"Query"),p({},"Timing"))),c({},a.query_log.map(function(b){return function(g,w){var k,C,T;return k=g[0],T=g[1],C=T*1e3,S({key:w},p({},i({},o({},s({style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",display:"inline-block",maxWidth:"600px"}},k)),n({style:{whiteSpace:"pre-wrap"}},k))),p({},s({style:{fontWeight:C>10?"bold":void 0,color:C>100?"white":C>50?"red":void 0,backgroundColor:C>100?"red":void 0}},C.toFixed(2)+"ms")))}}(this))))))},I.PerfPanel=function(){function a(u){var s;u.layout_time||(u.layout_time=0),u.view_time||(u.view_time=0),u.db_time||(u.db_time=0),u.db_count||(u.db_count=0),s=_.template(`<div class="perf_panel">
  <div class="stat_row">
    <strong>Queries:</strong> {{ db_count }}
  </div>

  <div class="stat_row">
    <strong>Query time:</strong> {{ Math.floor(db_time * 1000) }}ms
  </div>

  <div class="stat_row">
    <strong>View time:</strong> {{ Math.floor((view_time + layout_time) * 1000) }}ms
  </div>

  <div class="stat_row">
    <strong>Rest:</strong> {{ Math.floor((total_time - (view_time + layout_time + db_time)) * 1000) }}ms
  </div>

</div>`),this.data=u,this.el=$(s(u)).appendTo(document.body),this.el.on("click",function(i){return function(){return i.render_queries()}}(this))}return a.prototype.render_queries=function(){var u,s,i;if(this.data.query_log)return s=function(){var e,t,r,n,o;for(r=this.data.query_log,o=[],e=0,t=r.length;e<t;e++)n=r[e],u=n[0],i=n[1],o.push({query:u,time:i*1e3});return o}.call(this),console.table(s),I.add_react().done(function(e){return function(){if(typeof R!="undefined"&&R!==null&&R.Lightbox)return I.Lightbox.open(f({query_log:e.data.query_log}))}}(this))},a}()}.call(this),function(){var f=function(a,u){return function(){return a.apply(u,arguments)}};I.GamePopups=function(){a.prototype.trigger_selector=".game_thumb",a.prototype.popup_selector=".popup_details",a.prototype.hover_delay=250,a.prototype.close_timeout=200,a.prototype.x_offset=0;function a(u,s){var i;s==null&&(s={}),this.deferred_for_el=f(this.deferred_for_el,this),!I.is_mobile()&&(this.el=$(u),$.extend(this,s),i=$(document.body),this.el.on("mouseenter mouseleave",this.trigger_selector,function(e){return function(t){if(u=$(t.currentTarget),!u.closest(".jam_cell").length&&!u.closest(".disable_hover").length)return t.type==="mouseenter"?e.enter(u):e.leave(u)}}(this)),i.on("i:hide_popups",function(e){return function(t,r){return e.close_popup()}}(this)),i.on("i:hide_other_popups",function(e){return function(t,r){if(r!==e)return e.close_popup()}}(this)))}return a.prototype.deferred_for_el=function(u){var s,i,e;if(s=u.data("i:popup_defer"),!s){if(i=u.closest("[data-game_id]").data("game_id"),s=$.Deferred(),u.data("i:popup_defer",s),!i)return;e=I.subdomain?"/-/game/popup/"+i:"/game/popup/"+i,$.get(e,function(t){return function(r){var n;if(!(_.isObject(r)&&r.errors))return n=$(r),n.data("object_id",i),I.tracked_links(n,"popups",I.page_name(),"click"),n.find("a").on("click",function(){var o;if(o=n.data("trigger_el"))return o.trigger("i:track_link")}),s.resolve(n)}}(this))}return s},a.prototype.enter=function(u){var s,i;return u.data("i:inside",!0),i=_.debounce(function(e){return function(){if(u.data("i:inside"))return e.deferred_for_el(u).then(function(t){return e.show_popup(u,t)})}}(this),this.hover_delay),s=_.debounce(function(e){return function(){var t;if(u.data("i:inside"))return t=new Date,e.deferred_for_el(u)}}(this),this.hover_delay/2),u.on("mousemove.hover_manager",function(){return i(),s()})},a.prototype.leave=function(u){return u.data("i:inside",!1),u.off("mousemove.hover_manager")},a.prototype.show_popup=function(u,s){var i,e,t,r,n,o,l,c;if(typeof(i=document.body).contains=="function"&&i.contains(u[0])&&this.current_popup!==s){for(this.el.trigger("i:hide_other_popups",[this]),(o=this.current_popup)!=null&&o.stop().remove(),this.current_popup=s.css({left:"0px",top:"0px"}).removeClass("visible"),c=s.find(".popup_screenshot").removeClass("visible"),$(document.body).append(s),this.position_popup(u,s),_.defer(function(p){return function(){return s.addClass("visible")}}(this)),s.data("trigger_el",u),e=function(p){return function(m){return setTimeout(function(){return m.addClass("visible")},t*100)}}(this),t=r=0,n=c.length;r<n;t=++r)l=c[t],e($(l));return s.hide().css({opacity:""}).fadeIn("fast"),this.watch_for_popup_close()}},a.prototype.watch_for_popup_close=function(){var u,s;return s=this.trigger_selector+", "+this.popup_selector,u=null,$(document.body).on("click.hover_manager",function(i){return function(e){var t;if(t=$(e.target),!t.closest(s).length)return i.close_popup()}}(this)),$(window).on("mousemove.hover_manager",_.throttle(function(i){return function(e){var t;if(t=$(e.target).closest(s),t.length){u&&(window.clearTimeout(u),u=null);return}if(!u)return u=window.setTimeout(function(){return i.close_popup()},i.close_timeout)}}(this),50))},a.prototype.position_popup=function(u,s){var i,e,t,r,n,o,l;return t=u.offset(),l=s.outerWidth(!0),i=s.outerHeight(!0),s.removeClass("on_right"),r=u.outerHeight(),n=u.outerWidth(),o=t.top+(r-i)/2,e=t.left-l,e<0?(e=t.left+n,e+=this.x_offset,s.addClass("on_right")):e-=this.x_offset,s.css({top:Math.floor(o)+"px",left:Math.floor(e)+"px"})},a.prototype.close_popup=function(){var u;return $(window).off("mousemove.hover_manager"),$(document.body).off("click.hover_manager"),(u=this.current_popup)!=null&&u.stop(!0).remove(),this.current_popup=null},a}(),I.GamePopup=function(){function a(u){this.el=$(u),this.el.dispatch("click",{watch_trailer_btn:function(s){return I.event("grid",I.page_name(),"watch_trailer"),I.Lightbox.open_remote(s.data("lightbox_url"))}})}return a}(),I.WatchTrailerLightbox=function(){function a(u){this.el=$(u),this.el.dispatch("click",{add_to_collection_btn:function(s){return function(i){return I.event("grid","trailer","add_to_collection"),I.current_user?I.Lightbox.open_remote(i.attr("href"),I.CollectionLightbox):"continue"}}(this)})}return a}()}.call(this),function(){I.ReferrerTracker=function(){function f(){}return f.MAX_ITEMS=20,f.get_cookie=function(){return Cookies.getJSON("itchio_refs")||[]},f.write_cookie=function(a){return I.set_cookie("itchio_refs",a,{expires:14})},f.has_ref=function(a,u){var s,i,e,t,r,n;for(u=+u,r=f.get_cookie(),e=0,t=r.length;e<t;e++)if(n=r[e],i=n[0],s=n[1],i===a&&s===u)return!0;return!1},f.push=function(a,u,s){var i,e;if(s&&s.length>0){for(u=+u,e=function(){var t,r,n,o;for(n=this.get_cookie(),o=[],t=0,r=n.length;t<r;t++)i=n[t],!(i[0]===a&&i[1]===u)&&o.push(i);return o}.call(f),I.in_dev&&console.log("pushing referrer",[a,u,s]),e.unshift([a,u,s]);e.length>f.MAX_ITEMS;)e.pop();return f.write_cookie(e)}},f}()}.call(this),function(){I.SaleList=function(){function f(a){this.el=$(a),this.el.lazy_images({})}return f}()}.call(this),function(){var f,a,u=function(t,r){return function(){return t.apply(r,arguments)}},s=[].slice,i=function(t,r){for(var n in r)e.call(r,n)&&(t[n]=r[n]);function o(){this.constructor=t}return o.prototype=r.prototype,t.prototype=new o,t.__super__=r.prototype,t},e={}.hasOwnProperty;I.prepare_upload=function(t,r,n,o){return $.ajax({url:t+"/upload/prepare",type:"post",data:I.with_csrf(r),success:function(l){return function(c){return c.errors?typeof o=="function"?o(c.errors.join(",")):void 0:typeof n=="function"?n(c):void 0}}(this),error:function(l){return function(c){return typeof o=="function"?o("Server error"):void 0}}(this)})},a=function(t){var r,n,o,l,c;return r=new DataView(t,0,5),o=r.getUint8(0,!0),l=r.getUint8(1,!0),n=o.toString(16)+l.toString(16),c={8950:"image/png",4749:"image/gif","424d":"image/bmp",ffd8:"image/jpeg"},c[n]},f="You selected an image type we don't recognize. It's possible it has the wrong file extension for the format it is saved as. Please use an image editing program to convert it to a PNG, JPEG, or GIF.",I.test_image_format=function(t){return $.Deferred(function(r){return function(n){var o;return window.FileReader?(o=new FileReader,o.readAsArrayBuffer(t),o.onerror=function(){return n.reject("Failed to read image from disk")},o.onload=function(){var l;return l=a(o.result),l==="image/bmp"?n.reject("You selected a BMP file that has a wrong extension. Please use an image editing program to convert it to a PNG, JPEG, or GIF."):l?n.resolve():n.reject(f)}):n.resolve()}}(this))},I.image_dimensions=function(t){return $.Deferred(function(r){var n,o;return o=typeof URL!="undefined"&&URL!==null&&typeof URL.createObjectURL=="function"?URL.createObjectURL(t):void 0,o?(n=new Image,n.src=o,n.onload=function(){return r.resolve([n.width,n.height])},n.onerror=function(){return r.reject(f)}):r.reject(f)})},I.video_dimensions=function(t){return $.Deferred(function(r){var n,o;return o=document.createElement("video"),n=typeof URL!="undefined"&&URL!==null&&typeof URL.createObjectURL=="function"?URL.createObjectURL(t):void 0,n?(o.src=n,o.onloadedmetadata=function(){return r.resolve([o.videoWidth,o.videoHeight])},o.onerror=function(){return r.reject("Invalid video file")}):r.reject("Invalid video file")})},I.test_image_dimensions=function(t,r,n){return r==null&&(r=3840),n==null&&(n=2160),I.image_dimensions(t).then(function(o){return function(l){var c,p;return p=l[0],c=l[1],$.Deferred(function(m){return p>r||c>n?m.reject("Image is greater than the maximum dimensions of "+r+"x"+n+" (you selected a "+p+"x"+c+" image)"):m.resolve()})}}(this))},I.Upload=function(){t.prototype.error_message="There was a problem completing your upload. Try again. If the problem persists contact support.",t.prototype.label="file",t.prototype.kind="upload";function t(r,n,o){this.editor=r,this.file=n,this.opts=o,this.start_xhr_upload=u(this.start_xhr_upload,this),this.decrement=u(this.decrement,this),this.increment=u(this.increment,this),this.save_upload=u(this.save_upload,this)}return t.prototype.upload_params=function(){return{kind:this.kind,filename:this.file.name}},t.prototype.save_upload=function(r){throw"override `save_upload`"},t.prototype.increment=function(){var r,n;if((r=this.constructor).active_uploads||(r.active_uploads=0),this.constructor.active_uploads++,this.constructor.active_uploads===1)return typeof(n=this.opts).start_uploading=="function"?n.start_uploading():void 0},t.prototype.decrement=function(){var r;if(this.constructor.active_uploads--,this.constructor.active_uploads===0)return typeof(r=this.opts).stop_uploading=="function"?r.stop_uploading():void 0},t.prototype.start_xhr_upload=function(r){var n,o,l,c,p;if(!this.upload_data)throw"missing upload data";this.increment(),n=new FormData,l=this.upload_data.post_params;for(o in l)c=l[o],n.append(o,c);return n.append("file",this.file),p=new XMLHttpRequest,p.upload.addEventListener("progress",function(m){return function(d){if(d.lengthComputable)return typeof m.progress=="function"?m.progress(d.loaded,d.total):void 0}}(this)),p.upload.addEventListener("error",function(m){return function(d){return I.event("upload","xhr error",m.kind)}}(this)),p.upload.addEventListener("abort",function(m){return function(d){return I.event("upload","xhr abort",m.kind)}}(this)),p.addEventListener("readystatechange",function(m){return function(d){var v;if(p.readyState===4){if(m.decrement(),Math.floor(p.status/100)===2)return I.event("upload","save",m.kind),typeof m.save_upload=="function"?m.save_upload(m.opts.finish_upload):void 0;if(v="Failed upload.",p.responseXML)try{v=p.responseXML.querySelector("Error Message").innerHTML}catch(S){d=S}else v=p.responseText;return I.event("upload_error","server error "+p.status+": "+v,m.kind),r("error: "+v)}}}(this)),p.open("POST",this.upload_data.action),p.send(n)},t.prototype.start_upload=function(r,n){var o;if(!this.upload_data)return o=function(l){return function(c){return l.error_message=c,typeof l.cancel_upload=="function"&&l.cancel_upload.apply(l,[l].concat(s.call(arguments))),typeof n=="function"?n.apply(null,[l].concat(s.call(arguments))):void 0}}(this),this.editor.prepare_upload(function(l){return function(){return I.prepare_upload(l.editor.upload_prefix(),l.upload_params(),function(c){return l.upload_data=c,typeof l.have_upload_data=="function"&&l.have_upload_data(),l.start_xhr_upload(o)},o)}}(this),o)},t}(),I.ImageUpload=function(t){i(r,t);function r(){return this.save_url=u(this.save_url,this),r.__super__.constructor.apply(this,arguments)}return r.prototype.success_params={},r.prototype.kind="image",r.prototype.label="image",r.prototype.save_url=function(){return this.editor.upload_prefix()+"/image/success/"+this.upload_data.upload_id},r.prototype.save_upload=function(n){if(this.upload_data)return $.ajax({url:this.save_url()+"?"+$.param(this.success_params),type:"post",data:I.with_csrf(),success:function(o){return function(l){var c;if(c=o.success_params.type||o.kind,l.errors){I.event("upload_error",c,l.errors.join(", ")),o.cancel_upload?o.cancel_upload():alert(o.error_message);return}return n.apply(null,[o].concat(s.call(arguments)))}}(this)})},r.delete_image=function(n,o,l){return $.ajax({url:n.upload_prefix()+"/image/delete/"+o,type:"post",data:I.with_csrf(),success:l})},r}(I.Upload),I.pick_files=function(t){var r;return t==null&&(t={}),r=t.input?$(t.input):($("input.pick_files_input").remove(),$("<input type='file' class='pick_files_input' />").hide().insertAfter("body")),$.Deferred(function(n){return function(o){return t.multiple&&r.attr("multiple",!0),t.accept&&r.attr("accept",t.accept),r.on("change",function(l){var c,p,m,d,v,S,b;for(v=function(){var g,w,k,C;for(k=l.target.files,C=[],g=0,w=k.length;g<w;g++)m=k[g],C.push(m);return C}(),p=[],typeof t.on_pick_files=="function"&&t.on_pick_files(v),S=0,b=v.length;S<b;S++)d=v[S],t.max_size&&d.size>t.max_size&&p.push(["You selected an image greater than the max size "+I.format_bytes(t.max_size)+" (you selected a "+I.format_bytes(d.size)+" file)",d]);if(p.length){o.reject(p,v);return}return t.test_file?(c=v.map(function(g){return $.Deferred(function(w){return t.test_file(g,w),setTimeout(function(){if(o.state()==="pending")return w.reject("Timed out checking file, are you sure it was an image file?")},1e3)}).catch(function(w){throw[w,g]})}),$.when.apply($,c).done(function(g){return o.resolve(v)}).fail(function(g){return o.reject([g])})):o.resolve(v)}),r.click()}}(this))},I.xhr_upload=function(t){return function(r,n){return $.Deferred(function(o){var l,c,p,m,d;l=new FormData,p=n.post_params;for(c in p)m=p[c],l.append(c,m);return l.append("file",r),d=new XMLHttpRequest,d.upload.addEventListener("progress",function(v){if(v.lengthComputable)return o.notify("progress",v.loaded,v.total)}),d.upload.addEventListener("error",function(v){return o.reject("xhr error")}),d.upload.addEventListener("abort",function(v){return o.reject("xhr aborted")}),d.addEventListener("readystatechange",function(v){var S;if(d.readyState===4){if(Math.floor(d.status/100)===2)return o.resolve();if(S="Failed upload.",d.responseXML)try{S=d.responseXML.querySelector("Error Message").innerHTML}catch(b){v=b}else S=d.responseText;return o.reject(S)}}),d.open("POST",n.action),d.send(l)})}}(this),I.upload_image=function(t){return t==null&&(t={}),t.accept||(t.accept="image/png,image/jpeg,image/gif"),t.file_params=function(r){return r.type==="video/mp4"?I.video_dimensions(r).then(function(n){return function(o){var l,c;return c=o[0],l=o[1],{width:c,height:l}}}(this)):I.image_dimensions(r).then(function(n){return function(o){var l,c;return c=o[0],l=o[1],{width:c,height:l}}}(this))},I.upload_file(t)},I.upload_file=function(t){return function(r){var n,o,l,c,p,m;if(r==null&&(r={}),!r.url)throw new Error("missing url for upload image");return n=r.accept,o=r.max_size,l=r.multiple,c=r.on_pick_files,p=r.on_start_upload,m=r.test_file,I.pick_files({accept:n,max_size:o,multiple:l,test_file:m,on_pick_files:c}).then(function(d){var v,S;if(!l&&d.length>1)throw"Got multiple files for single upload";return S=function(){var b,g,w,k;for(w=d.slice(0,6),k=[],b=0,g=w.length;b<g;b++)v=w[b],k.push(function(C){var T;return T=r.file_params?r.file_params(C):{},$.when(T).then(function(D){return function(j){return $.ajax({url:r.url,type:"post",xhrFields:{withCredentials:!0},data:I.with_csrf($.extend({filename:C.name,thumb_size:r.thumb_size,action:"prepare"},j))}).then(function(A){var W;return A.errors?$.Deferred().reject(A.errors):(W=I.xhr_upload(C,A).then(function(){return $.ajax({url:A.success_url,type:"post",xhrFields:{withCredentials:!0},data:I.with_csrf()})}),typeof p=="function"&&p(C,A,W),W)})}}(this))}(v));return k}(),l?$.when.apply($,S):S[0]})}}(this),I.make_upload_button=function(t,r,n,o){var l,c;return o==null&&(o={}),l=null,c=r.data("max_size"),r.on("click",function(p){return function(m){var d,v;return l&&l.remove(),l=$("<input type='file' multiple />").hide().insertAfter(r),(d=r.data("accept"))&&l.attr("accept",d),v=n.prototype.kind,I.event("upload","open",v),l.on("change",function(){var S,b,g,w,k,C;for(k=l[0].files,C=[],g=0,w=k.length;g<w;g++){if(S=k[g],c!=null&&S.size>c){I.flash(S.name+" is greater than max size of "+I.format_bytes(c),"error");continue}b=new n(t,S,o),o.cancel_upload&&(b.cancel_upload=o.cancel_upload),b.start_upload(),typeof o.queue_upload=="function"&&o.queue_upload(b),C.push(I.event("upload","start",v))}return C}),l.insertAfter(r),l.click()}}(this))},I.make_fake_upload_button=function(t,r,n,o){return o==null&&(o={}),r.on("click",function(l){var c;return c=new n(t,{size:851520,name:"The file that I am uploading.zip",type:".zip"},o),c.save_upload=function(p){return c.after_save(),typeof p=="function"?p(this):void 0},c.start_upload=function(p,m){var d,v;return c.upload_data={upload_id:-1},typeof c.have_upload_data=="function"&&c.have_upload_data(),v=0,d=function(){return v+=Math.floor(Math.random()*2e4)+500,v>=c.file.size?typeof c.save_upload=="function"?c.save_upload(o.finish_upload):void 0:(c.progress(v,c.file.size),setTimeout(d,50))},d()},typeof o.queue_upload=="function"&&o.queue_upload(c),c.start_upload()})},I.make_popup_upload_button=function(t,r,n,o){var l,c,p;if(!t.upload_prefix)throw"Upload button parent must have `upload_prefix` method";return c=0,p=function(m){return c+=m,c===0?typeof o.stop_uploading=="function"?o.stop_uploading():void 0:typeof o.start_uploading=="function"?o.start_uploading():void 0},l=function(m){var d,v,S,b,g,w,k;return m.preventDefault(),g=n.prototype.kind,g==="image"&&(g=((v=n.prototype.success_params)!=null?v.type:void 0)||g),w=t.upload_prefix()+("/upload?type="+g),(b=(S=n.prototype.success_params)!=null?S.thumb_size:void 0)&&(w+="&thumb_size="+b),d=I.Lightbox.open_tpl("upload_lightbox",I.UploadLightbox,w,n.prototype.label),k=null,I.event("upload","open",g),d.el.on("i:lightbox_close",function(C){return function(){return $(document).off("i:upload_popup_msg")}}(this)),$(document).on("i:upload_popup_msg",function(C){return function(T,D){switch(D.type){case"save_upload":if(!k)throw"no uploader";return $(document).off("i:upload_popup_msg"),I.event("upload","save",g),p(-1),typeof o.finish_upload=="function"&&o.finish_upload(k,D.data),typeof k.after_save=="function"&&k.after_save(),k=null,d.closable=!0,I.Lightbox.close();case"start_upload":if(k)throw"upload already started";return I.event("upload","start",g),d.closable=!1,d.el.addClass("not_closable"),k=new n(t,{size:D.size,name:D.name},{}),k.upload_data=D.data,typeof k.have_upload_data=="function"&&k.have_upload_data(),typeof o.queue_upload=="function"&&o.queue_upload(k),p(1),typeof k.progress=="function"&&k.progress(1,1),k.start_upload=function(){},k.save_upload=function(){}}}}(this))},r.on("click",function(m){return function(d){return t.prepare_upload?t.prepare_upload(function(){return l(d)}):l(d)}}(this))},I.prepare_download=function(t,r,n,o,l){return l==null&&(l={}),n&&(l.key=n),I.add_react(),I.proxy_downloads&&(l.proxy=!0),$.ajax({url:"/"+t+"/file/"+r+"?"+$.param(l),type:"post",data:I.with_csrf(),success:function(c){return function(p){var m;if(p.errors){m=p.errors.join(","),I.event("game_download","error",m),R.ErrorLightbox?I.Lightbox.open(R.ErrorLightbox({errors:p.errors})):alert(m);return}return typeof o=="function"?o(p.url,p):void 0}}(this)})},I.start_download=function(t){return t.url?(_.defer(function(r){return function(){var n,o;if(t.external){window.open(t.url);return}return n=window.location.protocol.match("/^https\b"),o=n&&!url.match(/^https\b/),o?window.location=t.url:I.is_ios()?window.open(t.url):$('<iframe frameborder="0" style="width: 0; height: 0; visibility: hidden;"></iframe>').attr("src",t.url).appendTo(document.body)}}(this)),!0):!1},I.UploadLightbox=function(t){i(r,t);function r(){return r.__super__.constructor.apply(this,arguments)}return r.prototype.init=function(n,o){if(this.iframe=this.el.find("iframe").attr("src",n),o)return this.el.find(".label").text(o)},r}(I.Lightbox)}.call(this),function(){I.VideoEmbed=function(){function f(a){this.el=$(a),this.el.lazy_images({selector:".video_drop",show_item:function(u){return function(s){return s.replaceWith(s.data("template"))}}(this)})}return f}()}.call(this),function(){var f=function(s,i){return function(){return s.apply(i,arguments)}},a=function(s,i){for(var e in i)u.call(i,e)&&(s[e]=i[e]);function t(){this.constructor=s}return t.prototype=i.prototype,s.prototype=new t,s.__super__=i.prototype,s},u={}.hasOwnProperty;I.BuyGameLightbox=function(s){a(i,s);function i(){return this.load_fingerprint=f(this.load_fingerprint,this),i.__super__.constructor.apply(this,arguments)}return i.prototype.init=function(e,t){return this.game=e,this.buy=new I.BuyForm(this.el,this.game,t),this.buy.event_category=t.event_category||"view_game",this.buy.submit_handler=this.buy.remote_submit,this.load_fingerprint(function(r){return function(){return r.buy.set_fingerprint()}}(this)),this.el.on("i:loading",function(r){return function(n,o){return r.closable=!o}}(this)),this.el.on("i:buy_start",function(r){return function(n,o){var l,c,p,m,d,v,S,b;for(S=null,l=null,v=[],c=0,p=o.length;c<p;c++)switch(d=o[c],m=d.name,b=d.value,m){case"source":v.push(S=b);break;case"price":v.push(l=b);break;default:v.push(void 0)}return v}}(this)),this.el.on("i:buy_complete",function(r){return function(n){return r.closable=!0,I.Lightbox.close()}}(this))},i.prototype.load_fingerprint=function(e){var t;if(window.Fingerprint2){typeof e=="function"&&e();return}if(t=this.el.data("checkout"),!!t)return $(document.body).append(t),I.wait_for_object(window,"Fingerprint2",e)},i}(I.Lightbox)}.call(this),function(){var f=function(u,s){for(var i in s)a.call(s,i)&&(u[i]=s[i]);function e(){this.constructor=u}return e.prototype=s.prototype,u.prototype=new e,u.__super__=s.prototype,u},a={}.hasOwnProperty;I.PickImageLightbox=function(u){f(s,u);function s(){return s.__super__.constructor.apply(this,arguments)}return s.prototype.init=function(i){return this.el.dispatch("click",{tab_btn:function(e){return function(t){var r;return r=t.data("tab"),e.el.find(".tab_content").hide().filter("[data-tab="+r+"]").show(),e.el.find(".tab_btn").removeClass("selected").filter(t).addClass("selected")}}(this),pick_image_btn:function(e){return function(t){return typeof i=="function"?i(t.data("url")):void 0}}(this),upload_image_btn:function(e){return function(t){return I.upload_image({url:I.root_url("dashboard/upload-image"),thumb_size:"original"}).progress(function(){if(!t.prop("disabled"))return t.prop("disabled",!0).addClass("disabled"),t.data("original_text",t.text()),t.text("Uploading...")}).fail(function(){return t.prop("disabled",!1).removeClass("disabled"),t.text(t.data("original_text"))}).done(function(r){var n,o;return t.prop("disabled",!1).removeClass("disabled"),t.text(t.data("original_text")),r.success?typeof i=="function"?i(r.upload.thumb_url):void 0:(n=((o=r.errors)!=null?o[0]:void 0)||"Image upload failed",I.flash(n,"error"))})}}(this)})},s}(I.Lightbox)}.call(this),function(){I.libs.react.done(function(){var f,a,u,s,i,e,t,r,n,o,l,c,p,m,d,v,S,b,g,w,k,C,T,D,j,A,W,V,J,Q,G,Z,X,Y,B,U=[].slice;a=ReactDOMFactories,t=a.div,G=a.span,u=a.a,s=a.br,W=a.p,D=a.ol,B=a.ul,T=a.li,Z=a.strong,r=a.em,g=a.img,o=a.form,k=a.label,w=a.input,X=a.textarea,i=a.button,b=a.iframe,c=a.h1,p=a.h2,m=a.h3,d=a.h4,v=a.h5,S=a.h6,V=a.pre,e=a.code,Q=a.select,A=a.option,J=a.section,j=a.optgroup,n=a.fieldset,C=a.legend,l=React.createElement.bind(null,React.Fragment),l.type=React.fragment,f=R.package("Forms"),Y=PropTypes,f("FileUploader",{propTypes:{label:Y.string,upload:Y.shape({id:Y.number,url:Y.string}),upload_func:Y.func},getInitialState:function(){return{upload:this.props.upload}},componentDidMount:function(){return this.dispatch({delete_upload:function(M){return function(h){return M.setState({loading:!0}),$.ajax({url:M.state.upload.url,type:"post",data:I.with_csrf({action:"delete",upload_id:M.state.upload.id})}).done(function(y){if(y.errors){alert(y.errors.join());return}return M.setState({loading:!1,upload:null})})}}(this),pick_file:function(M){return function(h){if(!(M.state.uploading||M.state.loading))return(M.props.upload_func||I.upload_file)({url:M.props.upload_url,on_start_upload:function(){if(!M.state.uploading)return M.setState({uploading:!0})}}).progress(function(y,x,N){if(console.warn.apply(console,arguments),y==="progress")return M.setState({progress:x/N})}).fail(function(){return M.setState({uploading:!1}),console.error.apply(console,["upload failed"].concat(U.call(arguments)))}).done(function(y){return M.setState({uploading:!1,upload:y.upload})})}}(this)})},render_preview_upload:function(){return this.props.render_preview_upload?this.props.render_preview_upload():G({className:"upload_filename"},this.state.upload.filename)},render:function(){var M,h;return h=this.state.uploading?"Uploading"+(this.state.progress&&" ("+Math.floor(this.state.progress*100)+"%)"||""):this.state.loading?"Loading...":this.props.label?this.props.label:this.state.upload?"Replace upload":"Upload",M=this.state.uploading||this.state.loading,t({className:"file_uploader"},i({className:classNames("button",{disabled:M}),disabled:M,onClick:function(y){return function(x){return x.preventDefault(),y.trigger("pick_file")}}(this)},h)," ",this.state.upload?w({type:"hidden",name:this.props.name,value:this.state.upload.id}):void 0,this.state.upload&&!this.state.loading?u({href:"#",onClick:function(y){return function(x){return x.preventDefault(),y.trigger("delete_upload")}}(this)},"Remove upload"):void 0,this.state.upload?this.render_preview_upload():void 0)}})})}.call(this),function(){I.libs.react.done(function(){var f,a,u,s,i,e,t,r,n,o,l,c,p,m,d,v,S,b,g,w,k,C,T,D,j,A,W,V,J,Q,G,Z,X,Y;f=ReactDOMFactories,e=f.div,Q=f.span,a=f.a,u=f.br,A=f.p,T=f.ol,Y=f.ul,C=f.li,G=f.strong,t=f.em,b=f.img,n=f.form,w=f.label,g=f.input,Z=f.textarea,s=f.button,S=f.iframe,l=f.h1,c=f.h2,p=f.h3,m=f.h4,d=f.h5,v=f.h6,W=f.pre,i=f.code,J=f.select,j=f.option,V=f.section,D=f.optgroup,r=f.fieldset,k=f.legend,o=React.createElement.bind(null,React.Fragment),o.type=React.fragment,X=PropTypes,R("FollowButton",{propTypes:{following:X.bool,show_name:X.bool,name:X.string,login_url:X.string,user_id:X.number,follow_data:X.object,follow_url:X.string.isRequired,unfollow_url:X.string.isRequired},getInitialState:function(){return{following:this.props.following}},getDefaultProps:function(){return{show_name:!0}},componentDidUpdate:function(B,U){if(!U.animate_class&&this.state.animate_class)return this.timer&&(window.clearTimeout(this.timer),delete this.timer),this.timer=setTimeout(function(M){return function(){return M.setState({animate_class:null})}}(this),500)},componentWillUnmount:function(){if(this.timer)return window.clearTimeout(this.timer),delete this.timer},render:function(){var B;return B=this.state.following?this.state.hovering?this.props.show_name?this.tt("misc.follow_button.unfollow_username",{username:this.props.name}):this.tt("misc.follow_button.unfollow"):React.createElement(React.Fragment,{},Q({className:"icon icon-checkmark","aria-hidden":!0,role:"img"}),this.props.show_name?this.tt("misc.follow_button.following_username",{username:this.props.name}):this.tt("misc.follow_button.following")):React.createElement(React.Fragment,{},Q({className:"icon icon-plus","aria-hidden":!0,role:"img"}),this.props.show_name?this.tt("misc.follow_button.follow_username",{username:this.props.name}):this.tt("misc.follow_button.follow")),this.enclose({component:this.props.login_url?"a":"button",href:this.props.login_url,"data-label":"follow_btn",className:classNames("button",{is_following:this.state.following,disabled:this.state.loading},this.state.animate_class,this.props.className),onMouseEnter:function(U){return function(){return U.setState({hovering:!0})}}(this),onMouseLeave:function(U){return function(){return U.setState({hovering:!1})}}(this),target:this.props.target,onClick:function(U){return function(M){var h,y;if(!U.props.login_url&&!U.state.loading)return M.preventDefault(),h=$(M.target),U.setState({loading:!0,animate_class:null}),U.container().trigger("i:track_link"),y=U.state.following?U.props.unfollow_url:U.props.follow_url,$.post(y,I.with_csrf(U.props.follow_data),function(x){if(x.errors){I.flash(x.errors.join(", ")),U.setState({loading:!1});return}return h.trigger("i:follow_updated",[{user_id:U.props.user_id,following:x.following,btn:h}]),U.setState({following:x.following,animate_class:x.following?"animate_bounce":"animate_drop_down",loading:!1},function(){var N;return typeof(N=U.props).on_follow_change=="function"?N.on_follow_change(U.state.following):void 0})})}}(this)},B)}})})}.call(this),function(){I.libs.react.done(function(){var f,a,u,s,i,e,t,r,n,o,l,c,p,m,d,v,S,b,g,w,k,C,T,D,j,A,W,V,J,Q,G,Z,X,Y,B,U,M=[].slice;a=ReactDOMFactories,r=a.div,Z=a.span,u=a.a,s=a.br,V=a.p,j=a.ol,U=a.ul,D=a.li,X=a.strong,n=a.em,w=a.img,l=a.form,C=a.label,k=a.input,Y=a.textarea,i=a.button,g=a.iframe,p=a.h1,m=a.h2,d=a.h3,v=a.h4,S=a.h5,b=a.h6,J=a.pre,t=a.code,G=a.select,W=a.option,Q=a.section,A=a.optgroup,o=a.fieldset,T=a.legend,c=React.createElement.bind(null,React.Fragment),c.type=React.fragment,!R.Redactor&&(e=function(h){return function(){return R.component.apply(R,arguments)}}(this),B=PropTypes,e("Redactor",{pure:!0,componentDidMount:function(){var h;return h=$.extend({minHeight:80,source:!1},this.props.redactor_opts),h.callbacks||(h.callbacks={}),h.callbacks.change=function(y){return function(x){var N;if(typeof(N=y.props).on_change=="function"&&N.on_change(x),y.props.remember_key)return y.set_memory||(y.set_memory=_.throttle(function(E){return I.store_memory(this.remember_key(),E)},500)),y.set_memory(x)}}(this),I.redactor($(ReactDOM.findDOMNode(this)),h)},remember_key:function(){return"inputmemory:"+this.props.remember_key},clear_memory:function(){return I.clear_memory(this.remember_key())},get_default_value:function(){var h;if((h=this.props.defaultValue)||this.props.remember_key&&(h=typeof localStorage!="undefined"&&localStorage!==null?localStorage.getItem(this.remember_key()):void 0))return h},render:function(){return Y({name:this.props.name,value:this.props.value,defaultValue:this.get_default_value(),placeholder:this.props.placeholder,required:this.props.required,autoFocus:this.props.autofocus})}}),e("CSRF",{pure:!0,render:function(){return k({type:"hidden",name:"csrf_token",value:$("meta[name=csrf_token]").attr("value")})}}),R.DownTickIcon=React.createElement("svg",{className:"svgicon icon_down_tick2",strokeLinecap:"round",stroke:"currentColor",role:"img",version:"1.1",viewBox:"0 0 24 24",strokeWidth:"2",width:"22",height:"22",strokeLinejoin:"round","aria-hidden":!0,fill:"none"},React.createElement("polyline",{points:"6 9 12 15 18 9"})),f=R.package("Forms"),f("InputRow",{pure:!0,propTypes:{title:B.string,sub:B.any},render:function(){var h;return h=React.createElement(React.Fragment,{},r({className:"label",key:"label"},this.props.title,this.props.sub?Z({className:"sub"}," \u2014 ",this.props.sub):void 0),this.props.children),this.props.multi||(h=C({children:h})),r({className:classNames("input_row",this.props.className),id:this.props.id},h)}}),f("TextInputRow",{pure:!0,propTypes:{title:B.string,sub:B.any,name:B.string.isRequired,value:B.any},focus:function(){return this.input_ref.current.focus()},get_input_el:function(){return this.input_ref.current},get_value:function(){return this.input_ref.current.value},componentDidMount:function(){var h;if(this.props.money_input){if(!this.props.currency)throw new Error("missing currency");I.money_input(this.input_ref.current,{currency:this.props.currency})}if(this.props.slug_input&&I.slug_input($(this.input_ref.current)),this.props.integer_input)return h=/[0-9]/g,$(this.input_ref.current).on("keypress",function(y){return function(x){var N;if(x.keyCode>=32&&(N=String.fromCharCode(x.keyCode),!N.match(h)))return!1}}(this))},render:function(){var h;return h=[r({className:"label",key:"label"},this.props.title,this.props.sub?Z({className:"sub"}," \u2014 ",this.props.sub):void 0),k({type:"text",key:"input",name:this.props.name,ref:this.input_ref||(this.input_ref=React.createRef()),value:this.props.value,defaultValue:this.props.defaultValue,onChange:this.props.onChange,onKeyUp:this.props.onKeyUp,onFocus:this.props.onFocus,onBlur:this.props.onBlur,onClick:this.props.onClick,readOnly:this.props.readonly,className:classNames({has_error:this.props.has_error}),required:this.props.required,placeholder:this.props.placeholder,disabled:this.props.disabled,pattern:this.props.pattern}),this.props.error_message?V({key:"error",className:"input_error"},this.props.error_message):void 0],this.props.multi||(h=C({children:h})),r({className:classNames("input_row",this.props.className)},h)}}),f("SimpleSelect",{pure:!0,propTypes:{options:B.array.isRequired,name:B.string},getInitialState:function(){return{value:this.props.defaultValue?this.props.defaultValue:void 0}},render:function(){var h,y,x,N,E;return y=this.current_option(),E=this.props.render_current_option,E||(E=function(O){return function(L){return L.short_name||L.name}}(this)),h=[],x=null,N=function(){if(x)return h.push(A.apply(null,[{label:x.label,key:"group-"+h.length}].concat(M.call(x.children)))),x=null},this.props.options.map(function(O){return function(L,q){var H;return H=W({key:""+q,value:L.value},L.name),L.group?((x!=null?x.label:void 0)!==L.group&&N(),x||(x={label:L.group,children:[]}),x.children.push(H)):(N(),h.push(H))}}(this)),N(),this.enclose({className:classNames({focused:this.state.focused,disabled:this.props.disabled,has_value:y!==this.props.options[0]})},r({className:"selected_option"},Z({className:"selected_option_name"},E(y)),R.DownTickIcon),G({ref:this.select_ref||(this.select_ref=React.createRef()),disabled:this.props.disabled,value:y.value,name:this.props.name,onFocus:function(O){return function(L){return O.setState({focused:!0})}}(this),onBlur:function(O){return function(L){return O.setState({focused:!1})}}(this),onChange:this.on_change,children:h}))},on_change:function(h){var y;return y=h.target.value,this.props.onChange?y===this.props.value?void 0:this.props.onChange(y):y===this.state.value?void 0:this.setState({value:y})},find_option:function(h){var y,x,N,E;for(E=this.props.options,y=0,x=E.length;y<x;y++)if(N=E[y],N.value===h)return N},current_option:function(){var h,y;return y=this.props.value||this.state.value,h=y!=null?this.find_option(y):void 0,h||this.props.options[0]}}),f("Select",{propTypes:{name:B.string.isRequired,value:B.any,options:B.array.isRequired},componentDidMount:function(){var h,y;if(this.props.selectize&&(y=this.props.selectize===!0?{}:this.props.selectize,h=$(this.refs.input),h.selectize(y),this.props.onChange))return h.on("change",function(x){return function(N){return x.props.onChange(N)}}(this))},render:function(){return G({ref:"input",name:this.props.name,onChange:this.props.onChange,value:this.props.value,defaultValue:this.props.defaultValue,children:this.props.options.map(function(h){return function(y){var x,N;return N=y[0],x=y[1],W({key:N,value:N},x||N)}}(this))})}}),f("RadioButtons",{propTypes:{name:B.string.isRequired,value:B.any,options:B.array.isRequired},getValue:function(){var h,y,x,N,E,O;for(N=this.container().find("input").serializeArray(),h=0,y=N.length;h<y;h++)return E=N[h],x=E.name,O=E.value,O},render:function(){return U({className:"radio_list",children:this.props.options.map(function(h){return function(y,x){var N,E,O,L;return L=y[0],N=y[1],O=y[2],E=y[3],D({key:L!=null?L:x,className:classNames({disabled:E!=null?E.disabled:void 0})},C({},k($.extend({type:"radio",name:h.props.name,value:L,defaultChecked:h.props.defaultValue?L===h.props.defaultValue:void 0,checked:h.props.value!=null?L===h.props.value:void 0,onChange:h.props.onChange},E)),Z({className:"radio_label"},N),O?Z({className:"sub"}," \u2014 ",O):void 0))}}(this))})}}),f("Slider",{pure:!0,propTypes:{min:B.number,max:B.number,value:B.number,onChange:B.func,disabled:B.bool},getInitialState:function(){return{}},on_change:function(h){return h=Math.round(h),this.props.onChange?this.props.value===h?void 0:this.props.onChange(h):this.state.value===h?void 0:this.setState({value:h})},start_drag:function(h,y){var x,N,E,O;if(!this.props.disabled)return O=this.refs.track.clientWidth,N=this.current_value(),this.setState({dragging:!0}),x=function(L){return function(q){var H,F,z,P;if(q.preventDefault(),q.buttons===0){E();return}if(z=q.pageX,P=q.pageX,H=z-h,F=H/O*(L.props.max-L.props.min)+N,F=Math.min(L.props.max,Math.max(L.props.min,F)),F!==L.current_value())return L.on_change(F)}}(this),E=function(L){return function(q){return q!=null&&q.preventDefault(),L.setState({dragging:!1}),document.body.removeEventListener("mousemove",x),document.body.removeEventListener("mouseup",E),delete L.up_listener}}(this),document.body.addEventListener("mousemove",x),document.body.addEventListener("mouseup",E),this.up_listener=E},current_value:function(){return"value"in this.state?this.state.value||this.props.min:this.props.value||this.props.min},percent:function(){return(this.current_value()-this.props.min)/(this.props.max-this.props.min)},componentWillUnmount:function(){if(this.up_listener)return this.up_listener()},render:function(){var h;return h={left:this.percent()*100+"%"},this.enclose({className:classNames("slider_input",{disabled:this.props.disabled}),onClick:function(y){return function(x){var N,E;if(x.target!==y.refs.slider_nub&&(E=y.refs.track.getBoundingClientRect(),V=Math.min(E.width,Math.max(0,x.pageX-E.left))/E.width,N=y.props.min+V*(y.props.max-y.props.min),N=Math.min(y.props.max,Math.max(y.props.min,N)),N!==y.current_value()))return y.on_change(N)}}(this)},this.props.name?k({type:"hidden",name:this.props.name,value:this.current_value()}):void 0,r({ref:"track",className:"slider_track"},r({className:"slider_fill",style:{width:this.percent()*100+"%"}}),this.state.focused&&this.props.show_tooltip?r({style:h,className:"value_tooltip"},this.current_value()):void 0,i({type:"button",ref:"slider_nub",className:"slider_nub",onFocus:function(y){return function(){return y.setState({focused:!0})}}(this),onBlur:function(y){return function(){return y.setState({focused:!1})}}(this),onMouseDown:function(y){return function(x){return y.start_drag(x.pageX,x.pageY)}}(this),onKeyDown:function(y){return function(x){switch(x.keyCode){case 37:y.on_change(Math.max(y.props.min,y.current_value()-1));break;case 39:y.on_change(Math.min(y.props.max,y.current_value()+1));break;default:return}return x.preventDefault()}}(this),style:h})))}}),f("FilterPicker",{pure:!0,componentWillUnmount:function(){return $(window).off("click",this.window_click_listener)},getDefaultProps:function(){return{label_padding:3}},getInitialState:function(){return{open:!1}},close_picker:function(){if(this.state.open)return this.setState({open:!1,popup_visible:!1}),$(window).off("click",this.window_click_listener)},open_picker:function(){var h,y;return h=this.open_button_ref.current,y=h.getBoundingClientRect(),this.window_click_listener&&$(window).off("click",this.window_click_listener),this.window_click_listener=function(x){return function(N){if(e=$(N.target).closest(x.container()),!e.length)return x.close_picker()}}(this),$(window).on("click",this.window_click_listener),this.setState({open:!0,top:-this.props.label_padding,left:-this.props.label_padding,height:y.height+this.props.label_padding*2},function(x){return function(){return x.filter_popup_ref.current.focus(),_.defer(function(){if(x.window_click_listener&&x.state.open)return x.setState({popup_visible:!0})})}}(this))},render:function(){return this.enclose({className:classNames("filter_picker_widget",{open:this.state.open,popup_visible:this.state.popup_visible}),onKeyDown:this.state.open?function(h){return function(y){if(y.keyCode===27)return h.close_picker()}}(this):void 0},i({type:"button",className:"filter_value",ref:this.open_button_ref||(this.open_button_ref=React.createRef()),onClick:this.state.open?this.close_picker:this.open_picker},Z({className:"value_label"},this.props.label),R.DownTickIcon),r({tabIndex:-1,ref:this.filter_popup_ref||(this.filter_popup_ref=React.createRef()),className:"filter_popup",style:{top:(this.state.top||0)+"px",left:(this.state.left||0)+"px"}},r({style:{marginTop:(this.state.height||0)+"px"},className:"filter_options"},this.props.render_children?this.state.open?this.props.render_children():void 0:this.props.children)))}}),f("StarPicker",{pure:!0,getDefaultProps:function(){return{total_stars:5,star_filled:"icon-star",star_empty:"icon-star2"}},getInitialState:function(){return{}},set_value:function(h){var y;return this.props.set_value?this.props.set_value(h):this.setState({value:h}),typeof(y=this.props).on_change=="function"?y.on_change(h):void 0},render:function(){var h,y,x,N,E,O,L;return L=(x=(N=(E=this.props.value)!=null?E:this.state.value)!=null?N:this.props.defaultValue)!=null?x:0,h=this.state.preview_value||L,O=function(){var q,H,F;for(F=[],y=q=1,H=this.props.total_stars;1<=H?q<=H:q>=H;y=1<=H?++q:--q)F.push(function(z){return function(P){var K,ee,te;return K=P>h?"star icon "+z.props.star_empty:"star icon "+z.props.star_filled,ee=L===P,te=P+" Star"+(P===1?"":"s"),i({key:"star-"+P,type:"button",title:te,role:"radio","aria-describedby":z.props["aria-describedby"],"aria-label":te,"aria-checked":ee?"true":"false",onMouseEnter:function(){return z.setState({preview_value:P})},onMouseLeave:function(){return z.setState({preview_value:null})},onClick:function(){return z.set_value(P)}},Z({className:K}))}}(this)(y));return F}.call(this),this.enclose({"aria-labelledby":this.props["aria-labelledby"],role:"radiogroup",className:classNames(this.props.className,{interactive:!0,previewing:this.state.preview_value!=null,has_value:L>0})},this.props.name?k({type:"hidden",name:this.props.name,value:L>0?L:""}):void 0,O)}}),f("EditableInput",{getInitialState:function(){return{value:null,edit_value:null}},componentDidUpdate:function(h){var y;if(y=this.state.value?this.state.value:this.props.value,this.props.value!==y)return this.setState({value:this.props.value,edit_value:null})},confirm_edit:function(){if(this.state.edit_value)return this.setValue(this.state.edit_value)},cancel_edit:function(){return this.setState({edit_value:null})},setValue:function(h){var y;return this.setState({value:h,edit_value:null}),typeof(y=this.props).onUpdate=="function"?y.onUpdate(h):void 0},render:function(){var h;return k({type:(h=this.props.type)!=null?h:"text",className:this.props.className,name:this.props.name,title:this.props.title,readOnly:this.props.readonly,required:this.props.required,placeholder:this.props.placeholder,disabled:this.props.disabled,pattern:this.props.pattern,value:this.state.edit_value!==null?this.state.edit_value:this.state.value!==null?this.state.value:this.props.value,onKeyDown:function(y){return function(x){if(x.keyCode===27&&(y.cancel_edit(),x.stopPropagation()),x.keyCode===13)return y.confirm_edit(),x.stopPropagation()}}(this),onFocus:function(y){return function(x){return x.target.select()}}(this),onBlur:function(y){return function(x){return y.confirm_edit()}}(this),onChange:function(y){return function(x){return y.setState({edit_value:x.target.value})}}(this)})}}),f("FocusButton",{pure:!0,getInitialState:function(){return{focused:!1}},componentWillUnmount:function(){var h;if(this.state.focused)return typeof(h=this.props).on_decrement_focus=="function"?h.on_decrement_focus():void 0},on_focus:function(){var h;return this.setState({focused:!0}),typeof(h=this.props).on_increment_focus=="function"?h.on_increment_focus():void 0},on_blur:function(){var h;return this.setState({focused:!1}),typeof(h=this.props).on_decrement_focus=="function"?h.on_decrement_focus():void 0},render:function(){var h;return h=$.extend({onFocus:this.on_focus,onBlur:this.on_blur},this.props),delete h.on_increment_focus,delete h.on_decrement_focus,i(h)}}),f("FormErrors",{pure:!0,getDefaultProps:function(){return{animated:!1,scroll_into_view:!1}},propTypes:{title:B.string,errors:B.array.isRequired},render:function(){var h;return h=function(){if(this.props.animated){if(!R.SlideDown)throw new Error("Attempted to render animated errors without R.SlideDown");return R.SlideDown}else return Q}.call(this),h({className:classNames(this.enclosing_class_name(),"form_errors"),role:"alert"},r({ref:this.props.scroll_into_view?function(y){if(y)return typeof y.scrollIntoView=="function"?y.scrollIntoView():void 0}:void 0},this.props.title!==!1?V({},X({},this.props.title||this.tt("misc.forms.form_errors"))):void 0,U({},this.props.errors.map(function(y){return function(x){var N;return N=x==="recaptcha"?"Please complete the CAPTCHA to continue":x,D({key:x},N)}}(this))),this.props.children))}}),f("RecaptchaInput",{propTypes:{sitekey:B.string.isRequired},componentDidMount:function(){return I.with_recaptcha(function(h){return function(){var y;return I.event("recaptcha","show",I.page_name()),y=ReactDOM.findDOMNode(h),grecaptcha.render(y,{sitekey:h.props.sitekey})}}(this))},render:function(){return r({className:"g-recaptcha"})}}))})}.call(this),function(){I.libs.react.done(function(){var f,a,u,s,i,e,t,r,n,o,l,c,p,m,d,v,S,b,g,w,k,C,T,D,j,A,W,V,J,Q,G,Z,X,Y,B,U;a=ReactDOMFactories,t=a.div,Z=a.span,u=a.a,s=a.br,W=a.p,D=a.ol,U=a.ul,T=a.li,X=a.strong,r=a.em,g=a.img,o=a.form,k=a.label,w=a.input,Y=a.textarea,i=a.button,b=a.iframe,c=a.h1,p=a.h2,m=a.h3,d=a.h4,v=a.h5,S=a.h6,V=a.pre,e=a.code,G=a.select,A=a.option,Q=a.section,j=a.optgroup,n=a.fieldset,C=a.legend,l=React.createElement.bind(null,React.Fragment),l.type=React.fragment,!((J=R.Forms)!=null&&J.ColorWheel)&&(f=R.package("Forms"),B=PropTypes,f("PortalElement",{getInitialState:function(){return this.el=document.createElement("div"),$(this.el).addClass("portal_element"),{}},componentDidMount:function(){return this.props.container_el.appendChild(this.el)},componentWillUnmount:function(){return this.props.container_el.removeChild(this.el)},render:function(){return ReactDOM.createPortal(this.props.children,this.el)}}),f("ColorWheel",{render:function(){var M,h,y,x,N,E,O,L,q;return(x=this.state)!=null&&x.color&&!this.props.onChange?(N=this.state.color,M=N[0],O=N[1],h=N[2]):this.props.color&&(E=this.props.color,M=E[0],O=E[1],h=E[2]),M==null&&(M=0),O==null&&(O=50),h==null&&(h=100),y=(M-90)/180*Math.PI,L=Math.cos(y),q=Math.sin(y),this.enclose({},t({className:"color_block",style:{background:"hsl("+M+", 100%, 50%)",width:"101px",height:"101px"}}),t({className:"wheel",style:{width:"195px",height:"195px"},onMouseDown:function(H){return function(F){return F.preventDefault(),H.start_drag(F,F.target,function(z,P){var K,ee;return L=(z-.5)*2,q=(P-.5)*2,K=Math.atan2(q,L)/Math.PI*180,ee=(K+360+90)%360,H.update_color(ee,O,h)})}}(this)}),t({className:"mask",style:{width:"101px",height:"101px"},onMouseDown:function(H){return function(F){return F.preventDefault(),H.start_drag(F,F.target,function(z,P){var K,ee;return ee=(1-z)*100,K=(1-P)*100,H.update_color(M,ee,K)})}}(this)}),t({className:"marker h-marker",style:{left:97+L*84+"px",top:97+q*84+"px"}}),t({className:"marker sl-marker",style:{left:47+101*(100-O)/100+"px",top:47+101*(100-h)/100+"px"}}))},set_hex_color:function(M){var h,y,x,N;try{return N=I.Color.parse_color(M),x=N[0],y=N[1],h=N[2],this.setState({color:I.Color.rgb_to_hsl(x,y,h)})}catch(E){}},update_color:function(M,h,y){return this.props.onChange!=null?this.props.onChange([M,h,y]):this.setState({color:[M,h,y]})},start_drag:function(M,h,y){var x,N,E;if(!((N=this.state)!=null&&N.dragging))return this.setState({dragging:!0}),x=function(O){var L,q,H,F,z;if(O.preventDefault(),O.buttons===0){E();return}return H=h.getBoundingClientRect(),F=O.clientX,z=O.clientY,L=(F-H.left)/(H.right-H.left),q=(z-H.top)/(H.bottom-H.top),L=Math.min(1,Math.max(0,L)),q=Math.min(1,Math.max(0,q)),typeof y=="function"?y(L,q):void 0},E=function(O){return function(L){return L!=null&&L.preventDefault(),document.body.removeEventListener("mousemove",x),document.body.removeEventListener("mouseup",E),delete O.up_listener,O.setState({dragging:!1})}}(this),document.body.addEventListener("mousemove",x),document.body.addEventListener("mouseup",E),x(M),this.up_listener=E}}),f("ColorInputPopup",{palette:["#193d3f","#3f2832","#743f39","#9e2835","#b86f50","#327345","#e53b44","#4f6781","#0484d1","#fb922b","#afbfd2","#63c64d","#e4a672","#2ce8f4","#ffe762"],set_wheel_color:function(M){var h,y,x,N;try{return N=I.Color.parse_color(M),x=N[0],y=N[1],h=N[2],this.setState({wheel_color:I.Color.rgb_to_hsl(x,y,h)})}catch(E){}},componentDidMount:function(){var M;if(!((M=this.state)!=null&&M.wheel_color)&&this.props.color)return this.set_wheel_color(this.props.color)},render:function(){var M,h,y,x;return this.wheel_ref||(this.wheel_ref=React.createRef()),M=this.props.palette||this.palette,(h=this.props.position)&&(x={left:h.left+"px",top:h.top+"px"}),this.enclose({className:"color_popout",style:x},this.props.allow_empty&&this.props.color?i({type:"button",className:"clear_color_btn",onClick:function(N){return function(){var E;return typeof(E=N.props).set_color=="function"?E.set_color(""):void 0}}(this)},"Clear"):void 0,R.Forms.ColorWheel({ref:this.wheel_ref,color:(y=this.state)!=null?y.wheel_color:void 0,onChange:function(N){return function(E){var O,L,q;return typeof(O=N.props).set_color=="function"&&O.set_color((q=I.Color).hex_color.apply(q,(L=I.Color).hsl_to_rgb.apply(L,E))),N.setState({wheel_color:E})}}(this)}),M?t({className:"palette_options"},M.map(function(N){return function(E){return i({key:E,type:"button",style:{backgroundColor:E},onClick:function(O){var L;return typeof(L=N.props).set_color=="function"&&L.set_color(E),N.set_wheel_color(E)}},E)}}(this))):void 0)}}),f("ColorInput",{pure:!0,propTypes:{name:B.string,value:B.any,defaultValue:B.any,allow_empty:B.bool,popout_portal_target:B.object},componentDidMount:function(){var M;return(M=R.Forms.ColorInput).active_inputs||(M.active_inputs=[]),R.Forms.ColorInput.active_inputs.push(this)},componentWillUnmount:function(){var M;return R.Forms.ColorInput.active_inputs=function(){var h,y,x,N;for(x=R.Forms.ColorInput.active_inputs,N=[],h=0,y=x.length;h<y;h++)M=x[h],M!==this&&N.push(M);return N}.call(this)},componentDidUpdate:function(M,h){var y,x,N;if(x=M.value||"",N=this.props.value||"",x!==N&&(y=this.set_color(N)))return this.refs.input.value=y},getInitialState:function(){return{open:!1,last_value:this.props.value||this.props.defaultValue||""}},on_blur:function(){if(!this.set_color_from_input())return this.input_ref.current.value=this.state.last_value,this.set_color(this.state.last_value)},set_color_from_input:function(){var M,h,y;return h=this.input_ref.current.value,h===""&&this.props.allow_empty?(this.setState({has_error:!1,last_value:""}),!0):(h!==""&&!h.match("^#")&&(h="#"+h,this.input_ref.current.value=h),M=I.Color.parse_color(h),M?(this.set_color(h),(y=this.popout_ref.current)!=null&&y.set_wheel_color(h),!0):(this.setState({has_error:!0}),!1))},set_color:function(M){var h;return this.input_ref.current.value=M,this.setState({last_value:M,has_error:!1}),typeof(h=this.props).onChange=="function"?h.onChange(M):void 0},open:function(){if(!this.state.open)return this.setState({open:!0,on_left:this.popout_on_left(),popout_position:this.popout_position()}),this.click_outside_handler||(this.click_outside_handler=function(M){return function(h){var y,x,N;if(N=ReactDOM.findDOMNode(M),!$(h.target).closest(N).length&&!((x=M.popout_ref.current)&&(y=ReactDOM.findDOMNode(x),$(h.target).closest(y).length)))return M.close()}}(this)),$(document.body).on("mousedown",this.click_outside_handler)},componentWillUnmount:function(){if(this.click_outside_handler)return $(document.body).off("mousedown",this.click_outside_handler)},close:function(){if(this.state.open)return this.setState({open:!1}),$("document.body").off("mousedown",this.click_outside_handler)},popout_position:function(){var M,h;if(this.props.popout_portal_target)return M=ReactDOM.findDOMNode(this),h=M.getBoundingClientRect(),{left:Math.trunc(h.right+window.scrollX),top:Math.trunc(h.top+window.scrollY)}},popout_on_left:function(){var M,h;return M=$(ReactDOM.findDOMNode(this)),h=M.offset().left+M.width()+250,h>$(window).width()+$(window).scrollLeft()},render_color_popout:function(){var M,h;return this.popout_ref||(this.popout_ref=React.createRef()),h=R.Forms.ColorInputPopup({ref:this.popout_ref,palette:this.props.palette,color:this.state.last_value,allow_empty:this.props.allow_empty,set_color:this.set_color,position:this.state.popout_position}),(M=this.props.popout_portal_target)&&(h=f.PortalElement({container_el:M},h)),h},render:function(){var M;return M=this.state.last_value||"#ffffff",this.input_ref||(this.input_ref=React.createRef()),this.enclose({className:classNames(this.props.className,{picker_open:this.state.open,picker_left:this.state.on_left,color_error:this.state.has_error})},w({ref:this.input_ref,type:"text",className:"color_text_input",name:this.props.name,defaultValue:this.props.value||this.props.defaultValue,placeholder:this.props.defaultValue||"Color",onBlur:this.on_blur,onFocus:this.open,onKeyDown:function(h){return function(y){switch(y.keyCode){case 9:return h.close()}}}(this),onKeyUp:function(h){return function(y){return h.set_color_from_input()}}(this)}),t({className:"color_swatch",onClick:this.open,style:{backgroundColor:M}}),this.state.open?this.render_color_popout():void 0)}}))})}.call(this),function(){I.libs.react.done(function(){var f,a,u,s,i,e,t,r,n,o,l,c,p,m,d,v,S,b,g,w,k,C,T,D,j,A,W,V,J,Q,G,Z,X,Y,B,U,M,h,y,x,N,E,O,L,q=[].slice,H={}.hasOwnProperty;u=ReactDOMFactories,n=u.div,U=u.span,s=u.a,i=u.br,Q=u.p,W=u.ol,L=u.ul,j=u.li,M=u.strong,o=u.em,k=u.img,c=u.form,T=u.label,C=u.input,N=u.textarea,e=u.button,w=u.iframe,m=u.h1,d=u.h2,v=u.h3,S=u.h4,b=u.h5,g=u.h6,Z=u.pre,t=u.code,B=u.select,J=u.option,Y=u.section,V=u.optgroup,l=u.fieldset,D=u.legend,p=React.createElement.bind(null,React.Fragment),p.type=React.fragment,f=R.package("Forms"),O=PropTypes,h=ReactDOMFactories.table,y=ReactDOMFactories.tbody,E=ReactDOMFactories.tr,x=ReactDOMFactories.td,f("MarkdownInput",{pure:!0,propTypes:{name:O.string,value:O.string},getDefaultProps:function(){return{max_default_height:400}},componentWillUnmount:function(){return this.unmounted=!0},componentDidMount:function(){var F,z;if(z=this.input_ref.current.scrollHeight,F=this.input_ref.current.clientHeight,z>F&&this.setState({default_height:Math.min(z,this.props.max_default_height)}),this.props.autofocus)return _.defer(function(P){return function(){var K;return(K=P.input_ref.current)!=null?K.focus():void 0}}(this))},get_value:function(){var F;return(F=this.input_ref.current)!=null?F.value:void 0},set_value:function(F){return this.input_ref.current.value=F},click_bold_text:function(F){return this.wrap_selection("**","**")},click_italic_text:function(F){return this.wrap_selection("*","*")},click_insert_link:function(F){var z,P,K;if(K=this.get_selected_text(),z=this.input_ref.current,K.match(/^https?:\/\/[^\s]+$/))return this.wrap_selection("[](",")"),z.selectionStart=z.selectionStart-2,z.selectionEnd=z.selectionStart;if(this.wrap_selection("[","](url)"),K.length>0)return P=z.selectionEnd,z.selectionStart=P+2,z.selectionEnd=P+5},click_insert_video:function(F){return I.Lightbox.open(f.MarkdownVideoEmbedLightbox({on_submit:function(z){return function(P){return z.insert_line(P)}}(this)}))},click_insert_image:function(F){return I.Lightbox.open_remote(I.root_url("dashboard/upload-image"),I.PickImageLightbox,function(z){return function(P){var K;if(I.Lightbox.close(),!z.unmounted&&(K=z.input_ref.current))return z.insert_line("![]("+P+")")}}(this))},click_show_help:function(F){return I.Lightbox.open(f.MarkdownHelpLightbox({}))},get_selected_text:function(){var F;return(F=this.input_ref.current)?F.value.substring(F.selectionStart,F.selectionEnd):""},wrap_selection:function(F,z){var P,K,ee,te,re,oe,se,ie,ne;return P=this.input_ref.current,re=P.selectionStart,te=P.selectionEnd,ne=P.value,se=ne.substring(0,P.selectionStart),oe=ne.substring(P.selectionEnd,ne.length),ie=ne.substring(P.selectionStart,P.selectionEnd),P.focus(),ee=""+F+(ie||"")+z,K=document.execCommand("insertText",!1,ee),K||typeof P.setRangeText=="function"&&P.setRangeText(ee),P.selectionStart=re+F.length,P.selectionEnd=te+F.length},insert_line:function(F){var z,P;if(z=this.input_ref.current,z.focus(),P=document.execCommand("insertText",!1,F),!P)return typeof z.setRangeText=="function"&&z.setRangeText(F),z.selectionStart=z.selectionStart+F.length,z.selectionEnd=z.selectionEnd},on_hotkey_keydown:function(F){var z;if(F.metaKey||F.ctrlKey){switch(F.key){case"b":this.click_bold_text(F);break;case"i":this.click_italic_text(F);break;case"k":this.click_insert_link(F);break;case"Enter":typeof(z=this.props).on_submit_hotkey=="function"&&z.on_submit_hotkey();break;default:return}return F.preventDefault()}},render:function(){var F;return this.enclose({},L({className:"markdown_toolbar"},j({},e({tabIndex:-1,type:"button",onClick:this.click_show_help,title:"Markdown Help"},R.Icons.Markdown)),j({},e({tabIndex:-1,type:"button",onClick:this.click_bold_text,title:"Bold"},R.Icons.FormatBold)),j({},e({tabIndex:-1,type:"button",onClick:this.click_italic_text,title:"Italic"},R.Icons.FormatItalic)),j({},e({tabIndex:-1,type:"button",title:"Insert link",onClick:this.click_insert_link},R.Icons.InsertLink)),j({},e({tabIndex:-1,type:"button",title:"Insert image",onClick:this.click_insert_image},R.Icons.InsertImage)),j({},e({tabIndex:-1,type:"button",title:"Insert video",onClick:this.click_insert_video},R.Icons.InsertVideo))),N({name:this.props.name,ref:this.input_ref||(this.input_ref=React.createRef()),defaultValue:this.get_default_value(),className:"markdown_textarea",onKeyDown:this.on_hotkey_keydown,placeholder:this.props.placeholder,required:this.props.required,style:(F=this.state)!=null&&F.default_height?{height:this.state.default_height+"px"}:void 0,onChange:function(z){return function(P){var K,ee;if(ee=P.target.value,typeof(K=z.props).on_change=="function"&&K.on_change(ee),z.props.remember_key)return z.set_memory||(z.set_memory=_.throttle(function(te){return I.store_memory(this.remember_key(),te)},500)),z.set_memory(ee)}}(this)}))},get_default_value:function(){var F;if((F=this.props.value||this.props.defaultValue)||this.props.remember_key&&(F=typeof localStorage!="undefined"&&localStorage!==null?localStorage.getItem(this.remember_key()):void 0))return F},remember_key:function(){return"inputmemory:"+this.props.remember_key},clear_memory:function(){return I.clear_memory(this.remember_key())}}),R.Icons||(R.Icons={}),G=ReactDOMFactories.path,A=ReactDOMFactories.line,X=ReactDOMFactories.rect,R.Icons.Markdown=React.createElement("svg",{className:classNames("svgicon markdown_icon"),role:"img",version:"1.1",viewBox:"0 0 208 128",fill:"currentColor"},G({d:"M193 128H15a15 15 0 0 1-15-15V15A15 15 0 0 1 15 0h178a15 15 0 0 1 15 15v98a15 15 0 0 1-15 15zM50 98V59l20 25 20-25v39h20V30H90L70 55 50 30H30v68zm134-34h-20V30h-20v34h-20l30 35z"})),r=function(){var F,z,P;return z=arguments[0],F=2<=arguments.length?q.call(arguments,1):[],React.createElement.apply(React,["svg",{className:classNames("svgicon",z.className),role:"img",version:"1.1",viewBox:"0 0 24 24",width:"24",height:"24",fill:(P=z!=null?z.fill:void 0)!=null?P:"none",stroke:"currentColor",strokeWidth:"3",strokeLinejoin:"round","aria-hidden":!0}].concat(q.call(F)))},R.Icons.FormatBold=r({className:"icon_format_bold"},G({d:"M6 4h8a4 4 0 0 1 4 4 4 4 0 0 1-4 4H6z"}),G({d:"M6 12h9a4 4 0 0 1 4 4 4 4 0 0 1-4 4H6z"})),R.Icons.FormatItalic=r({className:"icon_format_italic"},A({x1:"19",y1:"4",x2:"10",y2:"4"}),A({x1:"14",y1:"20",x2:"5",y2:"20"}),A({x1:"15",y1:"4",x2:"9",y2:"20"})),R.Icons.InsertLink=r({className:"icon_insert_link"},G({d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"}),G({d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"})),R.Icons.InsertImage=r({className:"icon_insert_image"},X({x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),React.createElement("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),React.createElement("polyline",{points:"21 15 16 10 5 21"})),R.Icons.InsertVideo=r({className:"icon_insert_video"},G({d:"M22.54 6.42a2.78 2.78 0 0 0-1.94-2C18.88 4 12 4 12 4s-6.88 0-8.6.46a2.78 2.78 0 0 0-1.94 2A29 29 0 0 0 1 11.75a29 29 0 0 0 .46 5.33A2.78 2.78 0 0 0 3.4 19c1.72.46 8.6.46 8.6.46s6.88 0 8.6-.46a2.78 2.78 0 0 0 1.94-2 29 29 0 0 0 .46-5.25 29 29 0 0 0-.46-5.33z"}),React.createElement("polygon",{points:"9.75 15.02 15.5 11.75 9.75 8.48 9.75 15.02"})),a={youtube:/https?:\/\/(?:[0-9A-Z-]+\.)?(?:youtu\.be\/|youtube(?:\-nocookie)?\.com\S*[^\w\-\s])([\w\-]{11})(?=[^\w\-]|$)(?![?=&+%\w.\-]*(?:['"][^<>]*>|<\/a>))[?=&+%\w.-]*/ig,vimeo:/https?:\/\/(www\.)?vimeo.com\/(\d+)($|\/)/,sketchfab_old:/https?:\/\/(?:www\.)?sketchfab\.com\/models\/([\w]+)($|\/)/,sketchfab:/https?:\/\/(?:www\.)?sketchfab\.com\/3d-models\/.*?-([^-]+)$/},f("MarkdownVideoEmbedLightbox",{pure:!0,getInitialState:function(){return{is_valid:!1}},componentDidMount:function(){return _.defer(function(F){return function(){var z;return(z=F.input_ref.current)!=null?z.focus():void 0}}(this))},generate_youtube_embed_code:function(F){return'<iframe width="560" height="315" src="https://www.youtube.com/embed/'+F+'" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>'},generate_vimeo_embed_code:function(F){return'<iframe src="https://player.vimeo.com/video/'+F+'" width="560" height="315" frameborder="0" allow="autoplay; fullscreen" allowfullscreen></iframe>'},generate_sketchfab_embed_code:function(F){return'<iframe width="560" height="315" src="https://sketchfab.com/models/'+F+'/embed" frameborder="0" allow="autoplay; fullscreen; vr" mozallowfullscreen="true" webkitallowfullscreen="true"></iframe>'},parse_input_value:function(){var F,z,P,K,ee,te,re;if(te=$.trim(((P=this.input_ref.current)!=null?P.value:void 0)||""),te.match(/<iframe/i))return te;for(ee in a)if(H.call(a,ee)&&(z=a[ee],F=te.match(z),!!F))switch(ee){case"youtube":if(re=(K=F[0].match(/v=([^>"'&]+)/))||(K=F[0].match(/embed\/([^>"'&\/]+)/))?K[1]:void 0,re)return this.generate_youtube_embed_code(re);break;case"vimeo":if(re=F[2])return this.generate_vimeo_embed_code(re);break;case"sketchfab":case"sketchfab_old":if(re=F[1])return this.generate_sketchfab_embed_code(re);break;default:console.log(ee,F)}},render:function(){return R.Lightbox({className:classNames(this.enclosing_class_name(),"compact")},d({},"Embed Video"),c({className:"form",onSubmit:this.on_submit||(this.on_submit=function(F){return function(z){var P;if(z.preventDefault(),!!(F.state.is_valid&&F.state.embed_code))return typeof(P=F.props).on_submit=="function"&&P.on_submit(F.state.embed_code),I.Lightbox.close()}}(this))},n({className:"label"},"Youtube/Vimeo/Sketchfab URL or ",t({},"<iframe>")," embed code"),n({className:"input_split"},C({type:"text",required:"required",placeholder:"Please paste a valid URL or embed code",ref:this.input_ref||(this.input_ref=React.createRef()),onChange:this.on_change||function(F){return function(z){var P;return P=F.parse_input_value(),F.setState({embed_code:P,is_valid:!!P})}}(this)})," ",e({disabled:!this.state.is_valid,className:classNames("button",{disabled:!this.state.is_valid})},"Insert"))))}}),f("MarkdownHelpLightbox",{pure:!0,render:function(){var F;return F=function(){var z,P;return z=arguments[0],P=2<=arguments.length?q.call(arguments,1):[],E({},x({className:"format_type"},z),x.apply(null,[{className:"format_example"}].concat(q.call(P))))},R.Lightbox({className:classNames(this.enclosing_class_name(),"compact")},d({},"Quick Markdown Guide"),Q({},"Markdown is a writing format that converts into HTML."),n({className:"table_wrapper"},h({className:"nice_table"},y({},F("Bold","**Bolded text here**"),F("Italic","*Emphasized text here*"),F("Bullet list","* First item",i({}),"* Second item"),F("Link","[Linked text](http://example.com)"),F("Blockquote","> Quoted text here",i({}),"> Can span multiple lines"),F("Code","```",i({}),'print("Hello world")',i({}),"```"),F("Video embeds",o({},"Paste embed code directly"))))),Q({},s({href:"https://commonmark.org/help/",target:"_blank"},"Extended tutorial \u2197"),". You can also use a subset of HTML directly for advanced formatting."))}})})}.call(this),function(){I.libs.react.done(function(){var f,a,u,s,i,e,t,r,n,o,l,c,p,m,d,v,S,b,g,w,k,C,T,D,j,A,W,V,J,Q,G,Z,X,Y,B=[].slice;f=ReactDOMFactories,t=f.div,G=f.span,a=f.a,u=f.br,W=f.p,D=f.ol,Y=f.ul,T=f.li,Z=f.strong,r=f.em,g=f.img,o=f.form,k=f.label,w=f.input,X=f.textarea,s=f.button,b=f.iframe,c=f.h1,p=f.h2,m=f.h3,d=f.h4,v=f.h5,S=f.h6,V=f.pre,i=f.code,Q=f.select,A=f.option,J=f.section,j=f.optgroup,n=f.fieldset,C=f.legend,l=React.createElement.bind(null,React.Fragment),l.type=React.fragment,R.Icons||(R.Icons={}),e=function(){var U,M,h;return M=arguments[0],U=2<=arguments.length?B.call(arguments,1):[],React.createElement.apply(React,["svg",{className:classNames("svgicon",M.className),role:"img",version:"1.1",viewBox:"0 0 24 24",width:"24",height:"24",fill:(h=M!=null?M.fill:void 0)!=null?h:"none",stroke:"currentColor",strokeWidth:"2",strokeLinejoin:"round",strokeLinecap:"round","aria-hidden":!0}].concat(B.call(U)))},R.Icons.TriUp=e({className:"icon_tri_up",fill:"currentColor"},React.createElement("polygon",{points:"2 18 12 6 22 18"})),R.Icons.TriDown=e({className:"icon_tri_down",fill:"currentColor"},React.createElement("polygon",{points:"2 6 12 18 22 6"})),R.Icons.Filter=e({className:"icon_filter"},React.createElement("polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"})),R.Icons.Edit=e({className:"icon_edit"},React.createElement("path",{d:"M20 14.66V20a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h5.34"}),React.createElement("polygon",{points:"18 2 22 6 12 16 8 16 8 12 18 2"})),R.Icons.External=e({className:"icon_external_link"},React.createElement("path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"}),React.createElement("polyline",{points:"15 3 21 3 21 9"}),React.createElement("line",{x1:"10",y1:"14",x2:"21",y2:"3"}))})}.call(this),function(){I.libs.react.done(function(){var f,a,u,s,i,e,t,r,n,o,l,c,p,m,d,v,S,b,g,w,k,C,T,D,j,A,W,V,J,Q,G,Z,X,Y,B,U;a=ReactDOMFactories,r=a.div,Z=a.span,u=a.a,s=a.br,V=a.p,j=a.ol,U=a.ul,D=a.li,X=a.strong,n=a.em,w=a.img,l=a.form,C=a.label,k=a.input,Y=a.textarea,i=a.button,g=a.iframe,p=a.h1,m=a.h2,d=a.h3,v=a.h4,S=a.h5,b=a.h6,J=a.pre,e=a.code,G=a.select,W=a.option,Q=a.section,A=a.optgroup,o=a.fieldset,T=a.legend,c=React.createElement.bind(null,React.Fragment),c.type=React.fragment,f=R.package("Forms"),B=PropTypes,t=0,f("Image",{pure:!0,getInitialState:function(){return{loaded:!1}},render:function(){return w({className:classNames(this.enclosing_class_name(),this.props.className,{image_loading:!this.state.loaded}),src:this.props.src,onLoad:function(M){return function(){var h;return M.setState({loaded:!0}),typeof(h=M.props).on_load=="function"?h.on_load():void 0}}(this)})}}),f("Video",{pure:!0,render:function(){return React.createElement("video",{width:200,loop:!0,muted:!0,autoPlay:!0,src:this.props.src})}}),f("ImageUploader",{pure:!0,propTypes:{upload_url:B.string.isRequired,name:B.string.isRequired,thumb_size:B.string,label:B.string,upload:B.object,show_replace:B.bool},getDefaultProps:function(){return{remove_button_classes:["button","outline","small"],replace_button_classes:["button","outline","small"],upload_button_classes:"button"}},getInitialState:function(){return{active_uploads:[],uploads:this.props.upload?[this.props.upload]:this.props.uploads}},push_errors:function(M){var h,y,x,N;return typeof M=="string"&&(M=[M]),y=function(){var E,O,L;for(L=[],E=0,O=M.length;E<O;E++)if(h=M[E],typeof h=="string")L.push(h);else if(Array.isArray(h))N=h[0],x=h[1],x?L.push(x.name+" - "+N):L.push(N);else continue;return L}(),this.setState(function(E){return{errors:(E.errors||[]).concat(y)}})},get_progress:function(){return Math.min.apply(Math,this.state.active_uploads.map(function(M){return function(h){return h.progress}}(this)))},pick_image:function(M){return this.setState({errors:[]}),I.upload_image({url:this.props.upload_url,accept:this.props.accept,thumb_size:this.props.thumb_size,multiple:this.props.multiple,max_size:this.props.max_size,test_file:function(h){return function(y,x){return $.when(I.test_image_dimensions(y),I.test_image_format(y)).done(function(){return x.resolve()}).fail(function(N){return x.reject(N)})}}(this),on_start_upload:function(h){return function(y,x,N){var E;return E={file:y,upload:x,xhr:N,progress:0},h.setState(function(O){return{active_uploads:O.active_uploads.concat([E]),uploading:!0}}),N.progress(function(O,L,q){var H;return H=Object.assign({},E,{progress:L/q}),h.setState(function(F){return{active_uploads:F.active_uploads.map(function(z){return function(P){return P===E?H:P}}(this))}}),E=H}).done(function(O){var L;if(O.errors){h.push_errors(O.errors);return}if(x=O.upload,typeof M=="function"&&M(),x)return typeof(L=h.props).on_upload=="function"&&L.on_upload(x),h.setState(function(q){return{uploads:(q.uploads||[]).concat([x])}})}).always(function(){return h.setState(function(O){var L;return L=O.active_uploads.filter(function(q){return function(H){return H!==E}}(this)),{uploading:!!L.length,active_uploads:L}})})}}(this)}).fail(function(h){return function(y){return h.push_errors(y)}}(this))},remove_image:function(M){var h,y;if(y=this.state.uploads[M],this.setState(function(x){var N;return{uploads:function(){var E,O,L,q;for(L=this.state.uploads,q=[],E=0,O=L.length;E<O;E++)N=L[E],N!==y&&q.push(N);return q}.call(this)}}),!this.props.multiple)return typeof(h=this.props).on_upload=="function"?h.on_upload(null):void 0},render_existing_upload:function(M,h){var y;return y=this.props.multiple?this.props.name+"["+(h+1)+"]":this.props.name,r({className:"existing_upload",key:M.id},k({type:"hidden",name:y,value:M.id}),M.thumb_url?r({className:"preview_image"},M.thumb_url.match(/\.mp4$/)?f.Video({src:M.thumb_url}):f.Image({src:M.thumb_url})):void 0,this.props.children,r({className:"existing_upload_tools"},this.props.show_replace?i({className:classNames("replace_image_btn",this.props.replace_button_classes),type:"button",onClick:function(x){return function(N){return N.preventDefault(),x.pick_image(function(){return x.remove_image(h)})}}(this)},"Replace image"):void 0,i({className:classNames("remove_image_btn",this.props.remove_button_classes),type:"button",onClick:function(x){return function(N){return N.preventDefault(),x.remove_image(h)}}(this)},"Remove image")))},render:function(){var M,h,y,x,N,E;return this.autogen_id="image-uploader-"+t++,M=!!((h=this.state.uploads)!=null&&h.length),this.enclose({className:classNames(this.props.className,{no_upload:!M,have_upload:!!M})},this.props.label?C({className:"label",htmlFor:this.autogen_id},this.props.label):void 0,(y=this.state.errors)!=null&&y.length?R.Forms.FormErrors({errors:this.state.errors,title:"Upload failed"}):void 0,this.props.multiple||(x=this.state.uploads)!=null&&x.length?void 0:k({type:"hidden",name:this.props.name,value:""}),this.state.uploading?r({className:"upload_progress"},this.state.active_uploads.length?"Uploading "+((this.get_progress()||0)*100).toFixed(2)+"%":"Uploading..."):void 0,this.props.multiple||!((N=this.state.uploads)!=null&&N.length)?i({id:this.autogen_id,disabled:!!this.state.uploading,className:classNames(this.props.upload_button_classes,{small:this.props.compact,disabled:!!this.state.uploading}),type:"button",onClick:function(O){return function(L){return L.preventDefault(),O.pick_image()}}(this)},this.props.upload_label||(this.props.multiple?"Upload images":"Upload image")):void 0,(E=this.state.uploads)!=null&&E.length?r({className:"existing_uploads",children:this.state.uploads.map(this.render_existing_upload)}):void 0)}})})}.call(this),function(){I.libs.react.done(function(){var f,a,u,s,i,e,t,r,n,o,l,c,p,m,d,v,S,b,g,w,k,C,T,D,j,A,W,V,J,Q,G,Z,X,Y,B;f=ReactDOMFactories,t=f.div,G=f.span,a=f.a,u=f.br,W=f.p,D=f.ol,B=f.ul,T=f.li,Z=f.strong,r=f.em,g=f.img,o=f.form,k=f.label,w=f.input,X=f.textarea,s=f.button,b=f.iframe,c=f.h1,p=f.h2,m=f.h3,d=f.h4,v=f.h5,S=f.h6,V=f.pre,i=f.code,Q=f.select,A=f.option,J=f.section,j=f.optgroup,n=f.fieldset,C=f.legend,l=React.createElement.bind(null,React.Fragment),l.type=React.fragment,R.Icons||(R.Icons={}),e=null,Y=PropTypes,R.Icons.Close=function(U){var M,h,y,x,N;return U==null&&(U={}),N=(h=U.width)!=null?h:24,M=(y=U.height)!=null?y:N,React.createElement("svg",{className:"svgicon icon_close",strokeLinecap:"round",stroke:"currentColor",role:"img",version:"1.1",viewBox:"0 0 24 24",strokeWidth:(x=U.stroke_width)!=null?x:"2",width:N,height:M,strokeLinejoin:"round","aria-hidden":!0,fill:"none"},React.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),React.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"}))},R.component("Lightbox",{is_modal_dialog:function(){var U;return U=document.getElementById("lightbox_container"),U!=null?U.contains(this.container_ref.current):void 0},getInitialState:function(){return{}},componentDidMount:function(){if(this.is_modal_dialog())return e?console.warn("A dialog already has the focus trap"):(this.detect_focus=function(U){return function(M){var h;if(h=U.container_ref.current,h&&"contains"in h&&!(h===M.target||h.contains(M.target)))return h.focus()}}(this),$(document.body).on("focusin",this.detect_focus),e=this),this.setState({previously_focused:document.activeElement,is_modal_dialog:!0},function(){return _.defer(function(U){return function(){var M;return(M=U.container_ref.current)!=null?M.focus():void 0}}(this))})},componentWillUnmount:function(){var U;return this.detect_focus&&($(document.body).off("focusin",this.detect_focus),e=null,delete this.detect_focus),(U=this.state.previously_focused)!=null?U.focus():void 0},render:function(){return t({className:classNames("lightbox",this.props.className),style:this.props.style,role:this.state.is_modal_dialog?"dialog":void 0,"aria-modal":this.state.is_modal_dialog?"true":void 0,tabIndex:this.state.is_modal_dialog?-1:void 0,ref:this.container_ref||(this.container_ref=React.createRef())},this.props.close!==!1?s({className:"close_button",type:"button","aria-label":"Close Dialog"},R.Icons.Close({width:18})):void 0,this.props.children)}}),R.component("ErrorLightbox",{propTypes:{title:Y.string,errors:Y.array.isRequired},render:function(){return R.Lightbox({className:classNames(this.enclosing_class_name(),"compact")},p({},this.props.title||"Your request could not be completed"),R.Forms.FormErrors({title:!1,errors:this.props.errors}),W({className:"buttons"},s({className:"button",type:"button",onClick:function(U){return function(){return I.Lightbox.close()}}(this)},"Close")))}})})}.call(this),function(){I.libs.react.done(function(){var f,a,u,s,i,e,t,r,n,o,l,c,p,m,d,v,S,b,g,w,k,C,T,D,j,A,W,V,J,Q,G,Z,X;f=ReactDOMFactories,e=f.div,Q=f.span,a=f.a,u=f.br,A=f.p,T=f.ol,X=f.ul,C=f.li,G=f.strong,t=f.em,b=f.img,n=f.form,w=f.label,g=f.input,Z=f.textarea,s=f.button,S=f.iframe,l=f.h1,c=f.h2,p=f.h3,m=f.h4,d=f.h5,v=f.h6,W=f.pre,i=f.code,J=f.select,j=f.option,V=f.section,D=f.optgroup,r=f.fieldset,k=f.legend,o=React.createElement.bind(null,React.Fragment),o.type=React.fragment,R.component("SlideDown",{getInitialState:function(){return{}},getDefaultProps:function(){return{duration:200,delay:1}},componentDidMount:function(){var Y;return Y=ReactDOM.findDOMNode(this),this.timer=window.setTimeout(function(B){return function(){return B.setState({height:Y.scrollHeight||!1}),B.timer=window.setTimeout(function(){return B.setState({animated:!0})},B.props.duration+50),B.wrapper_ref.current.scrollTop=0}}(this),this.props.delay)},componentWillUnmount:function(){if(this.timer)return window.clearTimeout(this.timer),delete this.timer},render:function(){var Y;return Y=this.state.height===!1?null:this.state.height?this.state.animated?null:{height:this.state.height+"px",overflow:"hidden",transition:"height "+this.props.duration/1e3+"s ease"}:{height:0,overflow:"scroll",transition:"height 0.2s ease"},e({style:Y,className:this.props.className,ref:this.wrapper_ref||(this.wrapper_ref=React.createRef())},this.props.children)}})})}.call(this);
