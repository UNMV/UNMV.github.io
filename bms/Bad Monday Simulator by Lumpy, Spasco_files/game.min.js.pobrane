(function(){var d=function(n,r){for(var u in r)t.call(r,u)&&(n[u]=r[u]);function a(){this.constructor=n}return a.prototype=r.prototype,n.prototype=new a,n.__super__=r.prototype,n},t={}.hasOwnProperty,s=function(n,r){return function(){return n.apply(r,arguments)}};I.setup_layout=function(){return $("#inner_column").max_height($(".header_widget").outerHeight(!0)||0),$(window).on("message",function(n){return function(r){var u,a;if(a=new RegExp("\\/\\/"+$(document.body).data("host")+"\\/"),!!r.originalEvent.origin.match)switch(u=r.originalEvent.data,u.name){case"dimensions":return parent.postMessage({width:$(document).width(),height:$(document).height()},"*")}}}(this)),new I.ViewGameFooter("#view_game_footer")},I.EmbedGameLightbox=function(n){d(r,n);function r(){return r.__super__.constructor.apply(this,arguments)}return r}(I.Lightbox),I.ViewGameFooter=function(){function n(r){this.el=$(r),this.el.dispatch("click",{embed_game_btn:function(u){return function(a){return I.Lightbox.open_remote(a.data("lightbox_url"),I.EmbedGameLightbox)}}(this),report_game_btn:function(u){return function(a){return I.Lightbox.open_remote_react(a.data("lightbox_url"),function(h){return R.Game.ReportLightbox(h)})}}(this)})}return n}(),I.GameUserTools=function(){function n(r){this.el=$(r),I.tracked_links(this.el,"view_game","user_tools"),I.has_follow_button(this.el,{cls:"follow_user_btn",animate_follow:I.is_mobile()?"animate_popout":void 0}),this.el.dispatch("click",{add_to_collection_btn:function(u){return function(a){return I.current_user?I.Lightbox.open_remote(a.attr("href"),I.CollectionLightbox):"continue"}}(this),rate_game_btn:function(u){return function(a){return I.current_user?I.Lightbox.open_remote_react(a.attr("href"),function(h){return h.on_save_rating=function(f){return u.el.find(".rate_game_btn").addClass("has_rating")},h.on_delete_rating=function(f){return u.el.find(".rate_game_btn").removeClass("has_rating")},R.Library.RateGameLightbox(h)}):"continue"}}(this)}),setTimeout(function(u){return function(){return u.el.removeClass("hidden")}}(this),200)}return n}(),I.FirstGameLightbox=function(n){d(r,n);function r(){return this.first_show=s(this.first_show,this),r.__super__.constructor.apply(this,arguments)}return r.prototype.first_show=function(){return I.event("view_game","first_game_lb","show"),I.add_facebook(function(u){return function(){var a;return a="view_game",FB.Event.subscribe("edge.create",function(h){return I.event(a,"fb","like")}),FB.Event.subscribe("edge.remove",function(h){return I.event(a,"fb","unlike")}),FB.Event.subscribe("message.send",function(h){return I.event(a,"fb","share")})}}(this)),I.add_twitter()},r}(I.Lightbox),I.GameGoalBanner=function(){function n(r){this.el=$(r),this.el.dispatch("click",{buy_btn:function(u){return function(a){return I.event("view_game","goal_banner","contribute_btn"),I.is_mobile()?(a.attr("href",I.add_params(a.attr("href"),{initiator:"mobile"})),"continue"):$(".buy_row a.buy_btn").click()}}(this)})}return n}()}).call(this),function(){var d=function(t,s){return function(){return t.apply(s,arguments)}};I.GameDevlogPost=function(){t.prototype.vote_counts_template=I.lazy_template(t,"like_button");function t(s,n){this.render_like_button=d(this.render_like_button,this),this.el=$(s),this.image_viewer=new I.ImageViewer(s),this.el.dispatch("click",{add_to_collection_btn:function(r){return function(u){return I.current_user?I.Lightbox.open_remote(u.attr("href"),I.CollectionLightbox):"continue"}}(this)}),this.render_like_button()}return t.prototype.render_like_button=function(s){var n,r;return r=this.el.find(".like_button_drop"),this.like_button_state||(this.like_button_state=r.data("init")),s&&$.extend(this.like_button_state,s),n=r.html(this.vote_counts_template(this.like_button_state)).children(),n.find("form").remote_submit(function(u){return function(a){return u.render_like_button({liked:!u.like_button_state.liked,likes_count:a.likes_count})}}(this))},t}()}.call(this),function(){var d=function(s,n){for(var r in n)t.call(n,r)&&(s[r]=n[r]);function u(){this.constructor=s}return u.prototype=n.prototype,s.prototype=new u,s.__super__=n.prototype,s},t={}.hasOwnProperty;I.GameHeader=function(s){d(n,s);function n(){n.__super__.constructor.apply(this,arguments),this.el.dispatch("click",{edit_theme_btn:function(r){return function(){return r.toggle_theme_editor()}}(this)}),window.location.hash.match(/\bedit_theme\b/)&&_.defer(function(r){return function(){return r.toggle_theme_editor()}}(this))}return n.prototype.toggle_theme_editor=function(){var r;return r=!I.theme_editor.state.open,I.theme_editor.setState({open:r}),$(document.body).toggleClass("theme_editor_open",r)},n}(I.Header)}.call(this),function(){var d=function(t,s){return function(){return t.apply(s,arguments)}};I.HtmlEmbed=function(){t.current=$.Deferred().done(function(){return window.addEventListener("popstate",function(s){var n;return n=s.state||{},I.HtmlEmbed.current.done(function(r){return r.synchronize_state(n)})})}),t.prototype.ping_time=1e3;function t(s,n){this.opts=n,this.load_frame=d(this.load_frame,this),this.el=$(s),I.HtmlEmbed.current.state()==="resolved"?I.HtmlEmbed.current=$.Deferred().resolve(this):I.HtmlEmbed.current.resolve(this),this.load_archive(),window.history.state&&this.synchronize_state(window.history.state),this.opts.width&&I.ViewGame.current.then(function(r){return function(u){return u.fit_to_width(r.opts.width)}}(this)),this.el.dispatch("click",{load_iframe_btn:function(r){return function(u){return r.load_frame().done(function(a){if(setTimeout(function(){var h;return(h=a[0])!=null?h.focus():void 0},100),I.is_mobile())return r.enter_fullscreen();if(r.opts.start_maximized)return r.enter_maximized()})}}(this),fullscreen_btn:function(r){return function(u){return r.enter_fullscreen()}}(this),restore_btn:function(r){return function(u){return r.load_frame().done(function(a){return setTimeout(function(){var h;return(h=a[0])!=null?h.focus():void 0},100)}),I.is_mobile()?r.enter_fullscreen():r.enter_maximized()}}(this)})}return t.prototype.synchronize_state=function(s){return s.maximized?(this.enter_maximized(!1),setTimeout(function(n){return function(){var r;return(r=n.el.find(".game_frame iframe")[0])!=null?r.focus():void 0}}(this),100)):this.exit_maximized()},t.prototype.load_archive=function(){if(this.opts.load_url)return $.get(this.opts.load_url,function(s){return function(n){if(n.html){s.el.replaceWith(n.html);return}if(n.errors){s.el.replaceWith($('<div class="missing_game"></div>').text(n.errors.join(", ")));return}switch(n.status){case"complete":return s.el.closest(".view_game_page").addClass("ready");case"extracting":return setTimeout(function(){return s.ping_time+=100,s.load_archive()},s.ping_time)}}}(this))},t.prototype.mobile_orientation=function(){var s;if(this.opts.orientation)return this.opts.orientation;if(!(this.opts.width&&this.opts.height)||(s=this.opts.width/this.opts.height,s>=1.4))return"landscape";if(s<=1.7)return"portrait"},t.prototype.load_frame=function(){return this._loaded_frame||(this._loaded_frame=$.Deferred(function(s){return function(n){var r;return r=s.el.find(".iframe_placeholder"),r.replaceWith(r.data("iframe")),s.iframe=s.el.find("#game_drop"),s.el.find(".game_frame").addClass("game_loaded").removeClass("game_pending"),n.resolve(s.iframe)}}(this)))},t.prototype.enter_maximized=function(s){if(s==null&&(s=!0),!this.maximized)return this.maximized=!0,this.load_frame().done(function(n){return function(){return window.history&&s&&window.history.pushState({maximized:!0},document.title),n.el.find(".game_frame").addClass("maximized"),$(document.body).addClass("frame_maximized")}}(this))},t.prototype.exit_maximized=function(){if(this.maximized)return this.maximized=!1,this.el.find(".game_frame").removeClass("maximized"),$(document.body).removeClass("frame_maximized")},t.prototype.enter_fullscreen=function(){var s,n;if(s=this.el.find(".game_frame iframe"),!!s[0]&&(n=this.mobile_orientation(),!I.is_fullscreen()&&!I.request_fullscreen(s[0],n)))return this.enter_maximized()},t}()}.call(this),function(){var d=function(t,s){return function(){return t.apply(s,arguments)}};I.ImageViewer=function(){t.prototype.margin=40,t.prototype._template=function(){return`<div class="screenshot_lightbox lightbox loading">
  <div class="screenshot_container">
    <div class="loader"></div>

    <div class="prev_image_btn">
      <span class="icon-arrow-left"></span>
    </div>

    <img class="lb_screenshot hidden" width="400" height="315">

    <div class="next_image_btn">
      <span class="icon-arrow-right"></span>
    </div>
  </div>
</div>`},t.prototype.size_image=function(){};function t(s){this.size_image=d(this.size_image,this),this.el=$(s),this.el.on("click","[data-image_lightbox]",function(n){return function(r){var u,a,h,f,v,y,j,C;if(!I.is_mobile()&&Image)return C=$(r.currentTarget),u=C.parent().find("[data-image_lightbox]"),I.event("view_game","screenshots","show"),y=I.Lightbox.open(n._template()),y.el.toggleClass("no_tools",u.length<2),a=null,j=function(x){var P,V,O,A,M,L,F;return a=x,P=$(window),F=P.width()-(n.margin+20)*2,L=P.height()-n.margin*2,M=x.naturalWidth,O=x.naturalHeight,V=M/O,M>F&&(M=F,O=F/V),O>L&&(M=L*V,O=L),A=y.el.find(".lb_screenshot"),A.attr("src",x.src),M!==x.naturalWidth||O!==x.naturalHeight?A.attr("width",Math.floor(M)).attr("height",Math.floor(O)):A.attr("width",x.naturalWidth).attr("height",x.naturalHeight),y.position(),A.removeClass("hidden"),y.el.removeClass("loading")},h=function(x){var P;return y.el.addClass("loading"),C=x,P=new Image,P.onload=function(V){return function(){return j(P)}}(this),P.src=$(x).attr("href")},v=function(){var x;return x=C.prev("[data-image_lightbox]"),x.length||(x=$(u[u.length-1])),h(x)},f=function(){var x;return x=C.next("[data-image_lightbox]"),x.length||(x=$(u[0])),h(x)},y.el.dispatch("click",{lb_screenshot:function(x){return u.length<2?I.Lightbox.close():(I.event("view_game","screenshots","click_screenshot"),f())},prev_image_btn:function(x){return I.event("view_game","screenshots","prev_image_btn"),v()},next_image_btn:function(x){return I.event("view_game","screenshots","next_image_btn"),f()}}),y.el.on("i:lightbox_keydown",function(x,P){switch(P.keyCode){case 37:return I.event("view_game","screenshots","keyboard_left"),v();case 39:return I.event("view_game","screenshots","keyboard_right"),f();case 32:return I.event("view_game","screenshots","Keyboard_space"),f()}}),y.el.on("i:lightbox_resize",function(){if(a)return j(a)}),h(C),!1}}(this))}return t}()}.call(this),function(){var d=function(n,r){return function(){return n.apply(r,arguments)}},t=function(n,r){for(var u in r)s.call(r,u)&&(n[u]=r[u]);function a(){this.constructor=n}return a.prototype=r.prototype,n.prototype=new a,n.__super__=r.prototype,n},s={}.hasOwnProperty;I.ViewGame=function(){n.current=$.Deferred();function n(r,u,a){var h;this.game=u,this.opts=a,this.setup_hiding=d(this.setup_hiding,this),this.setup_buy_on_top=d(this.setup_buy_on_top,this),this.register_play=d(this.register_play,this),this.download_upload=d(this.download_upload,this),I.event2("view game",{type:this.game.type_name,paid:this.game.actual_price>0}),I.ViewGame.current.resolve(this),I.tracked_links($(".jam_banner"),"view_game","jam_banner"),h=$(".devlog_banner").find("form").remote_submit(function(f){return function(v){return h.end().slideUp("fast")}}(this),null,[{name:"json",value:"1"}]),this.el=$(r),this.setup_uploads(),this.setup_buy_on_top(),I.tracked_links(this.el,"view_game","main_column"),this.game.hit_url&&$.get(this.game.hit_url),this.game.play_url&&this.register_play(),this.el.on("click mouseup",".launch_btn[data-rp]",function(f){return function(v){var y,j;if(y=$(v.currentTarget),(j=y.data("rp"))&&(y.data("rp",null),!(typeof navigator!="undefined"&&navigator!==null&&typeof navigator.sendBeacon=="function"&&navigator.sendBeacon(j))))return $.get(j)}}(this)),this.el.dispatch("click",{add_to_collection_btn:function(f){return function(v){return I.is_mobile()||!I.current_user?"continue":I.Lightbox.open_remote(v.attr("href"),I.CollectionLightbox)}}(this),toggle_info_btn:function(f){return function(v){return v.closest(".more_information_toggle").toggleClass("open"),f.el.find(".info_panel_wrapper").slideToggle()}}(this),direct_download_btn:function(f){return function(v){if(f.opts.generate_download_url)return $.ajax({url:f.opts.generate_download_url,type:"POST",xhrFields:{withCredentials:!0},data:I.with_csrf({}),success:function(y){if(y.url)return window.top.location=y.url}})}}(this),download_btn:function(f){return function(v){var y;return y={},v.closest(".for_demo").length||(y.after_download_lightbox=!0),f.download_upload(v.data("upload_id"),y)}}(this),buy_btn:function(f){return function(v){return I.event("view_game","buy",""+f.game.id),I.is_mobile()?(v.attr("href",I.add_params(v.attr("href"),{initiator:"mobile"})),"continue"):I.Lightbox.open_remote(v.attr("href"),I.BuyGameLightbox,f.game,{is_donate:!1})}}(this),reward_btn:function(f){return function(v){var y,j,C;return I.event("view_game","buy_reward",""+f.game.id),C=v.attr("href"),j=v.closest(".reward_footer"),y=j.find(".quantity_input"),y&&(C=I.add_params(C,{quantity:y.val()})),I.Lightbox.open_remote(C,I.BuyGameLightbox,f.game,{is_donate:!1})}}(this),donate_btn:function(f){return function(v){return I.event("view_game","donate",""+f.game.id),I.is_mobile()?(v.attr("href",I.add_params(v.attr("href"),{initiator:"mobile"})),"continue"):I.Lightbox.open_remote(v.attr("href"),I.BuyGameLightbox,f.game,{is_donate:v.data("donate")})}}(this)}),this.image_viewer=new I.ImageViewer(r),this.setup_referrer(),this.opts.first_view&&I.Lightbox.open_tpl("first_game_lightbox",I.FirstGameLightbox)}return n.prototype.download_upload=function(r,u){var a;return a=$.extend({source:"view_game",as_props:"1"},u),I.bypass_quarantine&&(a.bypass_quarantine=!0),I.prepare_download(this.game.slug,r,null,function(h){return function(f,v){if(v.lightbox)switch(v.lightbox_type){case"QuarantineLightbox":I.Lightbox.open(R.Game.QuarantineLightbox($.extend({on_force_download:function(){return h.download_upload(r,$.extend({},u,{bypass_quarantine:!0}))}},v.lightbox)));break;default:I.Lightbox.open(R.AfterDownloadLightbox(v.lightbox))}if(I.start_download(v))return I.event("view_game","download",""+h.game.id),I.ConversionTracker.download("1:"+h.game.id),I.ConversionTracker.flush_now()}}(this),a)},n.prototype.register_play=function(){return window.setTimeout(function(r){return function(){return $.get(r.game.play_url)}}(this),(this.game.play_after+3)*1e3)},n.prototype.setup_buy_on_top=function(){var r;if(r=this.el.find(".formatted_description").outerHeight(!0),r<$(window).height()-100)return this.el.removeClass("buy_on_top")},n.prototype.setup_uploads=function(){var r,u,a,h,f,v;for(this.uploads=this.el.find(".uploads"),h=this.uploads.find(".upload"),f=[],u=0,a=h.length;u<a;u++)r=h[u],v=$(r).find(".file_size_value"),f.push(v.html(I.format_bytes(parseInt(v.html()))));return f},n.prototype.setup_hiding=function(r){return $(document.body).on("i:lightbox_open",function(u){return function(){return $(r).css({visibility:"hidden"})}}(this)),$(document.body).on("i:lightbox_close",function(u){return function(){return $(r).css({visibility:"visible"})}}(this))},n.prototype.fit_to_width=function(r){if(r>920)return this.opts.responsive||I.is_mobile()?$("#inner_column").css({width:"auto",maxWidth:r+"px"}):$("#inner_column").css({width:r+"px",maxWidth:r+"px"})},n.prototype.setup_referrer=function(){var r,u;if(!I.ReferrerTracker.has_ref("game",this.game.id)&&(r=$(document.body).data("host"),u=document.referrer,!!u&&!(u.indexOf(r)>=0)))return I.ReferrerTracker.push("game",this.game.id,"game:"+u)},n}(),I.ViewFlashGame=function(n){t(r,n);function r(u,a,h,f){this.swf=h,r.__super__.constructor.call(this,u,a,f),this.embed_game(),this.setup_hiding("#swf_drop")}return r.prototype.get_size=function(u){return $.get("/"+this.game.slug+"/swf_size/"+this.swf.id,function(a){return function(h){return a.swf.data.swf=h.swf,typeof u=="function"?u():void 0}}(this))},r.prototype.embed_game=function(u){var a,h,f,v;if(this.swf)return!this.swf.data.swf&&!u?this.get_size(function(y){return function(){return y.embed_game(!0)}}(this)):(f=this.swf.data.swf,v=f.width,h=f.height,a=swfobject.getFlashPlayerVersion(),(a!=null?a.major:void 0)===0&&!window.location.hash.match(/\bforce_flash\b/)?(this.el.addClass("ready no_flash"),$(document.body).addClass("embed_disabled")):(swfobject.embedSWF(this.swf.url,"swf_drop",v,h,"11.0.0",!1,{},{wmode:"direct",allowfullscreen:"true"}),this.swf_drop=$("#swf_drop"),this.swf_drop.parent().width(v).height(h),this.fit_to_width(v),this.el.addClass("ready")))},r}(I.ViewGame),I.ViewUnityGame=function(n){t(r,n);function r(u,a,h,f){this.unity=h,r.__super__.constructor.call(this,u,a,f),this.embed_game(),this.setup_hiding("#unity_drop embed")}return r.prototype.embed_game=function(){var u,a,h,f;if(this.unity)return u=$("#unity_drop"),f=u.width(),f>920&&$("#inner_column").width(f+40),h=new UnityObject2({params:{disableContextMenu:!0}}),a=_.once(function(v){return I.event("view_game","unity",""+v)}),h.observeProgress(function(v){return function(y){return a(y.pluginStatus),y.pluginStatus==="unsupported"?(u.width("").height(""),$("#inner_column").width(""),v.el.addClass("unity_unsupported")):$(document.body).removeClass("responsive")}}(this)),h.initPlugin(u[0],this.unity.url)},r}(I.ViewGame),I.ViewJavaGame=function(n){t(r,n);function r(u,a,h,f){this.jar=h,r.__super__.constructor.call(this,u,a,f),this.setup_hiding("#jar_drop applet")}return r}(I.ViewGame),I.ViewHtmlGame=function(n){t(r,n);function r(){return r.__super__.constructor.apply(this,arguments)}return r}(I.ViewGame)}.call(this),function(){var d=function(n,r){return function(){return n.apply(r,arguments)}},t=function(n,r){for(var u in r)s.call(r,u)&&(n[u]=r[u]);function a(){this.constructor=n}return a.prototype=r.prototype,n.prototype=new a,n.__super__=r.prototype,n},s={}.hasOwnProperty;I.CommunityArchiveTopicLightbox=function(n){t(r,n);function r(){return this.init=d(this.init,this),r.__super__.constructor.apply(this,arguments)}return r.prototype.init=function(){var u;return this.with_redactor(function(a){return function(){return I.redactor(a.el.find("textarea"),{minHeight:100,source:!1})}}(this)),u=this.el.find("form").remote_submit(function(a){return function(h){if(u.set_form_errors(h.errors),!h.errors)return window.location.reload()}}(this))},r}(I.Lightbox)}.call(this),function(){var d=function(n,r){return function(){return n.apply(r,arguments)}},t=function(n,r){for(var u in r)s.call(r,u)&&(n[u]=r[u]);function a(){this.constructor=n}return a.prototype=r.prototype,n.prototype=new a,n.__super__=r.prototype,n},s={}.hasOwnProperty;I.CommunityBanLightbox=function(n){t(r,n);function r(){return this.init=d(this.init,this),r.__super__.constructor.apply(this,arguments)}return r.prototype.init=function(){var u;return this.with_redactor(function(a){return function(){return I.redactor(a.el.find("textarea"),{minHeight:100,source:!1})}}(this)),u=this.el.find("form").remote_submit(function(a){return function(h){if(u.set_form_errors(h.errors),!h.errors)return a.el.addClass("after_ban")}}(this))},r}(I.Lightbox)}.call(this),function(){I.CommunityCategoryBans=function(){function d(t){this.el=$(t),this.el.remote_link(function(s){return function(n){if(n.errors){alert(n.errors.join(`
`));return}return window.location.reload()}}(this))}return d}()}.call(this),function(){I.CommunityCategoryModerators=function(){function d(t){this.el=$(t),this.el.remote_link(function(s){return function(n,r){if(n.return_to)return window.location=n.return_to}}(this))}return d}()}.call(this),function(){I.CommunityProfile=function(){function d(t,s){var n;this.el=$(t),new I.FilterPickers(this.el),this.carousels=function(){var r,u,a,h;for(a=this.el.find(".game_carousel_widget"),h=[],r=0,u=a.length;r<u;r++)n=a[r],h.push(new I.GameCarousel($(n)));return h}.call(this),new I.CommunityViewTopic(this.el.find(".recent_posts"),s)}return d}()}.call(this),function(){I.CommunityEditCategory=function(){function d(t){var s;this.el=$(t),s=this.el.find("form").remote_submit(function(n){return function(r){if(r.errors){s.set_form_errors(r.errors);return}if(r.redirect_to)return window.location=r.redirect_to}}(this))}return d}()}.call(this),function(){I.GameCommunityCategory=function(){function d(t){var s;this.el=$(t),s=this.el.find(".blog_post_grid_widget"),s.lazy_images({horizontal:!0,target:s})}return d}()}.call(this),function(){I.GameCommunityHeader=function(){function d(t){this.el=$(t),this.el.dispatch("click",{add_to_collection_btn:function(s){return function(n){return I.current_user?I.Lightbox.open_remote(n.attr("href"),I.CollectionLightbox):"continue"}}(this)})}return d}()}.call(this),function(){var d=function(n,r){return function(){return n.apply(r,arguments)}},t=function(n,r){for(var u in r)s.call(r,u)&&(n[u]=r[u]);function a(){this.constructor=n}return a.prototype=r.prototype,n.prototype=new a,n.__super__=r.prototype,n},s={}.hasOwnProperty;I.CommunityLockTopicLightbox=function(n){t(r,n);function r(){return this.init=d(this.init,this),r.__super__.constructor.apply(this,arguments)}return r.prototype.init=function(){var u;return this.with_redactor(function(a){return function(){return I.redactor(a.el.find("textarea"),{minHeight:100,source:!1})}}(this)),u=this.el.find("form").remote_submit(function(a){return function(h){if(u.set_form_errors(h.errors),!h.errors)return window.location.reload()}}(this))},r}(I.Lightbox)}.call(this),function(){I.CommunityNewTopic=function(){function d(t,s){var n;this.el=$(t);try{this.el.find("input[name=offset]").val(new Date().getTimezoneOffset())}catch(r){}this.set_fingerprint(),n=this.el.find("form").remote_submit(function(r){return function(u){if(u.redirect_to&&(window.location=u.redirect_to),u.errors){if(I.add_recaptcha_if_necessary(n,u.errors))return;n.set_form_errors(u.errors)}}}(this)),n.on("submit",function(r){return function(){return n.set_form_errors([])}}(this))}return d.prototype.set_fingerprint=function(){return window.Fingerprint2?(this.set_fingerprint=function(){},new Fingerprint2().get(function(t){return function(s){if(s)return t.el.find("input[name=bfp]").val(s)}}(this))):!1},d}()}.call(this),function(){I.CommunityPostForm=function(){function d(t,s){var n;s==null&&(s={}),this.el=$(t),n=this.el.find("form").remote_submit(function(r){return function(u){if(u.errors){if(I.add_recaptcha_if_necessary(n,u.errors))return;n.set_form_errors(u.errors);return}if(u.redirect_to&&(window.location=u.redirect_to),u.flash)return I.flash(u.flash)}}(this))}return d}()}.call(this),function(){var d=function(n,r){return function(){return n.apply(r,arguments)}},t=function(n,r){for(var u in r)s.call(r,u)&&(n[u]=r[u]);function a(){this.constructor=n}return a.prototype=r.prototype,n.prototype=new a,n.__super__=r.prototype,n},s={}.hasOwnProperty;I.CommunityReportPostLightbox=function(n){t(r,n);function r(){return this.init=d(this.init,this),r.__super__.constructor.apply(this,arguments)}return r.prototype.init=function(){var u;return u=this.el.find("form").remote_submit(function(a){return function(h){if(h.errors){u.set_form_errors(h.errors);return}return a.el.addClass("submitted_report")}}(this))},r}(I.Lightbox)}.call(this),function(){var d=function(n,r){return function(){return n.apply(r,arguments)}},t=function(n,r){for(var u in r)s.call(r,u)&&(n[u]=r[u]);function a(){this.constructor=n}return a.prototype=r.prototype,n.prototype=new a,n.__super__=r.prototype,n},s={}.hasOwnProperty;I.CommunityStickTopicLightbox=function(n){t(r,n);function r(){return this.init=d(this.init,this),r.__super__.constructor.apply(this,arguments)}return r.prototype.init=function(){var u;return this.with_redactor(function(a){return function(){return I.redactor(a.el.find("textarea"),{minHeight:100,source:!1})}}(this)),u=this.el.find("form").remote_submit(function(a){return function(h){if(u.set_form_errors(h.errors),!h.errors)return window.location.reload()}}(this))},r}(I.Lightbox)}.call(this),function(){var d=function(t,s){return function(){return t.apply(s,arguments)}};I.CommunityTopicHeader=function(){function t(s,n){var r;this.opts=n,this.render_topic_voter=d(this.render_topic_voter,this),this.el=$(s),r=this.el.find(".moderation_tools"),r.length&&new I.CommunityTopicModerationTools(r,this.opts.moderation),this.render_topic_voter()}return t.prototype.render_topic_voter=function(){var s,n,r;if(typeof R!="undefined"&&R!==null&&(n=R.Community)!=null&&n.TopicVoter&&(r=this.el.find(".community_topic_voter_widget"),!!r.length))return s=r.data("p"),s.vote_url=this.opts.vote_url,ReactDOM.render(R.Community.TopicVoter(s),r[0])},t}()}.call(this),function(){I.CommunityTopicList=function(){function d(t,s){this.opts=s,this.el=$(t),new I.CommunityTopicModerationTools(t,this.opts),this.el.lazy_images({selector:"[data-background_image]"}),this.render_topic_voters(),this.el.has_tooltips(),new I.GamePopups(this.el)}return d.prototype.render_topic_voters=function(){var t,s,n,r,u,a,h;if(typeof R!="undefined"&&R!==null&&(r=R.Community)!=null&&r.TopicVoter){for(u=this.el.find(".community_topic_voter_widget"),a=[],t=0,s=u.length;t<s;t++)h=u[t],n=$(h).data("p"),n.vote_url=this.opts.vote_url,a.push(ReactDOM.render(R.Community.TopicVoter(n),h));return a}},d}()}.call(this),function(){var d=function(t,s){return function(){return t.apply(s,arguments)}};I.CommunityTopicModerationTools=function(){t.prototype.topic_url=function(s,n){return this.opts.urls[s].replace(/:topic_id\b/,n)};function t(s,n){this.opts=n,this.topic_url=d(this.topic_url,this),this.el=$(s),new I.FilterPickers(s),this.el.on("click",".filter_option",function(r){return function(u){var a,h,f;switch(a=$(u.currentTarget).trigger("i:close_filter_pickers"),h=a.closest("[data-topic_id]").data("topic_id"),f=a!=null?a.data("value"):void 0,f){case"purge":if(u.preventDefault(),confirm("This will delete all the users posts and spam their account. No undo. Are you sure?"))return $.post($(u.currentTarget).attr("href"),I.with_csrf()).done(function(v){if(v.errors){alert(v.errors.join(","));return}if(v.redirect_to)return window.location=v.redirect_to});break;case"feature":case"unfeature":case"bump":return u.preventDefault(),$.post($(u.currentTarget).attr("href"),I.with_csrf()).done(function(v){if(v.errors){alert(v.errors.join(","));return}if(v.redirect_to)return window.location=v.redirect_to});case"archive":case"unarchive":return u.preventDefault(),I.Lightbox.open_remote(r.topic_url("archive_topic",h),I.CommunityArchiveTopicLightbox);case"lock":case"unlock":return u.preventDefault(),I.Lightbox.open_remote(r.topic_url("lock_topic",h),I.CommunityLockTopicLightbox);case"stick":case"unstick":return u.preventDefault(),I.Lightbox.open_remote(r.topic_url("stick_topic",h),I.CommunityStickTopicLightbox);case"delete":if(u.preventDefault(),confirm("Are you sure you want to delete this topic?"))return $.ajax({url:r.topic_url("delete_topic",h),data:I.with_csrf(),type:"post",xhrFields:{withCredentials:!0}}).done(function(v){return v.errors?alert(v.errors.join()):window.location.reload()})}}}(this))}return t}()}.call(this),function(){var d=function(t,s){return function(){return t.apply(s,arguments)}};I.CommunityViewTopic=function(){t.prototype.vote_counts_template=I.lazy_template(t,"vote_counts");function t(s,n){var r;this.opts=n,this.update_votes=d(this.update_votes,this),this.el=$(s),this.el.find("code[class*=language-]").exists()&&(r=$("#lib_prism_src").data("inject"))&&$(document.body).append(r),this.el.remote_link(function(u){return function(a,h){if(h.is(".vote_btn")){if(a.errors){alert(a.errors.join(", "));return}u.update_votes(h,a);return}if(a.redirect_to)return window.location=a.redirect_to}}(this)),this.el.dispatch("click",{ban_user_btn:function(u){return function(a){var h,f;return f=a.closest(".community_post").data("post"),h=u.opts.ban_url+("?banned_user_id="+f.user_id),I.Lightbox.open_remote(h,I.CommunityBanLightbox)}}(this),stick_topic_btn:function(u){return function(a){return I.Lightbox.open_remote(a.data("href"),I.CommunityStickTopicLightbox)}}(this),lock_topic_btn:function(u){return function(a){return I.Lightbox.open_remote(a.data("href"),I.CommunityLockTopicLightbox)}}(this),report_post_btn:function(u){return function(a){var h,f;return h=a.closest(".community_post").data("post"),f=u.opts.report_url.replace(/:post_id/,h.id),I.Lightbox.open_remote(f,I.CommunityReportPostLightbox)}}(this),embed_preload:function(u){return function(a){var h;if(a[0].hasAttribute("itchio"))return h=a.data("embed_code"),a.replaceWith(h)}}(this)})}return t.prototype.update_votes=function(s,n){var r,u,a,h,f,v;for(h=s.closest(".community_post"),v=h.find(".vote_btn"),a=v.filter(".post_action"),a.removeClass("animate_bounce animate_drop_down"),setTimeout(function(y){return function(){return a.removeClass("animate_bounce animate_drop_down")}}(this),500),s.is(".voted")?(_.defer(function(y){return function(){return a.addClass("animate_drop_down")}}(this)),s.removeClass("voted")):(_.defer(function(y){return function(){return a.addClass("animate_bounce")}}(this)),v.removeClass("voted").filter(s).addClass("voted")),r=0,u=v.length;r<u;r++)f=v[r],f=$(f),f.is(".voted")?f.data("params").action="remove":delete f.data("params").action;return h.find(".vote_counts").html(this.vote_counts_template({up_score:n.up_score+Math.max(0,n.score_adjustment),down_score:n.down_score+Math.abs(Math.min(0,n.score_adjustment))}))},t}()}.call(this),function(){I.libs.react.done(function(){var d,t,s,n,r,u,a,h,f,v,y,j,C,x,P,V,O,A,M,L,F,U,K,Q,q,Y,T,E,G,X,N,D,z,S,k;t=ReactDOMFactories,a=t.div,N=t.span,s=t.a,n=t.br,T=t.p,Q=t.ol,k=t.ul,K=t.li,D=t.strong,h=t.em,M=t.img,v=t.form,F=t.label,L=t.input,z=t.textarea,r=t.button,A=t.iframe,j=t.h1,C=t.h2,x=t.h3,P=t.h4,V=t.h5,O=t.h6,E=t.pre,u=t.code,X=t.select,Y=t.option,G=t.section,q=t.optgroup,f=t.fieldset,U=t.legend,y=React.createElement.bind(null,React.Fragment),y.type=React.fragment,d=R.package("Index"),S=PropTypes,d("LazyImage",{pure:!0,propTypes:{src:S.string,src_set:S.string,width:S.number,height:S.number},getInitialState:function(){return{visible:!1}},componentDidMount:function(){var p;return p=ReactDOM.findDOMNode(this),this.unbind_lazy_images=$(p).lazy_images({elements:[p],show_images:function(m){return function(){var o;return m.setState({visible:!0}),typeof(o=m.props).on_reveal=="function"?o.on_reveal():void 0}}(this)})},componentWillUnmount:function(){return typeof this.unbind_lazy_images=="function"?this.unbind_lazy_images():void 0},render:function(){var p,m;return M({className:classNames(this.props.class,this.props.className,{lazy_loaded:this.state.loaded,lazy_visible:this.state.visible}),alt:this.props.alt,width:this.state.loaded?this.props.width:(p=this.props.initial_width)!=null?p:this.props.width,height:this.state.loaded?this.props.height:(m=this.props.initial_height)!=null?m:this.props.height,src:this.state.visible?this.props.src:void 0,srcSet:this.state.visible?this.props.src_set:void 0,onLoad:this.state.visible&&!this.state.loaded?function(o){return function(){var e;return o.setState({loaded:!0}),typeof(e=o.props).on_load=="function"?e.on_load():void 0}}(this):void 0})}})})}.call(this),function(){I.libs.react.done(function(){var d,t,s,n,r,u,a,h,f,v,y,j,C,x,P,V,O,A,M,L,F,U,K,Q,q,Y,T,E,G,X,N,D,z,S,k,p,m,o,e,i,c;t=ReactDOMFactories,h=t.div,D=t.span,s=t.a,r=t.br,E=t.p,q=t.ol,c=t.ul,Q=t.li,z=t.strong,f=t.em,L=t.img,y=t.form,U=t.label,F=t.input,m=t.textarea,u=t.button,M=t.iframe,C=t.h1,x=t.h2,P=t.h3,V=t.h4,O=t.h5,A=t.h6,G=t.pre,a=t.code,N=t.select,T=t.option,X=t.section,Y=t.optgroup,v=t.fieldset,K=t.legend,j=React.createElement.bind(null,React.Fragment),j.type=React.fragment,d=R.package("Community"),i=PropTypes,S=ReactDOMFactories.table,o=ReactDOMFactories.thead,k=ReactDOMFactories.tbody,e=ReactDOMFactories.tr,p=ReactDOMFactories.td,n=ReactDOMFactories.abbr,d("CategoryEditTags",{propTypes:{tags:i.arrayOf(i.shape({id:i.number.isRequired,label:i.string.isRequired,color:i.string}))},getInitialState:function(){return{tags:_.toArray(this.props.tags)}},push_tag:function(l){if(l=$.trim(l),l!=="")return this.setState(function(g){return{tags:g.tags.concat({label:l})}})},remove_tag:function(l){return this.state.tags.splice(l,1),this.forceUpdate()},input_name:function(l,g){return"category_tags["+(g+1)+"]["+l+"]"},render:function(){return this.enclose({},this.state.tags.length?S({className:"tag_list"},k({},this.state.tags.map(function(l){return function(g,w){return e({className:"tag_row",key:g.id+"-"+g.label},p({},g.id!=null?F({type:"hidden",name:l.input_name("id",w),value:""+g.id}):void 0,g.color!=null?F({type:"hidden",name:l.input_name("color",w),value:g.color}):void 0,F({type:"hidden",name:l.input_name("label",w),value:g.label}),D({className:"tag_label"},g.label)),p({},F({type:"text",name:l.input_name("description",w),defaultValue:g.description,placeholder:"Description, optional"})),p({},u({className:"textlike remove_tag_btn",onClick:function(b){if(confirm("Are you sure you want to remove this tag?"))return b.preventDefault(),l.remove_tag(w)}},"remove")))}}(this)))):void 0,F({type:"text",placeholder:"Type tag name and press enter to add tag",maxLength:30,onKeyDown:function(l){return function(g){if(g.keyCode===13)return g.preventDefault(),l.push_tag(g.target.value),g.target.value=""}}(this)}))}})})}.call(this),function(){I.libs.react.done(function(){var d,t,s,n,r,u,a,h,f,v,y,j,C,x,P,V,O,A,M,L,F,U,K,Q,q,Y,T,E,G,X,N,D,z,S,k,p,m=[].slice;t=ReactDOMFactories,a=t.div,D=t.span,s=t.a,n=t.br,E=t.p,q=t.ol,p=t.ul,Q=t.li,z=t.strong,h=t.em,M=t.img,v=t.form,U=t.label,L=t.input,S=t.textarea,r=t.button,A=t.iframe,j=t.h1,C=t.h2,x=t.h3,P=t.h4,V=t.h5,O=t.h6,G=t.pre,u=t.code,N=t.select,T=t.option,X=t.section,Y=t.optgroup,f=t.fieldset,K=t.legend,y=React.createElement.bind(null,React.Fragment),y.type=React.fragment,d=R.package("Community"),k=PropTypes,F=0,d("EditCategories",{propTypes:{category:k.object},getInitialState:function(){return{children:_.toArray(this.props.category.children)}},componentDidMount:function(){return this.dispatch("category",{create:function(o){return function(){return o.state.children.push({key:F+=1}),o.forceUpdate()}}(this),set_property:function(o){return function(e,i,c,l){return i[c]=l,o.forceUpdate()}}(this),create_child:function(o){return function(e,i){return i.children||(i.children=[]),i.children.push({key:F+=1}),o.forceUpdate()}}(this),remove_child:function(o){return function(e,i,c){var l;return l=i===o.props.category?o.state.children:i.children,l.splice(c,1),o.forceUpdate()}}(this),toggle:function(o){return function(e,i,c){return i[c]=!i[c],o.forceUpdate()}}(this),move_up:function(o){return function(e,i,c){var l,g,w,b;if(g=i===o.props.category?o.state.children:i.children,b=c-1,!!g[b])return l=g,w=[l[b],l[c]],l[c]=w[0],l[b]=w[1],o.forceUpdate()}}(this),move_down:function(o){return function(e,i,c){var l,g,w,b;if(g=i===o.props.category?o.state.children:i.children,b=c+1,!!g[b])return l=g,w=[l[b],l[c]],l[c]=w[0],l[b]=w[1],o.forceUpdate()}}(this)})},render:function(){return v({method:"POST",className:"edit_categories form"},R.CSRF({}),C({},"Subcategories"),this.state.children.length?a({className:"category_list",children:_.map(this.state.children,function(o){return function(e,i){return d.CategoryRow({is_first:i===0,is_last:i===o.state.children.length-1,key:e.key||"cat"+e.id,parent_category:o.props.category,category:e,position:i+1})}}(this))}):E({},h({className:"empty_message"},"There are no categories. You must have at least one non-directory category for your community to be usable.")),a({className:"button_row"},r({className:"button",onClick:function(o){return function(e){return e.preventDefault(),o.trigger("category:create")}}(this)},"New category")," ",r({className:"button"},"Save")))}}),d("CategoryRow",{propTypes:{is_first:k.bool,is_last:k.bool,position:k.number,category:k.shape({id:k.number,title:k.string}),input_prefix:k.string},input_name:function(o){var e;return e=this.props.input_prefix||"categories",e+"["+(this.props.position||"")+"]["+o+"]"},render:function(){var o,e;return a({className:"category_row"},this.props.category.id?L({type:"hidden",name:this.input_name("id"),value:this.props.category.id}):void 0,a.apply(null,[{className:"category_primary_inputs"}].concat(m.call(this.render_title_inputs()))),a.apply(null,[{className:"category_secondary_inputs"}].concat(m.call(this.render_button_inputs()))),a({className:"category_secondary_inputs"},U({},L({type:"checkbox",name:this.input_name("archived"),checked:this.props.category.archived||!1,onChange:function(i){return function(c){return i.trigger("category:toggle",i.props.category,"archived")}}(this)}),D({className:"label"},"Archive")),U({},L({type:"checkbox",name:this.input_name("hidden"),checked:this.props.category.hidden||!1,onChange:function(i){return function(c){return i.trigger("category:toggle",i.props.category,"hidden")}}(this)}),D({className:"label"},"Hidden")),U({},L({type:"checkbox",name:this.input_name("directory"),checked:this.props.category.directory||!1,onChange:function(i){return function(c){return i.trigger("category:toggle",i.props.category,"directory")}}(this)}),D({className:"label"},"Directory")),this.props.category.created_at?D({className:"created_at",title:this.props.category.created_at},I.format_timestamp(this.props.category.created_at,"calendar")):void 0,!this.props.category.directory&&this.props.category.topics_count!=null?(o=this.props.category.topics_count,D({className:"topics_count"},o+" topic"+(o===1&&""||"s"))):void 0,this.props.category.url?s({className:"category_link",href:this.props.category.url},"View"):void 0,this.props.category.edit_url?s({className:"category_link",href:this.props.category.edit_url},"Edit"):void 0),(e=this.props.category.children)!=null&&e.length?a({className:"child_categories",children:_.map(this.props.category.children,function(i){return function(c,l){return d.CategoryRow({is_first:l===0,is_last:l===i.props.category.children-1,key:c.key||"cat"+c.id,input_prefix:(i.props.input_prefix||"categories")+"["+i.props.position+"][children]",parent_category:i.props.category,category:c,position:l+1})}}(this))}):void 0)},render_title_inputs:function(){return[this.props.category.id?void 0:D({className:"new_flag"},"New"),L({type:"text",className:"title_input text_input",name:this.input_name("title"),required:"required",value:this.props.category.title||"",placeholder:"Title",onChange:function(o){return function(e){return o.trigger("category:set_property",o.props.category,"title",e.target.value)}}(this)}),this.props.category.directory?void 0:L({type:"text",className:"short_description_input text_input",name:this.input_name("short_description"),value:this.props.category.short_description||"",placeholder:"Short description",onChange:function(o){return function(e){return o.trigger("category:set_property",o.props.category,"short_description",e.target.value)}}(this)})]},render_button_inputs:function(){return[r({className:"button small",onClick:function(o){return function(e){return e.preventDefault(),o.trigger("category:create_child",o.props.category)}}(this)},"Add child"),this.props.is_first?void 0:s({href:"#",className:"move_btn move_up_btn",onClick:function(o){return function(e){return e.preventDefault(),o.trigger("category:move_up",o.props.parent_category,o.props.position-1)}}(this)},"Move up"),this.props.is_last?void 0:s({href:"#",className:"move_btn move_down_btn",onClick:function(o){return function(e){return e.preventDefault(),o.trigger("category:move_down",o.props.parent_category,o.props.position-1)}}(this)},"Move down"),s({href:"#",className:"remove_btn",onClick:function(o){return function(e){if(e.preventDefault(),confirm("Are you sure you want to remove?"))return o.trigger("category:remove_child",o.props.parent_category,o.props.position-1)}}(this)},"Remove")]}})})}.call(this),function(){I.libs.react.done(function(){var d,t,s,n,r,u,a,h,f,v,y,j,C,x,P,V,O,A,M,L,F,U,K,Q,q,Y,T,E,G,X,N,D,z,S,k,p={}.hasOwnProperty,m=[].indexOf||function(o){for(var e=0,i=this.length;e<i;e++)if(e in this&&this[e]===o)return e;return-1};t=ReactDOMFactories,a=t.div,N=t.span,s=t.a,n=t.br,T=t.p,Q=t.ol,k=t.ul,K=t.li,D=t.strong,h=t.em,M=t.img,v=t.form,F=t.label,L=t.input,z=t.textarea,r=t.button,A=t.iframe,j=t.h1,C=t.h2,x=t.h3,P=t.h4,V=t.h5,O=t.h6,E=t.pre,u=t.code,X=t.select,Y=t.option,G=t.section,q=t.optgroup,f=t.fieldset,U=t.legend,y=React.createElement.bind(null,React.Fragment),y.type=React.fragment,d=R.package("Community"),S=PropTypes,d("PostLiker",{pure:!0,getDefaultProps:function(){return{animation_duration:500}},componentDidCatch:function(o,e){return I.event("error","react","Community.PostLiker")},componentWillUnmount:function(){if(this.animation_timer)return window.clearTimeout(this.animation_timer),this.animation_timer=null},componentDidUpdate:function(o,e){var i;if((i=this.state)!=null&&i.animation&&(e!=null?e.animation:void 0)!==this.state.animation)return this.animation_timer=window.setTimeout(function(c){return function(){return c.setState({animation:null})}}(this),this.props.animation_duration)},like:function(){var o,e,i,c,l;return i={direction:"up"},(c=this.props.vote)!=null&&c.positive&&(i.action="remove"),o=i.action==="remove"?"animate_drop_down":"animate_bounce",(l=this.state)!=null&&l.animation&&(e=o,_.defer(function(g){return function(){return g.setState({animation:e})}}(this)),o=null),this.setState({loading:!0,pending_vote:i.action!=="remove",animation:o}),$.ajax({type:"POST",dataType:"json",url:this.props.urls.vote_url({id:this.props.post_id}),data:I.with_csrf(i),xhrFields:{withCredentials:!0}}).done(function(g){return function(w){var b;return g.setState({loading:!1,pending_vote:void 0}),typeof(b=g.props).on_vote=="function"?b.on_vote(w):void 0}}(this)).fail(function(g){return function(w){var b;if(g.setState({loading:!1}),b=function(){try{return JSON.parse(w.responseText)}catch(H){}}(),b!=null&&b.errors&&g.setState({pending_vote:null}),b!=null&&b.login_url)return window.location=b.login_url}}(this))},render:function(){var o,e,i,c,l;return this.props.current_user?this.enclose({component:"button",type:"button",className:classNames("post_action vote_btn",(o=this.state)!=null?o.animation:void 0,this.props.classNames,{loading:(e=this.state)!=null?e.loading:void 0,voted:(i=(c=this.state)!=null?c.pending_vote:void 0)!=null?i:(l=this.props.vote)!=null?l.positive:void 0}),onClick:this.on_click||(this.on_click=function(g){return function(w){return w.preventDefault(),g.like()}}(this))},R.Icons.TriUp," ",this.tt("community.post_list.like")):(this.props.login_url||console.warn("Rendering a logged out PostLiker but we don't have the login_url"),this.enclose({component:"a",className:classNames("post_action vote_btn",this.props.classNames),href:this.props.login_url,target:"_blank"},R.Icons.TriUp," ",this.tt("community.post_list.like")))}}),d("PostVoter",{pure:!0,propTypes:{urls:S.object,post_id:S.number,vote:S.object},componentDidCatch:function(o,e){return I.event("error","react","Community.PostVoter")},vote:function(o){var e,i,c;if(!((i=this.state)!=null&&i.loading))return e={direction:o},o==="up"&&((c=this.props.vote)!=null&&c.positive)&&(e.action="remove"),o==="down"&&this.props.vote&&!this.props.vote.positive&&(e.action="remove"),this.setState({loading:!0}),$.ajax({type:"POST",url:this.props.urls.vote_url({id:this.props.post_id}),data:I.with_csrf(e),dataType:"json",xhrFields:{withCredentials:!0}}).done(function(l){return function(g){var w;return l.setState({loading:!1}),typeof(w=l.props).on_vote=="function"?w.on_vote(g):void 0}}(this)).fail(function(l){return function(g){var w;if(l.setState({loading:!1}),w=function(){try{return JSON.parse(g.responseText)}catch(b){}}(),w!=null&&w.login_url)return window.location=w.login_url}}(this))},render:function(){var o;return!this.props.current_user&&!this.props.login_url&&console.warn("Rendering a logged out PostVoter but we don't have the login_url"),this.enclose({className:classNames("post_votes",{loading:(o=this.state)!=null?o.loading:void 0})},this.props.current_user?r({type:"button",disabled:this.props.disabled,className:classNames("vote_up_btn vote_btn",{voted:this.props.vote&&this.props.vote.positive}),onClick:this.on_vote_up||(this.on_vote_up=function(e){return function(){return e.vote("up")}}(this))},R.Icons.TriUp):s({className:"vote_up_btn vote_btn",target:"_blank",rel:"nofollow",href:this.props.login_url},R.Icons.TriUp),this.props.current_user?r({type:"button",disabled:this.props.disabled,className:classNames("vote_down_btn vote_btn",{voted:this.props.vote&&!this.props.vote.positive}),onClick:this.on_vote_down||(this.on_vote_down=function(e){return function(){return e.vote("down")}}(this))},R.Icons.TriDown):s({className:"vote_down_btn vote_btn",target:"_blank",rel:"nofollow",href:this.props.login_url},R.Icons.TriDown))}}),d("PostBody",{pure:!0,getDefaultProps:function(){return{max_height:300}},componentDidMount:function(){return _.defer(function(o){return function(){var e,i;return i=$(o.wrapper_ref.current).find("img").on("load",function(){return o.refresh_sizes()}),e=i.length?void 0:50,o.refresh_sizes(e)}}(this))},reveal:function(){return this.setState({open:!0,has_more:!1})},on_click:function(o){var e,i,c;if((i=this.state)!=null&&i.has_more&&this.reveal(),e=$(o.target).closest(".embed_preload"),e.length&&(u=e.data("embed_code"),e.replaceWith(u),!((c=this.state)!=null&&c.open)))return this.setState({open:!0})},refresh_sizes:function(o){var e;if(this.wrapper_ref.current&&(e=this.wrapper_ref.current.scrollHeight,e>this.props.max_height&&this.setState({has_more:!0}),o&&e<this.props.max_height+o))return this.setState({open:!0,has_more:!1})},render:function(){var o,e,i;return i=(o=this.state)!=null&&o.open?void 0:{overflowY:"hidden",maxHeight:this.props.max_height+"px"},y({},a({className:"post_body user_formatted",ref:this.wrapper_ref||(this.wrapper_ref=React.createRef()),style:i,onClick:this.on_click,dangerouslySetInnerHTML:{__html:this.props.body_html}}),(e=this.state)!=null&&e.has_more?r({type:"button",onClick:this.reveal,className:"reveal_full_post_btn"},"View rest \u2193"):void 0)}}),d("Post",{pure:!0,edit_post:function(o){return this.props.edit_post(this.props.post,o)},get_visible_vote_types:function(){return this.props.readonly?null:this.props.post.vote_types},is_redacted:function(){var o,e,i,c,l;return o=this.props.post,l=this.props.post.user,o.deleted||(e=o.user)!=null&&e.deleted?!0:(i=o.user)!=null&&i.suspended||o.blocked?!((c=this.state)!=null&&c.show_blocked):!1},render:function(){var o,e;return o=this.props.post,y({},this.render_current_post(),(e=o.replies)!=null&&e.length?this.render_children():o.view_replies_url?a({className:"view_more_replies"},s({href:o.view_replies_url,className:"button outline forward_link"},this.tt("community.post_list.view_more_in_thread"))):void 0)},render_children:function(){var o;return o=this.props.post,a({className:classNames("community_post_replies",{top_level_replies:o.depth===1})},o.replies.map(function(e){return function(i,c){return d.Post({key:i.id,readonly:e.props.readonly,idx:c,post:i,current_user:e.props.current_user,edit_post:e.edit_child_post||(e.edit_child_post=function(l,g){var w;return e.edit_post({replies:function(){var b,H,J,et;for(J=this.props.post.replies,et=[],b=0,H=J.length;b<H;b++)if(w=J[b],w===l){if(g==="remove")continue;et.push($.extend({},l,g))}else et.push(w);return et}.call(e)})}),urls:e.props.urls,reply_form_params:e.props.reply_form_params})}}(this)))},update_vote:function(o){var e,i,c;return i=o.score_adjustment||0,c=Math.max(i,0),e=Math.min(i,0),this.edit_post({up_votes:o.up_score+c,down_votes:o.down_score-e,vote:o.score_adjustment?{positive:o.score_adjustment>0}:null})},delete_post:function(o){var e,i,c,l,g;if(o==null&&(o=null),l=this.props.post,i=o==="hard"?"Purging post will delete it permanently, along with any replies. Continue?":"Are you sure you want to delete this post?",!!confirm(i)&&!((g=this.state)!=null&&g.deleting))return this.setState({deleting:!0}),e=this.props.urls.delete_url({id:l.id}),c={},o==="hard"&&(c.hard="1"),$.ajax({type:"POST",url:e,data:I.with_csrf(c),dataType:"json",xhrFields:{withCredentials:!0}}).done(function(w){return function(b){return w.edit_post({deleted:!0,hard_deleted:b.type==="hard"})}}(this)).always(function(w){return function(){return w.setState({deleting:!1})}}(this))},render_current_post_moderation_event:function(){var o,e,i;return e=this.props.post,i=this.props.post.user,o=e.moderation_event,e.deleted?a({className:"post_content"},a({className:"post_body"},h({className:"deleted_message"},this.tt("community.post_list.deleted_post")))):y({},N({className:"post_author"},i.url&&i.name?s({href:i.url},i.name):N({className:"name_placeholder"},"Unknown account")),N({className:"moderation_action"},D({},o.action),o.target_name?y({}," ",s({href:o.target_url},o.target_name)):void 0," ",N({className:"post_date",title:e.created_at+" UTC"},s({href:e.url},I.format_timestamp(e.created_at))),e.can_delete&&!e.deleted&&!this.props.readonly?r({className:"textlike delete_post_btn post_action",type:"button",onClick:function(c){return function(l){return l.preventDefault(),c.delete_post()}}(this)},this.tt("community.post_list.delete")):void 0))},render_current_post_contents:function(){var o,e,i,c,l,g,w,b,H,J,et,rt,Z;return l=this.props.post,Z=this.props.post.user,o=R.Index.LazyImage({className:"post_avatar",width:25,height:25,src:Z.avatar_url,src_set:Z.avatar_url2x?Z.avatar_url+" 1x, "+Z.avatar_url2x+" 2x":void 0}),(l.just_added?R.SlideDown:a)({className:"post_grid"},this.get_visible_vote_types()==="ud"?d.PostVoter({post_id:l.id,vote:l.vote,disabled:this.is_redacted(),urls:this.props.urls,on_vote:this.update_vote,current_user:this.props.current_user,login_url:typeof(e=this.props.urls).login_url=="function"?e.login_url():void 0}):void 0,Z.url?s({href:Z.url,className:"avatar_container"},o):a({className:"avatar_container"},o),a({className:"post_header"},N({className:"post_author"},l.deleted?N({className:"name_placeholder"},"Deleted post"):Z.deleted?N({className:"name_placeholder"},this.tt("community.post_list.deleted_account")):l.blocked&&!((g=this.state)!=null&&g.show_blocked)?N({className:"name_placeholder"},"Blocked account"):Z.suspended?N({className:"name_placeholder"},this.tt("community.post_list.suspended_account")):Z.url&&Z.name?s({href:Z.url},Z.name):void 0),N({className:"post_date",title:l.created_at+" UTC"},s({href:l.url},I.format_timestamp(l.created_at))),!this.is_redacted()&&(l.edits_count||0)>0?y({}," ",N({className:"edit_message",title:l.edited_at+" ("+l.edits_count+")"},this.tt("community.post_list.edited"))):void 0,!this.is_redacted()&&l.vote_types&&(l.up_votes||l.down_votes)?N({className:"vote_counts"},l.up_votes?N({className:"upvotes"},"(+"+l.up_votes+")"):void 0,l.down_votes?N({className:"downvotes"},"(-"+l.down_votes+")"):void 0):void 0),a({className:"post_content"},l.deleted||(w=l.user)!=null&&w.deleted?a({className:"post_body"},h({className:"deleted_message"},this.tt("community.post_list.deleted_post")),(l.can_moderate||l.admin_url)&&!l.hard_deleted?y({}," (",r({className:"textlike",onClick:this.purge_post||(this.purge_post=function(tt){return function(B){return B.preventDefault(),tt.delete_post("hard").done(function(){return tt.edit_post("remove")})}}(this))},"Purge"),")"):void 0):(b=l.user)!=null&&b.suspended&&!((H=this.state)!=null&&H.show_blocked)?a({className:"post_body"},h({},this.tt("community.post_list.post_from_suspended_account"))," (",r({className:"textlike",onClick:this.show_blocked_post||(this.show_blocked_post=function(tt){return function(){return tt.setState({show_blocked:!0})}}(this))},"Show post"),")"):l.blocked&&!((J=this.state)!=null&&J.show_blocked)?a({className:"post_body"},h({},this.tt("community.post_list.post_from_blocked_account"))," (",r({className:"textlike",onClick:this.show_blocked_post||(this.show_blocked_post=function(tt){return function(){return tt.setState({show_blocked:!0})}}(this))},"Show post"),", ",s({href:this.props.urls.blocks_url(),target:"_blank"},this.tt("community.post_list.edit_blocks")),")"):(et=this.state)!=null&&et.editing?this.render_edit_form():d.PostBody({key:l.body_html,body_html:l.body_html}),a({className:"post_footer"},!this.is_redacted()&&this.get_visible_vote_types()==="u"?d.PostLiker({post_id:l.id,vote:l.vote,urls:this.props.urls,on_vote:this.update_vote,current_user:this.props.current_user,login_url:typeof(i=this.props.urls).login_url=="function"?i.login_url():void 0}):void 0,!this.is_redacted()&&!this.props.readonly?l.can_reply?s({href:this.props.urls.reply_url({id:l.id}),className:"post_action reply_btn",onClick:this.props.reply_form_params?this.on_click_reply||(this.on_click_reply=function(tt){return function(B){return B.preventDefault(),tt.setState(function(W){return W==null&&(W={}),{replying_to:!W.replying_to}})}}(this)):void 0},this.tt("community.post_list.reply")):!this.props.current_user&&this.props.urls.login_url?s({href:typeof(c=this.props.urls).login_url=="function"?c.login_url():void 0,className:"post_action reply_btn",rel:"nofollow",target:"_blank"},this.tt("community.post_list.reply")):void 0:void 0,l.can_edit&&!this.props.readonly?s({href:this.props.urls.edit_url({id:l.id}),className:"post_action edit_btn",onClick:this.props.reply_form_params?this.on_click_edit||(this.on_click_edit=function(tt){return function(B){return B.preventDefault(),tt.setState(function(W){return W==null&&(W={}),{editing:!W.editing,replying_to:!1}})}}(this)):void 0},this.tt("community.post_list.edit")):void 0,l.can_delete&&!l.deleted&&!this.props.readonly?s({href:"#",className:"post_action delete_post_btn",onClick:function(tt){return function(B){return B.preventDefault(),tt.delete_post()}}(this)},l.is_topic?this.tt("community.post_list.delete_topic"):this.tt("community.post_list.delete")):void 0,!this.is_redacted()&&l.can_report&&!this.props.readonly?s({href:"#",className:"post_action report_btn",onClick:function(tt){return function(B){var W;return B.preventDefault(),W=tt.props.urls.report_url({id:l.id}),I.Lightbox.open_remote(W,I.CommunityReportPostLightbox)}}(this)},this.tt("community.post_list.report")):void 0,Z.id&&l.ban_target&&!this.props.readonly?s({href:"#",className:"post_action ban_user_btn",onClick:function(tt){return function(B){var W;return B.preventDefault(),W=tt.props.urls.ban_url(l.ban_target),W+="?banned_user_id="+Z.id,I.Lightbox.open_remote(W,I.CommunityBanLightbox)}}(this)},D({},this.tt("community.post_list.ban"))):void 0,l.admin_url?s({href:l.admin_url},"Admin"):void 0),(rt=this.state)!=null&&rt.replying_to?this.render_reply_form():void 0))},render_edit_form:function(){var o;return o=this.props.post,this.edit_form_cancel||(this.edit_form_cancel=y({}," ",r({type:"button",className:"textlike",onClick:function(e){return function(){return e.setState({editing:!1})}}(this)},"Cancel"))),d.PostEditForm({edit_url:this.props.urls.edit_url({id:o.id}),more_buttons:this.edit_form_cancel,reply_form_params:this.props.reply_form_params,on_create_post:function(e){return function(i){return e.edit_post(i),e.setState({editing:!1})}}(this)})},render_reply_form:function(){var o;return R.SlideDown({},d.PostForm($.extend({submit_url:this.props.urls.reply_url({id:this.props.post.id}),autofocus:!0,open:!0,className:"inline_reply",key:"post-"+(((o=this.state)!=null?o.post_counter:void 0)||0),post_label:this.tt("community.post_form.post_reply"),remember_key:"reply:"+this.props.post.id,on_create_post:this.on_add_reply||(this.on_add_reply=function(e){return function(i){return i.just_added=!0,e.setState(function(c){return{replying_to:!1,post_counter:(c.post_counter||0)+1}}),e.edit_post({replies:[i].concat(e.props.post.replies||[])})}}(this))},this.props.reply_form_params)))},render_current_post:function(){var o,e,i,c;return o=this.props.post,this.enclose({className:classNames("community_post",{disabled:o.deleted||((e=o.user)!=null?e.suspended:void 0)||((i=o.user)!=null?i.deleted:void 0)||o.blocked,is_deleted:o.deleted,is_reply:o.depth>1,is_blocked:o.blocked,is_suspended:(c=o.user)!=null?c.suspended:void 0,has_replies:o.replies&&o.replies.length,has_vote_column:this.get_visible_vote_types()==="ud",moderation_event:o.moderation_event}),id:"post-"+o.id},this.props.len_posts&&this.props.idx===0?a({className:"post_anchor",id:"first-post"}):void 0,this.props.len_posts&&this.props.idx===this.props.len_posts-1?a({className:"post_anchor",id:"last-post"}):void 0,o.moderation_event?this.render_current_post_moderation_event():this.render_current_post_contents())}}),d("PostList",{pure:!0,propTypes:{children:S.array,urls:S.object},componentDidCatch:function(o,e){return I.event("error","react","Community.PostList"),this.setState({critical_error:!0})},render:function(){var o;return(o=this.state)!=null&&o.critical_error?x({},"There was an error rendering the comments, please ",s({href:"https://itch.io/support"},"contact support")," with a link to this page."):this.props.posts?(this.url_templates||(this.url_templates=function(e){return function(){var i,c,l,g;c={},l=e.props.urls;for(i in l)p.call(l,i)&&(g=l[i],c[i]=_.template(g));return c}}(this)()),this.enclose({},this.props.posts.map(function(e){return function(i,c){var l;return l=c===0?e.first_post_ref||(e.first_post_ref=React.createRef()):void 0,d.Post({ref:l,key:i.id,readonly:e.props.readonly,idx:c,edit_post:e.props.edit_post,len_posts:e.props.posts.length,post:i,current_user:e.props.current_user,urls:e.url_templates,reply_form_params:e.props.reply_form_params})}}(this)))):null}}),d("LoadOnScroll",{componentWillUnmount:function(){return typeof this.unbind_visibility=="function"?this.unbind_visibility():void 0},componentDidMount:function(){var o;return o=ReactDOM.findDOMNode(this),this.unbind_visibility=$(o).lazy_images({elements:[o],show_images:function(e){return function(){var i;return(i=e.props)!=null?i.on_seen():void 0}}(this)})},render:function(){return this.props.children}}),d("PostEditForm",{propTypes:{edit_url:S.string.isRequired},componentDidCatch:function(o,e){return I.event("error","react","Community.PostEditForm"),this.setState({critical_error:!0})},getInitialState:function(){return{loading:!0}},componentDidMount:function(){return $.ajax({type:"GET",dataType:"json",url:this.props.edit_url,xhrFields:{withCredentials:!0}}).done(function(o){return function(e){return o.setState({loading:!1,errors:e.errors,body_format:e.body_format,body:e.body})}}(this)).fail(function(o){return function(e){return o.setState({critical_error:!0,loading:!1})}}(this))},render:function(){var o;return(o=this.state)!=null&&o.critical_error?x({},"There was an error editing this post, please ",s({href:"https://itch.io/support"},"contact support")," with a link to this page."):this.state.body?d.PostForm($.extend({},this.props.reply_form_params,{submit_url:this.props.edit_url,autofocus:!0,open:!0,className:"inline_edit",defaultValue:this.state.body,body_format:this.state.body_format,post_label:this.tt("misc.forms.save"),more_buttons:this.props.more_buttons,on_create_post:this.props.on_create_post})):a({},"")}}),d("PostForm",{getInitialState:function(){return{open:this.props.open||!1}},componentDidCatch:function(o,e){return I.event("error","react","Community.PostForm")},render:function(){return this.enclose({},this.state.open?this.render_form():this.render_pre_form())},render_pre_form:function(){return v({className:classNames("form post_form",this.props.className)},L({className:"click_input",type:"text",placeholder:this.t("game.comments.write_your_comment"),onFocus:function(o){return function(){return o.setState({open:!0,focus:!0})}}(this)}))},render_form:function(){var o,e,i;return v({action:this.props.submit_url,ref:this.form_ref||(this.form_ref=React.createRef()),className:classNames("form post_form",this.props.className),onSubmit:function(c){return function(l){var g;if(!((g=c.state)!=null&&g.loading))return l.preventDefault(),c.setState({loading:!0}),I.remote_submit($(l.target),[{name:"format",value:"props"}]).done(function(w){var b,H;if(w.errors){c.setState({needs_recaptcha:m.call(w.errors,"recaptcha")>=0,errors:w.errors,loading:!1});return}if((H=c.body_input_ref.current)!=null&&H.clear_memory(),w.redirect_to){window.location=w.redirect_to;return}if(w.flash&&I.flash(w.flash),c.setState({loading:!1,needs_recaptcha:!1,errors:null}),w.post)return typeof(b=c.props).on_create_post=="function"?b.on_create_post(w.post):void 0})}}(this)},(o=this.state)!=null&&o.errors?R.Forms.FormErrors({errors:this.state.errors,animated:!0,scroll_into_view:!0}):void 0,R.CSRF({}),this.props.body_format?L({type:"hidden",name:"post[body_format]",value:this.props.body_format}):void 0,function(){switch(this.props.body_format||"html"){case"html":return R.Redactor({placeholder:"Required",ref:this.body_input_ref||(this.body_input_ref=React.createRef()),remember_key:this.props.remember_key,name:"post[body]",required:!0,defaultValue:this.props.defaultValue,redactor_opts:$.extend({minHeight:50,focus:this.props.autofocus||this.state.focus},this.props.redactor_opts)});case"markdown":return R.Forms.MarkdownInput({ref:this.body_input_ref||(this.body_input_ref=React.createRef()),remember_key:this.props.remember_key,placeholder:"Required",defaultValue:this.props.defaultValue,name:"post[body]",autofocus:this.props.autofocus||this.state.focus,required:!0,on_submit_hotkey:this.on_submit_hotkey_callback||(this.on_submit_hotkey_callback=function(c){return function(){var l,g;return(l=c.submit_button_ref)!=null&&(g=l.current)!=null?g.click():void 0}}(this))});default:return R.Forms.FormErrors({animated:!0,scroll_into_view:!0,errors:["Don't know how to edit post with format "+this.state.body_format]})}}.call(this),(e=this.state)!=null&&e.needs_recaptcha?R.Forms.RecaptchaInput({sitekey:this.props.recaptcha_sitekey}):void 0,a({className:"buttons"},r({className:"button",disabled:(i=this.state)!=null?i.loading:void 0,ref:this.submit_button_ref||(this.submit_button_ref=React.createRef())},this.props.post_label||this.tt("community.post_form.post")),this.props.more_buttons))}}),R.package("Game")("Comments",{pure:!0,getDefaultProps:function(){return{autoload_count:1}},getInitialState:function(){return{posts:this.props.posts,pagination:this.props.pagination,autoload_count:this.props.autoload_count}},create_scroll_restore:function(o){var e,i,c;return o=$(o).find(".post_grid"),o.length?(i=o.offsetParent(),c=window.document.documentElement.scrollTop,e=o.position().top-c,function(){return window.document.documentElement.scrollTop=o.position().top-e}):function(){}},load_page:function(o){var e;if(o==null&&(o="next_page"),!!((e=this.state.pagination)!=null&&e[o]))return this.setState({loading:!0}),$.getJSON(this.props.topic.url,this.state.pagination[o]).done(function(i){return function(c){var l,g,w,b,H,J,et,rt,Z;return c.posts?(w=Object.assign({},i.props.pagination),w[o]=(J=c.pagination)!=null?J[o]:void 0,H=function(){switch(o){case"prev_page":return c.posts.concat(this.state.posts);case"next_page":return this.state.posts.concat(c.posts)}}.call(i),Z=o==="prev_page"?(b=(et=i.post_list_ref)!=null?et.current:void 0,(g=b!=null&&(rt=b.first_post_ref)!=null?rt.current:void 0)?(l=ReactDOM.findDOMNode(g),i.create_scroll_restore(l)):void 0):void 0,i.setState({loading:!1,posts:H,pagination:w},Z)):i.setState({loading:!1,pagination:null})}}(this))},render:function(){var o,e,i,c,l;return this.enclose({},C({},this.tt("game.comments.comments_header")),d.PostForm({key:"post-"+(((e=this.state)!=null?e.post_counter:void 0)||0),submit_url:this.props.post_form.submit_url,post_label:this.tt("game.comments.post_comment"),recaptcha_sitekey:this.props.recaptcha_sitekey,remember_key:this.props.remember_key||"topic:"+this.props.topic.id,redactor_opts:this.props.post_form.redactor_opts,body_format:this.props.body_format,on_create_post:this.on_create_post||(this.on_create_post=function(g){return function(w){return g.setState(function(b){return w.just_added=!0,{post_counter:(b.post_counter||0)+1,posts:[w].concat(b.posts||[])}})}}(this))}),this.state.pagination&&this.state.pagination.prev_page?T({className:"pagination_buttons"},s({href:this.props.topic.url+"?"+$.param(this.state.pagination.prev_page),className:"load_posts_before",disabled:(i=this.state)!=null?i.loading:void 0,onClick:this.load_prev_page||(this.load_prev_page=function(g){return function(w){return w.preventDefault(),g.load_page("prev_page")}}(this))},"Show previous posts \u2191")):void 0,d.PostList({ref:this.post_list_ref||(this.post_list_ref=React.createRef()),posts:this.state.posts,urls:this.props.urls,current_user:this.props.current_user||I.current_user,reply_form_params:this.reply_form_params||(this.reply_form_params={recaptcha_sitekey:this.props.recaptcha_sitekey,redactor_opts:this.props.post_form.redactor_opts,body_format:this.props.body_format}),edit_post:this.edit_post||(this.edit_post=function(g){return function(w,b){return g.setState(function(H){var J;return{posts:function(){var et,rt,Z,tt;for(Z=H.posts,tt=[],et=0,rt=Z.length;et<rt;et++)if(J=Z[et],J===w){if(b==="remove")continue;tt.push($.extend({},w,b))}else tt.push(J);return tt}()}})}}(this))}),this.state.pagination&&this.state.pagination.next_page?(o=a({className:"pagination_buttons"},s({href:this.props.topic.url+"?"+$.param(this.state.pagination.next_page),className:classNames("load_posts_after",{loading:(c=this.state)!=null?c.loading:void 0}),onClick:this.load_next_page||(this.load_next_page=function(g){return function(w){var b;if(w.preventDefault(),!((b=g.state)!=null&&b.loading))return g.load_page("next_page")}}(this))},(l=this.state)!=null&&l.loading?"Loading...":"Load more")),this.state.autoload_count>0?d.LoadOnScroll({key:JSON.stringify(this.state.pagination),on_seen:function(g){return function(){return g.setState(function(w){return{autoload_count:w.autoload_count-1}}),g.load_page("next_page")}}(this)},o):o):void 0)}})})}.call(this),function(){I.libs.react.done(function(){var d,t,s,n,r,u,a,h,f,v,y,j,C,x,P,V,O,A,M,L,F,U,K,Q,q,Y,T,E,G,X,N,D,z,S,k;t=ReactDOMFactories,a=t.div,N=t.span,s=t.a,n=t.br,T=t.p,Q=t.ol,k=t.ul,K=t.li,D=t.strong,h=t.em,M=t.img,v=t.form,F=t.label,L=t.input,z=t.textarea,r=t.button,A=t.iframe,j=t.h1,C=t.h2,x=t.h3,P=t.h4,V=t.h5,O=t.h6,E=t.pre,u=t.code,X=t.select,Y=t.option,G=t.section,q=t.optgroup,f=t.fieldset,U=t.legend,y=React.createElement.bind(null,React.Fragment),y.type=React.fragment,d=R.package("Community"),S=PropTypes,d("TopicVoter",{propTypes:{post_id:S.number.isRequired,vote:S.string,vote_url:S.string.isRequired,score:S.number.isRequired,adjustment:S.number,dir:S.string},getInitialState:function(){return{vote:this.props.vote}},vote:function(p){var m,o,e;if(!I.current_user){window.location=this.login_url();return}return this.setState({loading:!0}),e=_.template(this.props.vote_url)({post_id:this.props.post_id}),o=!1,m=p===this.state.vote?(o=!0,{action:"remove"}):{direction:p},$.ajax({url:e,type:"POST",dataType:"json",data:I.with_csrf(m),xhrFields:{withCredentials:!0}}).done(function(i){return function(c){if(i.setState({loading:!1}),c.success)return i.setState({vote:!o&&p,adjustment:c.score_adjustment}),$(ReactDOM.findDOMNode(i)).find("button").trigger("i:refresh_tooltip")}}(this)).fail(function(i){return function(c){return i.setState({loading:!1,has_error:!0})}}(this))},login_url:function(){return"/login?"+$.param({return_to:window.location.toString(),intent:"community"})},render:function(){var p,m,o;return m=this.props.score,this.state.vote&&(m+=(p=this.state.adjustment)!=null?p:this.props.adjustment),o="vote_btn button small",a({},r({type:"button","aria-label":this.state.vote==="up"?"Remove up vote":"Vote up",className:classNames(o,"vote_up_btn icon-caret-up",{outline:this.state.vote!=="up",disabled:this.state.loading}),disabled:this.state.loading,onClick:function(e){return function(){return e.vote("up")}}(this)}),a({className:"vote_score"},m),this.props.dir!=="up"?r({type:"button","aria-label":this.state.vote==="down"?"Remove down vote":"Vote down",className:classNames(o,"vote_down_btn icon-caret-down",{outline:this.state.vote!=="down",disabled:this.state.loading}),disabled:this.state.loading,onClick:function(e){return function(){return e.vote("down")}}(this)}):void 0)}})})}.call(this),function(){I.libs.react.done(function(){var d,t,s,n,r,u,a,h,f,v,y,j,C,x,P,V,O,A,M,L,F,U,K,Q,q,Y,T,E,G,X,N,D,z,S,k;t=ReactDOMFactories,a=t.div,N=t.span,s=t.a,n=t.br,T=t.p,Q=t.ol,k=t.ul,K=t.li,D=t.strong,h=t.em,M=t.img,v=t.form,F=t.label,L=t.input,z=t.textarea,r=t.button,A=t.iframe,j=t.h1,C=t.h2,x=t.h3,P=t.h4,V=t.h5,O=t.h6,E=t.pre,u=t.code,X=t.select,Y=t.option,G=t.section,q=t.optgroup,f=t.fieldset,U=t.legend,y=React.createElement.bind(null,React.Fragment),y.type=React.fragment,d=R.package("Admin"),S=PropTypes,d("RemoteDataList",{componentDidMount:function(){return $.ajax({url:this.props.url,dataType:"json",xhrFields:{withCredentials:!0}}).done(function(p){return function(m){return p.setState(m)}}(this))},render:function(){var p;return(p=this.state)!=null&&p.tag_slugs?React.createElement("datalist",{id:this.props.id},this.state.tag_slugs.map(function(m){return function(o){return Y({key:o,value:o})}}(this))):null}}),d("TagEditor",{getInitialState:function(){return{closed:!1,featured_tags:this.props.featured_tags,tags:this.props.tags}},update_from_res:function(p){if(p.errors){this.setState({errors:p.errors});return}return p.featured_tags||(p.featured_tags=[]),p.tags||(p.tags=[]),this.setState(p)},feature_tag:function(p,m){return m==null&&(m="add"),this.setState({errors:null}),$.ajax({url:this.props.submit_url,type:"post",dataType:"json",xhrFields:{withCredentials:!0},data:I.with_csrf({action:m,tag_slug:p})}).done(this.update_from_res)},render_queue:function(){var p,m;return p=((m=this.props.queue_rating)!=null?m.rating:void 0)||"unrated",a({className:classNames("queue_status",p,{unrated:!this.props.queue_rating})},s({href:this.props.queue_url},p))},render_suggested_tweet:function(){if(this.props.suggested_tweet)return y({},React.createElement("hr",{}),React.createElement("details",{},React.createElement("summary",{},D({},"Tweet builder")),z({className:"tweet_preview",defaultValue:this.props.suggested_tweet}),N({},"Len: "+this.props.suggested_tweet.length),this.props.cover_url?a({},s({href:this.props.cover_url},"Original cover")):void 0))},has_featured_tag:function(p){var m,o,e,i;if(!this.state.featured_tags)return!1;for(e=this.state.featured_tags,m=0,o=e.length;m<o;m++)if(i=e[m],i.tag_slug===p)return!0;return!1},render:function(){var p,m,o;return this.state.closed?null:this.enclose({},this.state.errors?a({className:"form_errors"},this.state.errors.join(", ")):void 0,this.render_queue(),a({className:"panel_inside"},D({},"User tags"),(p=this.state.tags)!=null&&p.length?(o={},this.state.tags.map(function(e){return function(i){if(!o[i.tag_slug])return o[i.tag_slug]=!0,a({className:"tag_row",key:i.tag_slug},a({},s({href:i.url},i.featured?D({},i.tag_slug):i.tag_slug),e.has_featured_tag(i.tag_slug)?" \u2611":y({}," (",s({href:"#",className:"feature_tag_btn",onClick:function(c){return c.preventDefault(),e.feature_tag(i.tag_slug)}},"add"),")")))}}(this))):a({className:"tag_row"},h({},"None")),React.createElement("hr",{}),D({},"Featured tags"),v({method:"POST",action:this.props.submit_url,className:"new_tag_form",onSubmit:function(e){return function(i){return i.preventDefault(),I.remote_submit($(i.target)).done(e.update_from_res).done(function(){var c;return(c=e.tag_input_ref.current)!=null?c.value="":void 0})}}(this)},R.CSRF({}),L({type:"hidden",name:"action",value:"add"}),L({ref:this.tag_input_ref||(this.tag_input_ref=React.createRef()),onMouseEnter:function(e){return function(){if(!e.state.focused)return e.setState({focused:!0})}}(this),onFocus:function(e){return function(){if(!e.state.focused)return e.setState({focused:!0})}}(this),type:"text",name:"tag_slug",list:"tag-options"}),this.state.focused?d.RemoteDataList({url:this.props.submit_url,id:"tag-options"}):void 0,r({},"Add")),(m=this.state.featured_tags)!=null?m.map(function(e){return function(i){return a({className:"tag_row",key:i.tag_slug},a({},s({href:i.url},i.tag_slug)," (",s({href:"#",className:"feature_tag_btn",onClick:function(c){return c.preventDefault(),e.feature_tag(i.tag_slug,"delete")}},"remove"),")"))}}(this)):void 0,this.render_suggested_tweet()),r({className:"close_btn",onClick:function(e){return function(){return e.setState({closed:!0})}}(this)},"\xD7"))}})})}.call(this),function(){I.libs.react.done(function(){var d,t,s,n,r,u,a,h,f,v,y,j,C,x,P,V,O,A,M,L,F,U,K,Q,q,Y,T,E,G,X,N,D,z,S,k,p,m,o;t=ReactDOMFactories,f=t.div,z=t.span,s=t.a,r=t.br,G=t.p,Y=t.ol,o=t.ul,q=t.li,S=t.strong,v=t.em,F=t.img,j=t.form,K=t.label,U=t.input,p=t.textarea,u=t.button,L=t.iframe,x=t.h1,P=t.h2,V=t.h3,O=t.h4,A=t.h5,M=t.h6,X=t.pre,a=t.code,D=t.select,E=t.option,N=t.section,T=t.optgroup,y=t.fieldset,Q=t.legend,C=React.createElement.bind(null,React.Fragment),C.type=React.fragment,d=R.package("Game"),m=PropTypes,h=ReactDOMFactories.details,k=ReactDOMFactories.summary,n=ReactDOMFactories.abbr,d("QuarantineLightbox",{pure:!0,render_timestamp:function(e){return n({title:e,className:"datetime"},z({className:"icon icon-stopwatch","aria-hidden":"true"})," ",I.format_timestamp(e))},render:function(){return R.Lightbox({className:this.enclosing_class_name()},P({},"WARNING: This Page Has Been Quarantined"),G({},S({},"Our system has flagged this page for additional review due to potential suspicious behavior from the page owner. ")),G({},"If someone has asked you to download from this page and you don't fully trust them, or their behavior isn't what you recognize, then we don't recommend downloading this file until our team has reviewed the page."),G({},"Password-protecting files or pages is a technique often used by scammers in an attempt to block virus and other security scans from detecting malware. Do not trust password-protected files unless you fully trust the uploader."),G({},s({href:"https://itch.io/t/1659440/psa-beware-discord-scammers",className:"forward_link",target:"_blank"},'Learn more about the "Try my game" Discord scam')),N({},V({},"Page and Account Details"),o({className:"account_summary"},q({},"Page created ",this.render_timestamp(this.props.game_created_at)),q({},"Account created ",this.render_timestamp(this.props.user_created_at)),this.props.user_email_verified?void 0:q({},"Account's email is not verified"),this.props.user_email_invalid?q({},z({className:"icon icon-warning"})," ","Account may have fake email address"):void 0,this.props.user_recent_countries?q({},"Regions this account has connected from: ",S({},new Intl.ListFormat("en").format(this.props.user_recent_countries))):void 0)),h({},k({},"I understand the risks, let me download anyway..."),f({className:"download_row"},u({type:"button",className:"button",onClick:this.force_download},"Download ",this.props.upload.name?a({},this.props.upload.name):void 0,this.props.upload.size?z({className:"upload_size"}," ("+I.format_bytes(this.props.upload.size)+")"):void 0)," Uploaded ",this.render_timestamp(this.props.upload.created_at))),G({className:"buttons"},u({type:"button",className:"button",onClick:this.report_page},"Report this page")," ",u({type:"button",className:"button outline close_btn"},"Close")))},report_page:function(){return I.Lightbox.open_remote_react(this.props.report_url,function(e){return R.Game.ReportLightbox(e)})},force_download:function(){return this.props.on_force_download?this.props.on_force_download():(I.bypass_quarantine=!0,I.Lightbox.close())}})})}.call(this),function(){I.libs.react.done(function(){var d,t,s,n,r,u,a,h,f,v,y,j,C,x,P,V,O,A,M,L,F,U,K,Q,q,Y,T,E,G,X,N,D,z,S,k;t=ReactDOMFactories,a=t.div,N=t.span,s=t.a,n=t.br,T=t.p,Q=t.ol,k=t.ul,K=t.li,D=t.strong,h=t.em,M=t.img,v=t.form,F=t.label,L=t.input,z=t.textarea,r=t.button,A=t.iframe,j=t.h1,C=t.h2,x=t.h3,P=t.h4,V=t.h5,O=t.h6,E=t.pre,u=t.code,X=t.select,Y=t.option,G=t.section,q=t.optgroup,f=t.fieldset,U=t.legend,y=React.createElement.bind(null,React.Fragment),y.type=React.fragment,d=R.package("Game"),S=PropTypes,d("ReportLightbox",{pure:!0,render:function(){var p;return R.Lightbox({className:this.enclosing_class_name()},(p=this.state)!=null&&p.submitted?this.render_after_submit():this.render_report_form())},get_report_options:function(){var p;return p=[["broken","Broken","Doesn't run, download, or crashes"],["offensive","Offensive material"],["doesnt_own","Uploader not authorized to distribute"],["miscategorized","Miscategorized","Shows up on wrong part of itch.io, incorrect tags, incorrect platforms, etc."],["spam","Spam"],["other",this.tt("game.report_form.reason_other")]],this.props.jam&&p.unshift(["invalid_jam_submission","Invalid jam submission","Empty or incomplete page, breaks rules, etc."]),p},render_report_form:function(){var p,m,o,e,i;return y({},C({},this.tt("game.report_form.title",{page_title:this.props.page_title})),v({className:"form",method:"post",action:this.props.submit_url,onSubmit:function(c){return function(l){return l.preventDefault(),c.setState({errors:null,loading:!0}),I.remote_submit($(l.target)).done(function(g){if(g.errors){c.setState({loading:!1,errors:g.errors});return}return c.setState({submitted:!0,report_id:g.report_id})})}}(this)},R.CSRF({}),this.props.support_email||this.props.support_link?T({className:"support_notice"},this.tt("game.report_form.support_from_creator")," ",this.props.support_link?s({rel:"nofollow",target:"blank",className:"forward_link",href:this.props.support_link},this.tt("game.report_form.support_page_link")):s({rel:"nofollow",target:"blank",className:"forward_link",href:"mailto:"+this.props.support_email},this.tt("game.report_form.email_creator_link"))):void 0,(p=this.state)!=null&&p.errors?R.Forms.FormErrors({errors:this.state.errors,animated:!0,scroll_into_view:!0}):void 0,T({},this.tt("game.report_form.form_description")),this.props.jam?T({},"This report will be made available to hosts of ",s({href:this.props.jam.url},this.props.jam.name),"."):void 0,a({className:"input_row"},a({className:"label"},this.tt("game.report_form.reason_label")),R.Forms.RadioButtons({name:"report[reason]",value:((m=this.state)!=null?m.reason:void 0)||"",onChange:function(c){return function(l){return c.setState({reason:l.target.value})}}(this),options:this.get_report_options()})),((o=this.state)!=null?o.reason:void 0)==="doesnt_own"?a({className:"input_row"},D({},"Are you the copyright owner and need to file a DMCA notice?")," ",s({target:"_blank",href:this.props.itchio_support_url,className:"forward_link"},"Contact our support team so we can step you through the process")):void 0,a({className:"input_row"},F({},a({className:"label"},this.tt("game.report_form.description_label"),N({className:"sub"}," \u2014 ",this.description_description())),z({maxLength:"2048",name:"report[description]",required:this.description_required(),placeholder:this.description_required()?this.t("misc.forms.required"):this.t("misc.forms.optional")}))),R.Forms.TextInputRow({title:"Your email",sub:"If your report needs a reply we'll use it to communicate with you",name:"report[email]",defaultValue:this.props.current_user_email,required:this.email_required(),placeholder:this.email_required()?this.t("misc.forms.required"):this.t("misc.forms.optional")}),a({callback:"buttons"},r({disabled:(e=this.state)!=null?e.loading:void 0,className:classNames("button",{disabled:(i=this.state)!=null?i.loading:void 0})},this.tt("game.report_form.submit_report_button")))))},render_after_submit:function(){return a({className:"report_submitted"},C({},this.tt("game.report_form.report_received_header")),T({},"You report will be reviewed shortly, and action will be taken if necessary. If you have any additional requests then you can ",s({href:this.props.itchio_support_url,target:"_blank"},"contact our support team"),"."),this.state.report_id?T({},"If you need to talk to itch.io staff about your report please use the following reference code: ",u({},D({},"R-"+this.state.report_id)),"."):void 0,T({},r({type:"button",className:"textlike",onClick:function(p){return function(m){return I.Lightbox.close()}}(this)},this.tt("misc.lightboxes.close"))))},description_description:function(){var p;switch((p=this.state)!=null?p.reason:void 0){case"broken":return"Please explain what is broken. Include how you tried to run the project, what operating system or browser you're using, and any error messages you saw. We will share your error with the creator to help them fix the issue.";case"invalid_jam_submission":return"Please explain why this submission should be disqualified or removed";case"miscategorized":return"Please explain how this project should be categorized.";default:return"Please provide a summary of your report"}},description_required:function(){var p,m;return(p=(m=this.state)!=null?m.reason:void 0)==="broken"||p==="miscategorized"||p==="other"||p==="invalid_jam_submission"},email_required:function(){var p,m;return(p=(m=this.state)!=null?m.reason:void 0)==="broken"||p==="doesnt_own"}})})}.call(this),function(){I.libs.react.done(function(){var d,t,s,n,r,u,a,h,f,v,y,j,C,x,P,V,O,A,M,L,F,U,K,Q,q,Y,T,E,G,X,N,D,z,S,k;t=ReactDOMFactories,a=t.div,N=t.span,s=t.a,n=t.br,T=t.p,Q=t.ol,k=t.ul,K=t.li,D=t.strong,h=t.em,M=t.img,v=t.form,F=t.label,L=t.input,z=t.textarea,r=t.button,A=t.iframe,j=t.h1,C=t.h2,x=t.h3,P=t.h4,V=t.h5,O=t.h6,E=t.pre,u=t.code,X=t.select,Y=t.option,G=t.section,q=t.optgroup,f=t.fieldset,U=t.legend,y=React.createElement.bind(null,React.Fragment),y.type=React.fragment,d=R.package("Library"),S=PropTypes,d("RateGameLightbox",{propTypes:{game:S.object.isRequired,follow_button:S.object,game_rating:S.object},is_closable:function(){var p,m;return((p=this.props)!=null&&(m=p.lightbox_props)!=null?m.close:void 0)!==!1},submit_rating:function(p){return p.preventDefault(),this.setState({loading:!0}),I.remote_submit($(p.target)).done(function(m){return function(o){var e,i,c;if(o.errors){m.setState({loading:!1,errors:o.errors});return}return(i=m.blurb_input_ref.current)!=null&&i.clear_memory(),m.setState({submitted:!0,loading:!1,saved_score:(c=o.game_rating)!=null?c.score:void 0}),typeof(e=m.props).on_save_rating=="function"?e.on_save_rating(o):void 0}}(this))},delete_rating:function(){if(this.props.game_rating)return this.setState({loading:!0}),$.ajax({type:"POST",dataType:"json",url:this.props.rate_url,xhrFields:{withCredentials:!0},data:I.with_csrf({remove_game_rating:"1"})}).done(function(p){return function(m){var o,e;if(p.setState({loading:!1}),m.errors){p.setState({errors:m.errors});return}return(e=p.blurb_input_ref.current)!=null&&e.clear_memory(),p.setState({submitted:!0,deleted:!0,game_rating:!1}),typeof(o=p.props).on_delete_rating=="function"?o.on_delete_rating(m):void 0}}(this))},render_rating_form:function(){var p,m,o,e,i;return y({},C({},this.tt("library.rate_game.rate_header",{project_title:N({className:"object_title"},this.props.game.title)})),v({className:"form",action:this.props.rate_url,onSubmit:this.submit_rating},R.CSRF({}),(o=this.state)!=null&&o.errors?R.Forms.FormErrors({animated:!0,errors:this.state.errors}):void 0,this.props.game_rating?(m=this.props.game_rating.created_at,T({},this.tt("library.rate_game.you_rated_this_project_ago",{time_ago:N({className:"date_format",title:m},I.format_timestamp(m))}))):T({},this.tt("library.rate_game.choose_stars")),a({className:"star_wrapper"},R.Forms.StarPicker({className:"star_picker",name:"game_rating",defaultValue:(e=this.props.game_rating)!=null?e.score:void 0})),a({className:"input_row"},a({className:"label"},"Your review",a({className:"sub"},"Share what you liked or disliked about this project. Our ",s({target:"_blank",href:"https://itch.io/docs/general/community-rules"},"community rules")," apply here. Reviews are shared with developers and your followers.")),R.Redactor({defaultValue:(p=(i=this.props.game_rating)!=null?i.blurb:void 0)?p._unsafe||p._safe:void 0,ref:this.blurb_input_ref||(this.blurb_input_ref=React.createRef()),remember_key:"game_rating:"+this.props.game.id,name:"game_rating_blurb",placeholder:"Optional",redactor_opts:{plugins:["table","alignment","video"],buttons:["bold","italic","deleted","lists","link"]}})),a({className:"buttons"},r({className:"button"},this.props.game_rating?this.tt("misc.forms.save"):this.tt("misc.forms.submit")),this.props.game_rating?r({type:"button",className:"textlike delete_rating_btn",onClick:function(c){return function(l){if(l.preventDefault(),confirm("Are you sure you want to delete your rating & review"))return c.delete_rating()}}(this)},this.tt("library.rate_game.delete_button")):void 0)))},render_after_rating:function(){var p;return p=this.is_closable()?T({},r({type:"button",onClick:function(m){return function(o){return o.preventDefault(),I.Lightbox.close()}}(this),className:"textlike"},this.tt("misc.lightboxes.close"))):void 0,this.state.deleted?y({},C({},this.tt("library.rate_game.rating_removed_header")),T({},this.tt("library.rate_game.rating_deleted_summary")),p):y({},C({},this.tt("library.rate_game.rating_saved_header")),this.props.follow_button&&(this.state.saved_score||0)>=3?a({className:"suggested_follow"},T({},this.tt("library.rate_game.follow_creator",{project_title:s({href:this.props.game.url,target:"_blank"},this.props.game.title)})),T({},R.FollowButton(this.props.follow_button))):T({},"Your rating has been saved."),p)},render:function(){var p;return R.Lightbox(Object.assign({className:this.enclosing_class_name()},this.props.lightbox_props),(p=this.state)!=null&&p.submitted?this.render_after_rating():this.render_rating_form())}})})}.call(this),function(){I.libs.react.done(function(){var d,t,s,n,r,u,a,h,f,v,y,j,C,x,P,V,O,A,M,L,F,U,K,Q,q,Y,T,E,G,X,N,D,z,S;t=ReactDOMFactories,a=t.div,N=t.span,s=t.a,n=t.br,T=t.p,Q=t.ol,S=t.ul,K=t.li,D=t.strong,h=t.em,M=t.img,v=t.form,F=t.label,L=t.input,z=t.textarea,r=t.button,A=t.iframe,j=t.h1,C=t.h2,x=t.h3,P=t.h4,V=t.h5,O=t.h6,E=t.pre,u=t.code,X=t.select,Y=t.option,G=t.section,q=t.optgroup,f=t.fieldset,U=t.legend,y=React.createElement.bind(null,React.Fragment),y.type=React.fragment,d=R.package("Ads"),R("ShareButtons",{pure:!0,render:function(){return this.enclose({className:"simple_social_buttons_widget"},this.props.twitter?s({href:this.props.twitter.url,target:"_blank",rel:"noopener nofollow",className:"twitter_link",title:"Share on Twitter..."},N({className:"icon icon-twitter"})):void 0,this.props.facebook?s({href:this.props.facebook.url,target:"_blank",rel:"noopener nofollow",className:"facebook_link",title:"Share on Facebook..."},N({className:"icon icon-facebook"})):void 0)}}),d("AfterDownload",{pure:!0,componentDidMount:function(){var k,p;return k=ReactDOM.findDOMNode(this),p=document.createElement("script"),p.async=!0,p.src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js",k.appendChild(p),(window.adsbygoogle||(window.adsbygoogle=[])).push({})},render:function(){return a({},React.createElement("ins",{className:"adsbygoogle",style:{display:"block"},"data-ad-client":"ca-pub-4267538250984114","data-ad-slot":"9114825859","data-ad-format":"auto","data-full-width-responsive":"true"}))}}),R("AfterDownloadLightbox",{componentDidMount:function(){var k,p;if(this.props.push_state)try{return p={title:document.title,url:window.location.toString()},typeof(k=window.history).replaceState=="function"&&k.replaceState({},this.props.push_state.title,this.props.push_state.url),this.previous_state=p}catch(m){}},componentWillUnmount:function(){var k;if(this.previous_state)return typeof(k=window.history).replaceState=="function"&&k.replaceState({},this.previous_state.title,this.previous_state.url),delete this.previous_state},render:function(){return R.Lightbox({className:this.enclosing_class_name()},C({},this.tt("game.after_download.thanks_for_downloading_title")),T({},this.tt("game.after_download.thanks_project_author",{author:this.props.user.name,project:h({},this.props.game.title)}),this.props.has_more_games?y({}," ",this.tt("game.after_download.more_from_creator",{profile:s({href:this.props.user.url},this.props.user.name)})):void 0," ",this.tt("game.after_download.check_popup_blocker")),this.props.show_ad?R.Ads.AfterDownload({}):void 0,this.props.show_app_banner&&this.props.app_url?T({},this.tt("game.after_download.app_learn_more",{s:function(k){return D({},k)},a:function(k){return function(p){return s({href:k.props.app_url,className:"forward_link","data-action":"download_app","data-label":"app_notice"},p)}}(this)})):void 0,a({className:"share_row"},this.props.user.follow_button?R.FollowButton(this.props.user.follow_button):void 0,this.props.share_buttons?N({className:"share_links"},N({className:"icon icon-heart"})," ",I.i18n.locale_is_english()?"Share this "+this.props.game.noun+":":this.tt("game.after_download.share_this_project"),R.ShareButtons(this.props.share_buttons)):void 0),this.render_jam_games()||this.render_rec_games(),a({className:"bandwidth_row"},this.tt("game.after_download.powered_by",{s:function(k){return N({className:"powered"},k)},itchio_logo:M({height:25,src:this.props.logo_url})})))},render_jam_games:function(){if(this.props.jam_games&&this.props.jam_games.length)return G({className:"related_games"},x({},this.tt("game.after_download.check_out_more_from_jam_title",{jam_title:s({href:this.props.related_jam.url,target:"_blank"},this.props.related_jam.title)})),this.render_game_grid(this.props.jam_games,{show_rating:!1}),this.props.related_jam.entries_url?a({className:"browse_footer"},s({href:this.props.related_jam.entries_url,className:"button outline"},this.tt("game.after_download.view_all_from_jam"))):void 0)},render_rec_games:function(){if(this.props.rec_games&&this.props.rec_games.length)return G({className:"related_games"},x({},this.props.rec_games_title||this.tt("game.after_download.more_from_itchio_header")),this.render_game_grid(this.props.rec_games),a({className:"browse_footer"},s({href:this.props.browse_url,className:"button outline"},this.tt("game.after_download.see_everything"))))},render_game_grid:function(k,p){return R.Index.GameGrid({games:k,cell_width:200,fit_rows:3,enable_popups:!1,conversion_source:this.props.conversion_source,grid_referrer:this.props.grid_referrer,cell_props:$.extend({target:"_blank",show_rating:!0,show_cell_tools:!1},p)})}})})}.call(this),function(){I.libs.react.done(function(){var d,t,s,n,r,u,a,h,f,v,y,j,C,x,P,V,O,A,M,L,F,U,K,Q,q,Y,T,E,G,X,N,D,z,S,k,p;s=ReactDOMFactories,h=s.div,D=s.span,n=s.a,r=s.br,E=s.p,q=s.ol,p=s.ul,Q=s.li,z=s.strong,f=s.em,L=s.img,y=s.form,U=s.label,F=s.input,S=s.textarea,u=s.button,M=s.iframe,C=s.h1,x=s.h2,P=s.h3,V=s.h4,O=s.h5,A=s.h6,G=s.pre,a=s.code,N=s.select,T=s.option,X=s.section,Y=s.optgroup,v=s.fieldset,K=s.legend,j=React.createElement.bind(null,React.Fragment),j.type=React.fragment,d=R.package("Index"),k=PropTypes,t={},d("ConversionLink",{pure:!0,propTypes:{source:k.number,object_type:k.number,object_id:k.number,href:k.string,target:k.string,class:k.any,impression:k.bool,on_click:k.func,on_impression:k.func},getInitialState:function(){return{seen:!1}},get_suffix:function(){return this.props.source+":"+this.props.object_type+":"+this.props.object_id},on_click:function(m){var o,e,i,c;if(m.type==="click"&&(o=ReactDOM.findDOMNode(this),i=m.metaKey||m.ctrlKey||m.shiftKey||this.props.target==="_blank",E=this.handle_click(),!i&&E.state()!=="resolved"))return m.preventDefault(),c=new Date,e=function(l){return function(){if(e)return e=null,window.location=l.props.href}}(this),setTimeout(function(l){return function(){return typeof e=="function"?e():void 0}}(this),200),E.done(e)},on_mouse_up:function(m){if(m.button===1)return this.handle_click()},handle_click:function(){var m,o,e;return this.props.object_type&&this.props.source&&this.props.object_id?this.state.clicked?this.state.clicked:(o=I.ConversionTracker.types.click+":"+this.get_suffix(),t[o]?$.when():(t[o]=!0,I.ConversionTracker.click(this.get_suffix()),E=I.ConversionTracker.flush_now_beacon(),this.props.track_referrer&&(e=I.ReferrerTracker).push.apply(e,this.props.track_referrer),this.setState({clicked:E}),typeof(m=this.props).on_click=="function"&&m.on_click(),E)):$.when()},componentDidMount:function(){var m;if(this.props.object_type&&this.props.source&&this.props.object_id&&this.props.impression!==!1&&!t[I.ConversionTracker.types.impression+":"+this.get_suffix()])return m=ReactDOM.findDOMNode(this),this.unbind_visibility=$(m).lazy_images({elements:[m],show_images:function(o){return function(){var e,i;return i=I.ConversionTracker.types.impression+":"+o.get_suffix(),t[i]||(I.ConversionTracker.push(i),t[i]=!0),o.setState({seen:!0}),typeof(e=o.props).on_impression=="function"&&e.on_impression(),typeof o.unbind_visibility=="function"&&o.unbind_visibility(),o.unbind_visibility=null}}(this)})},componentWillUnmount:function(){return typeof this.unbind_visibility=="function"?this.unbind_visibility():void 0},render:function(){var m;return n({href:this.props.href,className:this.props.class||this.props.className,onClick:this.on_click,onMouseUp:this.on_mouse_up,target:this.props.target,tabIndex:(m=this.props.tabindex)!=null?m:this.props.tabIndex,"aria-hidden":this.props["aria-hidden"]},this.props.children)}})})}.call(this),function(){I.libs.react.done(function(){var d,t,s,n,r,u,a,h,f,v,y,j,C,x,P,V,O,A,M,L,F,U,K,Q,q,Y,T,E,G,X,N,D,z,S,k,p,m,o=[].slice;n=ReactDOMFactories,f=n.div,z=n.span,r=n.a,u=n.br,G=n.p,Y=n.ol,m=n.ul,q=n.li,S=n.strong,v=n.em,F=n.img,j=n.form,K=n.label,U=n.input,k=n.textarea,a=n.button,L=n.iframe,x=n.h1,P=n.h2,V=n.h3,O=n.h4,A=n.h5,M=n.h6,X=n.pre,h=n.code,D=n.select,E=n.option,N=n.section,T=n.optgroup,y=n.fieldset,Q=n.legend,C=React.createElement.bind(null,React.Fragment),C.type=React.fragment,d=R.package("Index"),p=PropTypes,t={linux:"tux",osx:"apple",windows:"windows8",android:"android"},s={linux:"Linux",osx:"macOS",windows:"Windows",android:"Android"},d("PlatformList",{pure:!0,getDefaultProps:function(){return{prefix:"Available for"}},render:function(){var e,i,c,l,g;if(!(this.props.platforms&&this.props.platforms.length))return null;for(l=[],g=this.props.platforms,e=0,i=g.length;e<i;e++)c=g[e],l.length>0&&l.push(" "),l.push(z({key:c,className:"icon icon-"+t[c],"aria-hidden":"true",title:this.props.prefix+" "+s[c]}));return l}}),d("StarRating",{propTypes:{average:p.number,count:p.number},pure:!0,render:function(){var e,i;return e=this.props.average||0,f({className:"game_rating",title:"Average: "+e.toFixed(2)},z({className:"screenreader_only"},"Average rating "+e.toFixed(2)+" out of 5"),f({className:"star_value"},f({className:"star_fill",style:{width:(e/5*100).toFixed(5)+"%"}},function(){var c,l;for(l=[],i=c=1;c<=5;i=++c)l.push(z({key:i,className:"star icon-star","aria-hidden":"true"}));return l}()),f({className:"star_holes"},function(){var c,l;for(l=[],i=c=1;c<=5;i=++c)l.push(z({key:i,className:"star icon-star2","aria-hidden":"true"}));return l}()))," ",z({className:"rating_count"},"("+I.format_integer(this.props.count),z({className:"screenreader_only"}," total ratings"),")"))}}),d("GameCell",{pure:!0,getDefaultProps:function(){return{show_price:!0,show_short_text:!0,show_platforms:!0,show_rating:!0,show_cell_tools:!0}},getInitialState:function(){return{game:this.build_game()}},componentDidUpdate:function(e){if(e.build_game_object!==this.props.build_game_object||e.game!==this.props.game)return this.setState({game:this.build_game()})},update_focus:function(e){return this.setState({cell_tools_focused:e.currentTarget.contains(document.activeElement)})},build_game:function(){return this.props.build_game_object?this.props.build_game_object(this.props.game):this.props.game},add_to_collection:function(e){if(I.current_user)return e.preventDefault(),I.Lightbox.open_remote("/game/collections/"+this.state.game.id,I.CollectionLightbox)},mark_gif_loaded:function(){return this.setState({gif_loaded:!0})},track_grid_referrer:function(){if(this.props.grid_referrer)return I.ReferrerTracker.push("game",this.state.game.id,this.props.grid_referrer)},game_link:function(){var e,i,c;return c=arguments[0],e=2<=arguments.length?o.call(arguments,1):[],this.props.conversion_source?(i=$.extend({object_type:1,object_id:this.state.game.id,source:this.props.conversion_source,on_click:this.props.grid_referrer?this.track_grid_referrer:void 0},c),d.ConversionLink.apply(d,[i].concat(o.call(e)))):r.apply(null,[c].concat(o.call(e)))},render_user:function(e,i){return i==null&&(i=null),r({key:i,className:"user_link",href:e.url,target:this.props.target},e.name)},render:function(){var e,i,c,l,g,w,b,H,J,et,rt,Z,tt;return b=this.state.game,tt=b.user,J=b.platforms?function(){var B,W,ot,nt;for(ot=b.platforms,nt=[],B=0,W=ot.length;B<W;B++)H=ot[B],t[H]&&nt.push(H);return nt}():void 0,g=b.cover_color&&I.Color?(rt=I.Color.parse_color(b.cover_color),et=rt[0],w=rt[1],e=rt[2],"rgba("+et+", "+w+", "+e+", 0.5)"):void 0,this.enclose({"data-game_id":b.id,dir:"auto",className:classNames("game_cell",{focused:this.state.cell_tools_focused}),onMouseEnter:this.state.game.gif_cover?function(B){return function(){return B.setState({hovering:!0})}}(this):void 0,onMouseLeave:this.state.game.gif_cover?function(B){return function(){return B.setState({hovering:!1})}}(this):void 0},f({className:"bordered",style:g&&{backgroundColor:g}},this.game_link({href:b.url,target:this.props.target,className:"game_thumb","aria-hidden":"true",tabIndex:-1},typeof(i=this.props).render_thumb_extras=="function"?i.render_thumb_extras(b):void 0,b.cover?d.LazyImage({src:b.cover}):f({className:"missing_image"},"no image :("),b.gif_cover?f({className:"gif_label"},"GIF"):void 0,(Z=this.state)!=null&&Z.hovering&&b.gif_cover?React.createElement(React.Fragment,{},this.state.gif_loaded?void 0:f({className:"gif_loading_overlay"}),d.LazyImage({className:"gif_cover",src:b.gif_cover,on_load:this.mark_gif_loaded})):void 0),this.props.show_price&&b.sale_rate?f({className:classNames("sale_flag",{reverse_sale:b.sale_rate<0})},f({className:"rate"},Math.abs(b.sale_rate)+"%"),f({className:"mini_label"},b.sale_rate<0?"more":"off")):void 0,J!=null&&J.length?f({className:"p_data fading_data"},d.PlatformList({platforms:J})):void 0,this.props.show_cell_tools?f({className:"fading_data cell_tools",onFocus:this.update_focus,onBlur:this.update_focus},typeof(c=this.props).render_cell_extras=="function"?c.render_cell_extras(b):void 0,r({href:b.url+"/add-to-collection",title:this.t("add_to_collection.add_button"),className:"add_to_collection_btn",onClick:this.add_to_collection,role:"button",onKeyDown:function(B){return function(W){if(W.key===" ")return B.add_to_collection(W)}}(this)},z({className:"icon icon-playlist_add","aria-hidden":"true"}),z({className:"screenreader_only"},"Add to collection"))):void 0),f({className:"label"},function(){if(this.props.show_price)switch(b.flag){case"free":return f({className:"meta_tag free_tag"},"Free");case"web":return f({className:"meta_tag free_tag"},"Web");case"demo":return f({className:"meta_tag demo_tag"},"Demo");default:if(b.price)return f({className:classNames("price_tag meta_tag")},b.price)}}.call(this),this.game_link({target:this.props.target,className:"title",title:b.title,href:b.url},b.title)),f({className:"user_row"},b.contributors?b.contributors.map(function(B){return function(W,ot){return ot>0?C({key:"user-"+ot},", ",B.render_user(W)):B.render_user(W,"user-"+ot)}}(this)):this.render_user(tt)),this.props.show_rating&&b.rating?d.StarRating(b.rating):void 0,b.tags&&b.tags.length?f({className:"sub cell_tags"},b.tags.map(function(B){return function(W,ot){return React.createElement(React.Fragment,{key:W.name},ot>0?", ":void 0,r({href:W.url,target:B.props.target},"#"+W.name))}}(this))):void 0,this.props.show_short_text&&b.short_text?f({className:"sub short_text"},b.short_text):void 0,typeof(l=this.props).render_cell_below=="function"?l.render_cell_below(b):void 0)}}),d("GameGrid",{calculate_cell_sizes:function(e){return function(){var i,c;return(i=e.grid_sizer_ref)!=null&&(c=i.current)!=null?c.calculate_cell_sizes():void 0}}(this),componentDidMount:function(){var e;if(e=this.container(),this.props.enable_popups)return new I.GamePopups(e,{x_offset:10})},getDefaultProps:function(){return{cell_width:I.is_mobile()?300:250,enable_popups:!0,render_game:function(e){var i;return i={render_thumb_extras:this.props.render_thumb_extras,render_cell_extras:this.props.render_cell_extras,render_cell_below:this.props.render_cell_below,key:e.id,game:e,build_game_object:this.props.build_game_object,conversion_source:this.props.conversion_source,grid_referrer:this.props.grid_referrer},this.props.cell_props&&(i=$.extend(i,this.props.cell_props)),d.GameCell(i)}}},render:function(){var e,i;return e={ref:this.grid_sizer_ref||(this.grid_sizer_ref=React.createRef()),cell_margin:10,expected_width:this.props.cell_width,fit_rows:this.props.fit_rows,children:(i=this.props.games)!=null?i.map(this.props.render_game.bind(this)):void 0},this.props.grid_sizer_props&&(e=$.extend(e,this.props.grid_sizer_props)),this.enclose({},d.GridSizer(e))}}),d("NewFromFollowers",{getInitialState:function(){return{games:this.props.games}},componentDidUpdate:function(e,i){var c,l;if(((c=i.games)!=null?c.length:void 0)!==((l=this.state.games)!=null?l.length:void 0))return $(window).trigger("i:reshape")},on_dismiss_games:function(e){var i,c,l,g,w,b,H;if(!((l=this.state)!=null&&l.loading)&&(c=(g=this.game_grid_ref)!=null&&(w=g.current)!=null&&(b=w.grid_sizer_ref)!=null?b.current:void 0,!!c&&(H=this.state.games.slice(0,c.get_num_visible()),!!H.length)))return this.setState({loading:!0}),$.post(this.props.dismiss_url,I.with_csrf({object_type:"game",object_id:function(){var J,et,rt;for(rt=[],J=0,et=H.length;J<et;J++)i=H[J],rt.push(i.id);return rt}().join(",")})).done(function(J){return function(et){return $.get(J.props.more_results_url).done(function(rt){return J.setState({games:_.toArray(rt.games),loading:!1})})}}(this))},render_cell_extras:function(e){return a({type:"button",className:"dismiss_btn",onClick:function(i){return function(){var c,l;return l=function(){var g,w,b,H;for(b=this.state.games,H=[],g=0,w=b.length;g<w;g++)c=b[g],c!==e&&H.push(c);return H}.call(i),i.setState({games:l}),$.post(i.props.dismiss_url,I.with_csrf({object_type:"game",object_id:e.id})).done(function(g){return i.fetch_more_if_necessary()})}}(this)},"Dismiss")},fetch_more_if_necessary:function(){var e,i,c,l;if(!this.state.loading&&!this.state.exhausted&&(e=(i=this.game_grid_ref)!=null&&(c=i.current)!=null&&(l=c.grid_sizer_ref)!=null?l.current:void 0,!!e&&e.get_max_num_visible()>e.get_num_visible()))return this.setState({loading:!0}),$.get(this.props.more_results_url).done(function(g){return function(w){return w=_.toArray(w!=null?w.games:void 0),g.setState({exhausted:w.length<e.get_max_num_visible(),games:w,loading:!1})}}(this))},render_dismiss_button:function(){var e;if(e=this.state.games,!!e.length)return a({className:"button outline",type:"button",onClick:this.on_dismiss_games},this.state.games.length>1?"Dismiss these":"Dismiss")},render:function(){var e;return this.state.games.length?this.enclose({component:"section",className:classNames("game_section",{loading:(e=this.state)!=null?e.loading:void 0})},f({className:"header_split"},f({},f({className:"section_header"},P({},"New From Those You Follow")),G({className:"section_description"},"Projects from those you follow that you haven't seen yet.")),this.render_dismiss_button()),d.GameGrid({ref:this.game_grid_ref||(this.game_grid_ref=React.createRef()),games:this.state.games,fit_rows:this.props.fit_rows,conversion_source:this.props.conversion_source,grid_referrer:this.props.grid_referrer,render_cell_extras:this.render_cell_extras})):null}})})}.call(this),function(){I.libs.react.done(function(){var d,t,s,n,r,u,a,h,f,v,y,j,C,x,P,V,O,A,M,L,F,U,K,Q,q,Y,T,E,G,X,N,D,z,S,k;t=ReactDOMFactories,a=t.div,N=t.span,s=t.a,n=t.br,T=t.p,Q=t.ol,k=t.ul,K=t.li,D=t.strong,h=t.em,M=t.img,v=t.form,F=t.label,L=t.input,z=t.textarea,r=t.button,A=t.iframe,j=t.h1,C=t.h2,x=t.h3,P=t.h4,V=t.h5,O=t.h6,E=t.pre,u=t.code,X=t.select,Y=t.option,G=t.section,q=t.optgroup,f=t.fieldset,U=t.legend,y=React.createElement.bind(null,React.Fragment),y.type=React.fragment,d=R.package("Index"),S=PropTypes,d("GridSizer",{propTypes:{children:S.array},getInitialState:function(){return{}},getDefaultProps:function(){return{cell_margin:20,min_width:0,expected_width:315,min_columns:1,crop_on_resize:!0}},componentDidMount:function(){return _.defer(function(p){return function(){return p.calculate_cell_sizes()}}(this)),this.resize_callback=_.debounce(function(p){return function(){return p.calculate_cell_sizes()}}(this),250),$(window).on("resize",this.resize_callback)},componentWillUnmount:function(){return this.unmounted=!0,$(window).off("resize",this.resize_callback)},componentDidUpdate:function(p){if(p.children!==this.props.children)return _.defer(function(m){return function(){return m.calculate_cell_sizes()}}(this))},calculate_cell_sizes:function(p){var m,o,e,i,c,l;if(p==null&&(p=!1),!this.unmounted&&(o=this.get_width(),this.state.container_width!==o&&(l=this.props.expected_width+this.props.cell_margin,m=o+this.props.cell_margin,i=m/l,c=Math.ceil(i),c<this.props.min_columns&&(c=this.props.min_columns),e=m/c-this.props.cell_margin,e=Math.floor(e),e<this.props.min_width&&c>1&&(c-=1,e=m/c-this.props.cell_margin,e=Math.floor(e)),this.setState({container_width:o,cell_width:e,cells_per_row:c},this.props.on_reshape),p===!1)))return _.defer(function(g){return function(){return g.calculate_cell_sizes(!0)}}(this))},get_width:function(){var p,m,o,e,i;return p=this.container(),m=(i=p[0])!=null?i.getBoundingClientRect().width:void 0,e=m-Math.floor(m),o=Math.floor(p.width()),e>0&&(o-=1),o},get_max_num_visible:function(){if(this.props.fit_rows&&this.state.cells_per_row)return this.state.cells_per_row*this.props.fit_rows},get_num_visible:function(){var p;return p=this.props.children.length,this.props.fit_rows&&this.state.cells_per_row?Math.min(p,this.state.cells_per_row*this.props.fit_rows):p},get_visible_children:function(){var p;return p=this.props.children,this.props.fit_rows&&this.state.cells_per_row&&(p=p.slice(0,this.state.cells_per_row*this.props.fit_rows)),p},render:function(){var p,m,o,e,i,c;return p=this.get_visible_children(),i={display:"grid",alignItems:"start",gap:this.props.cell_margin+"px"},m=this.props.crop_on_resize?{overflowX:"hidden"}:void 0,this.props.crop_on_resize&&this.state.container_width&&(i.width=this.state.container_width+"px"),c=this.state.cell_width&&this.state.cells_per_row?i.gridTemplateColumns="repeat("+this.state.cells_per_row+", "+this.state.cell_width+"px)":(e=window.innerWidth<400?5/9:7/9,o=Math.floor(this.props.expected_width*e),i.gridTemplateColumns="repeat(auto-fill, minmax("+o+"px, 1fr))"),this.enclose({component:this.props.component,style:m},React.createElement(this.props.sizer_component||"div",{className:"grid_sizer_children",style:i},p))}})})}.call(this);
